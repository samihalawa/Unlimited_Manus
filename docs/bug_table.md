# Top 20 Open Bugs / Gaps (Draft)

| # | Severity | Area / Feature | Description | Location (file:line) | Suggested Fix |
|---|----------|----------------|-------------|----------------------|----------------|
| 1 | high | Chat input | `JSON.parse(localStorage.getItem("modelList"))` runs without guards; invalid JSON or empty storage throws and prevents message send. | `frontend/src/view/lemon/components/ChatInput.vue:470-482` | Wrap parsing in try/catch, fall back to cached state from Pinia, and surface error via message tool. |
| 2 | high | Chat input | `modelList.find(...)` executes even when parsed list is `null`, leading to `TypeError` and blocking send. | `ChatInput.vue:478-481` | Guard for null list and handle missing models gracefully. |
| 3 | high | Chat input | Accesses `points.value.total` without verifying `points.value`; undefined points crash subscription check. | `ChatInput.vue:483-491` | Default `points.value` to `{ total: 0 }` or short-circuit when absent. |
| 4 | high | Chat input | Visibility toggle writes `agent.value.is_public` assuming agent selected; when no agent is active this throws. | `ChatInput.vue:505-519` | Check for `agent.value` before mutation; show prompt to select agent instead. |
| 5 | medium | Chat input | `window.addEventListener("message", ...)` added on mount but never removed, causing duplicate handlers across navigations. | `ChatInput.vue:413-430` | Store handler reference and remove it in `onUnmounted`. |
| 6 | high | Chat store | `handleStop` updates `this.list.find(...).status` without guarding the lookup; missing conversation crashes loop. | `frontend/src/store/modules/chat.js:44-55` | Capture `const entry = this.list.find(...)` and ensure it exists before use. |
| 7 | high | Chat store | `autoTitle` performs multiple `.find(...).status/title` assignments without null checks; fails when list desynced. | `chat.js:98-118` | Reuse guarded helper to update list entries and bail if not found. |
| 8 | high | Chat store | `updateTask` assumes a preceding plan message; when absent `plan.meta` access throws and breaks stream rendering. | `chat.js:141-188` | Guard when no plan envelope exists and queue update until plan arrives. |
| 9 | high | Chat store | `updateAction` mirrors the same assumption as `updateTask`, dereferencing `plan.meta` without validation. | `chat.js:190-237` | Share safe accessor with `updateTask` and skip updates if plan missing. |
|10| medium | Plan store | `clearPlan` compares `currentPlan.conversation_id`, but plan objects never contain that field, so plans never clear. | `frontend/src/store/modules/plan.js:79-86` | Track `conversation_id` when storing plans and adjust clear logic. |
|11| medium | Agent sidebar | Clicking an already-selected agent toggles `selectedAgent` to null but still routes using stale `agent.value.id`, so "deselect" never happens. | `frontend/src/view/agents/index.vue:232-260` | Reset `agent.value` when deselecting and guard navigation. |
|12| medium | Message file list | Prop signature declares `message` as `Array`, yet component expects an object with `meta`; causes Vue warnings and typing confusion. | `frontend/src/components/MessageFileList/index.vue:18-24` | Define prop as `Object` with validator and remove incorrect default. |
|13| medium | Legacy plan tool | Secondary plan tool (`src/tools/plan.js`) returns `current_phase_id` from request instead of updated plan when advancing, leading to UI desync if that tool is used. | `src/tools/plan.js:71-111` | Align metadata with `src/agent/tools/plan.js` (use updated plan state for meta fields). |
|14| medium | Plan stream handling | When `plan.advance` meta omits `previous_phase_id`, fallback subtracts 1, which breaks for non-consecutive phase IDs. | `frontend/src/services/see-agent.js:204-214` | Derive previous phase from stored plan ordering instead of arithmetic fallback. |
|15| medium | Message tool (ask flow) | `execute` stores resolver in `context.pendingQuestions` but nothing consumes it; ask/resume loop never resolves. | `src/agent/tools/message.js:69-101` | Implement handler in agent loop to await responses and resume execution. |
|16| low | Schedule tool | Persistence of scheduled jobs marked TODO; schedules are lost on restart, breaking Manus parity. | `src/agent/tools/schedule.js:66-170` | Wire to `ScheduledTask` model or equivalent storage before enabling schedule tool. |
|17| low | Preview renderer | `fullPreview.vue` contains TODO about layout splitting textâ€”rendering bug still unresolved. | `frontend/src/components/preview/fullPreview.vue:422-473` | Investigate pagination logic and remove TODO once fixed. |
|18| low | About dialog | Update modal displays placeholder "TODO show update detail", leaving UI incomplete. | `frontend/src/view/setting/about.vue:48-61` | Populate release notes or hide button until details available. |
|19| low | Demo websocket page | Demo hardcodes `ws://localhost:3000`, failing in production builds. | `frontend/src/view/demo/index.vue:9-41` | Drive URL from env config or guard behind dev flag. |
|20| low | Auto-reply prompt | Auto-reply module still marked `// TODO saas interface`; behaviour unclear and likely incomplete. | `src/agent/auto-reply/chat.reply.js:18` | Replace placeholder with real SaaS integration or document why it's safe to leave. |

> Status: all issues above remain **open** as of this audit. Severity reflects likelihood of runtime failure or Manus UX deviation.
