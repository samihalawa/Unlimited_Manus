import{e as ee,I as Tt,q as Ie,X as Ee,r as ie,c as _e,d as ne,h as G,l as I,x as le,aH as Lt,a7 as Mt,j as me,aR as Bt,aY as Dt,F as ke,Z as Se,g as je,ag as Me,t as re,i as be,w as ue,aZ as $t,B as We,a_ as Rt,W as Ze,k as Ce,T as ot,a$ as Ye,z as Ft,o as Je,a6 as gt,b0 as wt,aa as pt,aJ as Pt,a4 as bt,aM as yt,aP as Re,aT as rt,v as et,aC as it,u as He,a0 as Ut,f as Nt,a as kt,a1 as Ue,ac as jt,b1 as Wt,b2 as Zt,b3 as Ht,b4 as Vt,a3 as qt,ab as Le,p as Gt,b5 as Kt,O as Yt,aU as Jt,aL as Xt,b6 as Qt,aS as en}from"./index-B-_Irm-z.js";import{u as De,f as tn,c as nn,a as mt,m as sn}from"./edit-DxMXqxmp.js";import{f as at,s as lt,u as ct,i as rn,v as an,m as on,d as ln,b as tt,c as nt,e as Ne,g as cn,C as un,a as dn,P as hn,_ as fn}from"./fullPreview-DOAsiui0.js";import{u as Xe}from"./user-Dspu798t.js";import{s as xt}from"./default-model-setting-dgh9t0Qv.js";import{P as Ct}from"./pricing-Dhv2HqPb.js";import{s as pn}from"./auth-SY_X_2y9.js";import{s as Ge}from"./membership-BfcodThB.js";import{S as mn,W as _n}from"./wechatpay-CyOnVK8L.js";import{e as Be}from"./emitter-E5P-NQ8u.js";import{s as vn}from"./mcp-aBATD4E5.js";import"./http-yCFEzgv3.js";import{s as St,R as gn,K as wn,A as bn}from"./KnowledgeModal-DgIAK9gq.js";import"./index-TjCxX7sJ.js";import"./lemon-D5W0kMi6.js";import"./index-XASoiLdS.js";import"./marked.esm-BktMfnUh.js";var yn={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M704 446H320c-4.4 0-8 3.6-8 8v402c0 4.4 3.6 8 8 8h384c4.4 0 8-3.6 8-8V454c0-4.4-3.6-8-8-8zm-328 64h272v117H376V510zm272 290H376V683h272v117z"}},{tag:"path",attrs:{d:"M424 748a32 32 0 1064 0 32 32 0 10-64 0zm0-178a32 32 0 1064 0 32 32 0 10-64 0z"}},{tag:"path",attrs:{d:"M811.4 368.9C765.6 248 648.9 162 512.2 162S258.8 247.9 213 368.8C126.9 391.5 63.5 470.2 64 563.6 64.6 668 145.6 752.9 247.6 762c4.7.4 8.7-3.3 8.7-8v-60.4c0-4-3-7.4-7-7.9-27-3.4-52.5-15.2-72.1-34.5-24-23.5-37.2-55.1-37.2-88.6 0-28 9.1-54.4 26.2-76.4 16.7-21.4 40.2-36.9 66.1-43.7l37.9-10 13.9-36.7c8.6-22.8 20.6-44.2 35.7-63.5 14.9-19.2 32.6-36 52.4-50 41.1-28.9 89.5-44.2 140-44.2s98.9 15.3 140 44.3c19.9 14 37.5 30.8 52.4 50 15.1 19.3 27.1 40.7 35.7 63.5l13.8 36.6 37.8 10c54.2 14.4 92.1 63.7 92.1 120 0 33.6-13.2 65.1-37.2 88.6-19.5 19.2-44.9 31.1-71.9 34.5-4 .5-6.9 3.9-6.9 7.9V754c0 4.7 4.1 8.4 8.8 8 101.7-9.2 182.5-94 183.2-198.2.6-93.4-62.7-172.1-148.6-194.9z"}}]},name:"cloud-server",theme:"outlined"};function _t(ae){for(var V=1;V<arguments.length;V++){var f=arguments[V]!=null?Object(arguments[V]):{},O=Object.keys(f);typeof Object.getOwnPropertySymbols=="function"&&(O=O.concat(Object.getOwnPropertySymbols(f).filter(function(w){return Object.getOwnPropertyDescriptor(f,w).enumerable}))),O.forEach(function(w){kn(ae,w,f[w])})}return ae}function kn(ae,V,f){return V in ae?Object.defineProperty(ae,V,{value:f,enumerable:!0,configurable:!0,writable:!0}):ae[V]=f,ae}var ut=function(V,f){var O=_t({},V,f.attrs);return ee(Tt,_t({},O,{icon:yn}),null)};ut.displayName="CloudServerOutlined";ut.inheritAttrs=!1;const xn={class:"conversation-list"},Cn={class:"list-header"},Sn={class:"search-box"},En={class:"search-wrapper"},zn={key:0,class:"conversation-items"},An=["onClick"],In={class:"conversation-title"},On={class:"conversation-preview"},Tn={class:"conversation-meta"},Ln={class:"conversation-time"},Mn={key:0,class:"conversation-model"},Bn={key:1,class:"empty-state"},Dn={__name:"ConversationList",setup(ae){const V=De(),f=je(),{list:O,conversationId:w,agent:c,mode:l}=Ee(V),s=ie(""),d=_e(()=>{const o=s.value.trim().toLowerCase();return o?O.value.filter(t=>{var v;const a=(t.title||"Untitled conversation").toLowerCase(),i=(((v=t==null?void 0:t.latest_message)==null?void 0:v.content)||"").toLowerCase();return a.includes(o)||i.includes(o)}):O.value}),m=o=>{var a;if(!o||o.conversation_id===w.value)return;V.conversationId=o.conversation_id,V.chat=o,V.clearMessages(),V.initConversation(o.conversation_id);const t=o.agent_id||((a=c.value)==null?void 0:a.id);l.value==="chat"?f.push(`/lemon/chat/${o.conversation_id}`):t?f.push(`/lemon/${t}/${o.conversation_id}`):f.push(`/lemon/${o.conversation_id}`)},p=()=>{var o;V.conversationId=null,V.chat={},V.clearMessages(),l.value==="chat"?f.push("/lemon/chat"):(o=c.value)!=null&&o.id?f.push(`/lemon/${c.value.id}`):f.push("/lemon")},g=o=>(o==null?void 0:o.trim())||"Untitled conversation",_=o=>{if(!o)return"No messages yet";const t=o.replace(/\s+/g," ").trim();return t.length>80?`${t.slice(0,80)}…`:t},r=o=>{if(!o)return"";try{return tn(o)}catch(t){return console.warn("Failed to format time",t),""}};return(o,t)=>(G(),ne("div",xn,[I("div",Cn,[I("button",{class:"new-chat-btn",type:"button",onClick:p},[ee(le(Lt)),t[2]||(t[2]=I("span",null,"New Chat",-1))])]),I("div",Sn,[I("div",En,[ee(le(Bt),{class:"search-icon"}),Mt(I("input",{"onUpdate:modelValue":t[0]||(t[0]=a=>s.value=a),class:"search-input",type:"text",placeholder:"Search conversations","aria-label":"Search conversations"},null,512),[[Dt,s.value]]),s.value?(G(),ne("button",{key:0,class:"clear-button",type:"button",onClick:t[1]||(t[1]=a=>s.value=""),"aria-label":"Clear search"}," × ")):me("",!0)])]),d.value.length?(G(),ne("div",zn,[(G(!0),ne(ke,null,Se(d.value,a=>{var i;return G(),ne("button",{key:a.conversation_id,type:"button",class:Me(["conversation-item",{active:a.conversation_id===le(w)}]),onClick:v=>m(a)},[I("div",In,re(g(a.title)),1),I("div",On,re(_((i=a==null?void 0:a.latest_message)==null?void 0:i.content)),1),I("div",Tn,[I("span",Ln,re(r(a.update_at)),1),a.model_name?(G(),ne("span",Mn,re(a.model_name),1)):me("",!0)])],10,An)}),128))])):(G(),ne("div",Bn,t[3]||(t[3]=[I("p",{class:"empty-title"},"No conversations found",-1),I("p",{class:"empty-subtitle"},"Try adjusting your search or start a new chat.",-1)])))]))}},$n=Ie(Dn,[["__scopeId","data-v-2e540405"]]),Rn={xmlns:"http://www.w3.org/2000/svg",width:"10",height:"10",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",class:"lucide lucide-x text-white",viewBox:"0 0 24 24"};function Fn(ae,V){return G(),ne("svg",Rn,V[0]||(V[0]=[I("path",{d:"M18 6 6 18M6 6l12 12"},null,-1)]))}const Pn={render:Fn},Un={style:{overflow:"auto",width:"100%","min-width":"0"}},Nn={class:"upload-fileList"},jn={style:{"min-width":"0",width:"100%"}},Wn={key:0,style:{display:"flex",width:"100%","align-items":"center"}},Zn={class:"file-name"},Hn=["onClick"],Vn={key:1,style:{display:"flex",width:"100%","align-items":"center",color:"#34322d"}},qn={key:2},Gn={class:"file-size"},Kn={__name:"ChatInputFileList",props:{fileList:{type:Array,default:()=>[]},conversation_id:{type:String,default:""}},emits:["update:fileList"],setup(ae,{emit:V}){const f=ae,O=V,w=l=>{console.log("delete file",l),lt.deleteFile(l.id,f.conversation_id),O("update:fileList",f.fileList.filter(s=>s.id!==l.id))},c=l=>l<1024?`${l} B`:l<1024*1024?`${(l/1024).toFixed(2)} KB`:`${(l/(1024*1024)).toFixed(2)} MB`;return(l,s)=>(G(),ne("div",Un,[I("div",Nn,[(G(!0),ne(ke,null,Se(ae.fileList,(d,m)=>(G(),ne("div",{class:"upload-fileList-item",key:m},[ee(at,{url:d.name,"is-update":!0,class:"file-icon"},null,8,["url"]),I("div",jn,[d.uploading?(G(),ne("div",Vn,s[0]||(s[0]=[I("div",{class:"loading-spinner"},null,-1),I("div",{style:{"margin-left":"8px"}},"Uploading...",-1)]))):(G(),ne("div",Wn,[I("div",Zn,re(d.name),1),I("div",{class:"delete-button",onClick:p=>w(d)},[ee(le(Pn))],8,Hn)])),d.uploading?me("",!0):(G(),ne("div",qn,[I("div",Gn,re(c(d.size)),1)]))])]))),128))])]))}},Yn=Ie(Kn,[["__scopeId","data-v-dbfd9cdd"]]),Jn={__name:"ChatInputUpload",props:{fileList:{type:Array,default:()=>[]},conversation_id:{type:String,default:""},isPublic:{type:Boolean,default:!1}},emits:["update:fileList"],setup(ae,{emit:V}){const f=ae,O=()=>localStorage.getItem("hasShownPublicWarning")==="true",w=p=>{localStorage.setItem("hasShownPublicWarning",p.toString())},c=ie(O()),l=ie(!1),s=V,d=async p=>{if(f.isPublic&&!c.value){if(p.stopPropagation(),await new Promise(_=>{Ze.confirm({title:"Public File Upload Warning",content:"You have selected public mode. The uploaded files will be made public. Please confirm to continue?",okText:"Continue",cancelText:"Cancel",centered:!0,onOk:()=>{c.value=!0,w(!0),_(!0)},onCancel:()=>{_(!1)}})})){const _=p.target.closest(".ant-upload").querySelector('input[type="file"]');_&&_.click()}return}},m=async p=>{p.uid=Date.now()+Math.random();const g={uid:p.uid,name:p.name,size:p.size,uploading:!0,error:!1};s("update:fileList",[...f.fileList,g]);try{const _=new FormData;_.append("conversation_id",f.conversation_id||""),_.append("files",p);let o=(await lt.uploadFile(_))[0];console.log("upload",o);const t=f.fileList.filter(a=>a.uid!==p.uid).concat({name:o.name,size:p.size,url:o.url,id:o.id,workspace_dir:o.workspace_dir,uploading:!1,error:!1});console.log("newFileList",t),s("update:fileList",t)}catch(_){console.log("上传失败，更新对应文件状态",_);const r=f.fileList.map(o=>o.uid===p.uid?{...o,uploading:!1,error:!0}:o);s("update:fileList",r)}return!1};return(p,g)=>{const _=We,r=Rt;return G(),be(r,{"file-list":ae.fileList,"before-upload":m,"show-upload-list":!1,disabled:l.value},{default:ue(()=>[ee(_,{type:"text",class:"upload-button",onClick:d},{icon:ue(()=>[ee(le($t))]),_:1})]),_:1},8,["file-list","disabled"])}}},Xn=Ie(Jn,[["__scopeId","data-v-af7b397f"]]),Qn={key:0,class:"selection-preview"},es={class:"preview-header"},ts={class:"preview-title"},ns={class:"preview-content"},ss={class:"preview-image-container"},rs=["src"],is={__name:"SelectionPreview",setup(ae){const V=ct(),{editorMode:f,selectedElement:O,selectedScreenshot:w,showSelectionPreview:c}=Ee(V),l=_e(()=>{var g;if(!O.value)return"";const d=((g=O.value.tagName)==null?void 0:g.toLowerCase())||"",m=O.value.id?`#${O.value.id}`:"",p=O.value.className?`.${O.value.className.split(" ")[0]}`:"";return`${d}${m}${p}`}),s=()=>{V.setShowSelectionPreview(!1)};return(d,m)=>{const p=ot,g=We;return G(),be(Ft,{name:"preview-slide"},{default:ue(()=>[le(c)&&le(w)&&le(f)==="ai-edit"?(G(),ne("div",Qn,[I("div",es,[I("div",ts,[m[0]||(m[0]=I("i",{class:"fas fa-crosshairs"},null,-1)),m[1]||(m[1]=I("span",null,"Selected",-1)),ee(p,{size:"small",color:"blue"},{default:ue(()=>[Ce(re(l.value),1)]),_:1})]),ee(g,{type:"text",size:"small",onClick:s,class:"close-btn"},{default:ue(()=>[ee(le(Ye))]),_:1})]),I("div",ns,[I("div",ss,[I("img",{src:le(w),alt:"Selected element preview",class:"preview-image"},null,8,rs)])])])):me("",!0)]),_:1})}}},as=Ie(is,[["__scopeId","data-v-2d3544a8"]]),os={style:{display:"flex","align-items":"center"}},ls=["src"],cs={style:{display:"flex","align-items":"center",gap:"6px"}},us={class:"selected-model"},ds=["src"],hs={class:"model-name"},fs={class:"modal-header"},ps={class:"model-list"},ms={class:"platform-header"},_s={class:"platform-name"},vs=["onClick"],gs={class:"model-info"},ws=["src"],bs={class:"model-name"},ys={class:"model-tags"},ks={style:{"text-align":"center",padding:"20px 0"}},xs={style:{"margin-bottom":"20px","font-size":"16px"}},Cs={style:{"margin-bottom":"20px",color:"#666"}},Ss={__name:"ModelSelect",setup(ae){const V=Xe(),{membership:f}=Ee(V),O=De(),{model_id:w}=Ee(O),c=ie([]),l=ie(null),s=ie(null),d=ie(!1),m=ie(!1),p=ie("Upgrade"),g=ie(!1),_=ie(!1),r=ie(!1),o=_e(()=>!!localStorage.getItem("access_token"));ie(!1);const t=()=>{r.value=window.innerWidth<=768};let a;const i=_e(()=>!!f.value),v=()=>{m.value=!1},b=()=>{g.value=!1},S=()=>{b(),console.log("跳转到登录页面")},E=Z=>{if(Z.requiresLogin){L(),g.value=!0;return}if(Z.requires_membership&&!i.value){L(),m.value=!0;return}j(Z.value),L()},D=()=>{_.value=!0},L=()=>{const Z=document.querySelector(".mobile-model-selector");Z&&Z.classList.add("closing"),setTimeout(()=>{_.value=!1},250)},$=Z=>{d.value=Z},B=async()=>{console.log("[MODELSELECT] initModel started"),console.log("[MODELSELECT] membership.value",f.value);const Z=localStorage.getItem("modelList");if(console.log("[MODELSELECT] cachedData:",Z),Z)try{if(c.value=JSON.parse(Z),console.log("[MODELSELECT] Loaded from cache, modelList.value.length:",c.value.length),c.value.length>0&&!w.value){const k=c.value[0].id*1;w.value=k,l.value=k}}catch(k){console.error("[MODELSELECT] Failed to parse cached modelList",k)}try{console.log("[MODELSELECT] Calling modelService.getModels()...");const k=await xt.getModels();if(console.log("[MODELSELECT] modelService.getModels() response:",k),console.log("[MODELSELECT] response type:",typeof k),console.log("[MODELSELECT] is array:",Array.isArray(k)),Array.isArray(k)){if(console.log("[MODELSELECT] Response is array, length:",k.length),c.value=k,localStorage.setItem("modelList",JSON.stringify(k)),k.length>0&&!w.value){const H=k[0].id*1;w.value=H,l.value=H}}else console.warn("[MODELSELECT] Response is NOT an array! Type:",typeof k,"Value:",k)}catch(k){console.error("[MODELSELECT] Failed to fetch models from API",k)}},j=Z=>{const k=Z*1,H=c.value.find(M=>M.id===k);if(H&&H.is_subscribe&&!o.value){g.value=!0;return}if(H&&H.requires_membership&&!i.value){m.value=!0;return}l.value=k,w.value=k},Q=_e(()=>{var k;if(!c.value||c.value.length===0)return null;const Z=l.value??w.value??((k=c.value[0])==null?void 0:k.id)??null;if(Z&&c.value.length>0){const H=c.value.find(M=>M.id===Z);if(H&&H.is_subscribe&&!o.value){const M=c.value.find(q=>!q.is_subscribe);return M?M.id:null}if(H&&H.requires_membership&&!i.value){const M=c.value.find(q=>!q.requires_membership&&(!q.is_subscribe||o.value));return M?M.id:null}}return Z});a=_e(()=>{const Z=Q.value;return!Z||!c.value||c.value.length===0?null:c.value.find(k=>k.id===Z)});const y=Z=>({cheap:{label:"Cheapest",color:"#52c41a"},normal:{label:"Cheap",color:"#1890ff"},expensive:{label:"Expensive",color:"#722ed1"},very_expensive:{label:"Very Expensive",color:"#ff4d4f"}})[Z]||{label:"Unknown",color:"#d9d9d9"},R=_e(()=>{const k=c.value.map(M=>{const q=y(M.price_level_description),A=M.is_subscribe&&!o.value;return{label:M.model_name,requires_membership:M.requires_membership,value:M.id,logo_url:M.logo_url,disabled:A,priceLevel:q.level,priceLabel:q.label,priceColor:q.color,platform_name:M.platform_name,platform_id:M.platform_id,is_subscribe:M.is_subscribe,requiresLogin:A}}).reduce((M,q)=>{const A=q.platform_name||"Other";return M[A]||(M[A]=[]),M[A].push(q),M},{}),H=Object.keys(k).map(M=>({label:M,options:k[M].sort((q,A)=>q.priceLevel-A.priceLevel)}));return console.log("groupedOptions:",H),H});_e(()=>R.value.flatMap(Z=>Z.options));const n=({menuNode:Z})=>{const k=[et("span",{style:{fontSize:"14px",fontWeight:"500",color:"#333"}},it.global.t("lemon.model.models"))];return et("div",[et("div",{class:"model-dropdown-header",style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 12px",borderBottom:"1px solid #f0f0f0",backgroundColor:"#fafafa",marginBottom:"8px"}},k),Z])};Je(()=>{B(),t(),window.addEventListener("resize",t)}),gt(()=>{window.removeEventListener("resize",t)});let F=!1;return wt(()=>{if(F)return;const Z=Q.value;Z&&Z!==w.value&&c.value&&c.value.length>0&&pt(()=>{F=!0,j(Z),pt(()=>{F=!1})})}),(Z,k)=>{var z,te;const H=ot,M=bt,q=We,A=Ze;return G(),ne(ke,null,[r.value?(G(),ne("div",{key:1,class:"mobile-model-trigger",onClick:D},[I("div",us,[(z=le(a))!=null&&z.logo_url?(G(),ne("img",{key:0,src:le(a).logo_url,alt:"logo",class:"model-logo"},null,8,ds)):me("",!0),I("span",hs,re(((te=le(a))==null?void 0:te.model_name)||"Select Model"),1)]),ee(le(yt),{class:"dropdown-icon"})])):(G(),be(M,{key:0,ref_key:"selectRef",ref:s,class:"model-select",onChange:j,value:Q.value,placeholder:Z.$t("lemon.input.chooseModel"),style:{"max-width":"200px",width:"100%"},options:R.value,optionLabelProp:"label",fieldNames:{label:"label",value:"value"},dropdownMatchSelectWidth:!1,dropdownRender:n,open:d.value,onDropdownVisibleChange:$},{option:ue(({label:K,logo_url:P,requires_membership:he,disabled:ge,priceLabel:ce,priceColor:de,requiresLogin:ve,is_subscribe:pe})=>[I("div",{style:Pt([{display:"flex","align-items":"center","justify-content":"space-between",width:"100%"},{opacity:ge?.5:1}])},[I("div",os,[P?(G(),ne("img",{key:0,src:P,alt:"logo",style:{"max-width":"20px",height:"20px","margin-right":"8px"}},null,8,ls)):me("",!0),I("span",null,re(K),1)]),I("div",cs,[ve?(G(),be(H,{key:0,size:"small",class:"model-tag-login"},{default:ue(()=>[Ce(re(Z.$t("lemon.model.requiresLogin")),1)]),_:1})):me("",!0)])],4)]),_:1},8,["value","placeholder","options","open"])),(G(),be(rt,{to:"body"},[_.value?(G(),ne("div",{key:0,class:"mobile-modal-overlay",onClick:L},[I("div",{class:"mobile-model-selector",onClick:k[0]||(k[0]=Re(()=>{},["stop"]))},[I("div",fs,[I("h3",null,re(Z.$t("lemon.input.chooseModel")),1),ee(q,{type:"text",onClick:L,class:"close-btn"},{default:ue(()=>[ee(le(Ye))]),_:1})]),I("div",ps,[(G(!0),ne(ke,null,Se(R.value,K=>(G(),ne("div",{key:K.label,class:"platform-group"},[I("div",ms,[I("span",_s,re(K.label),1)]),(G(!0),ne(ke,null,Se(K.options,P=>(G(),ne("div",{key:P.value,class:Me(["model-item",{selected:P.value===Q.value,disabled:P.disabled}]),onClick:he=>E(P)},[I("div",gs,[P.logo_url?(G(),ne("img",{key:0,src:P.logo_url,alt:"logo",class:"model-logo"},null,8,ws)):me("",!0),I("span",bs,re(P.label||P.model_name||"Unknown Model"),1)]),I("div",ys,[P.requiresLogin?(G(),be(H,{key:0,size:"small",class:"model-tag-login"},{default:ue(()=>[Ce(re(Z.$t("lemon.model.requiresLogin")),1)]),_:1})):me("",!0),P.requires_membership?(G(),be(H,{key:1,size:"small",class:"model-tag-pro"},{default:ue(()=>k[3]||(k[3]=[Ce(" Pro+ ")])),_:1})):me("",!0)])],10,vs))),128))]))),128))])])])):me("",!0)])),ee(A,{open:m.value,"onUpdate:open":k[1]||(k[1]=K=>m.value=K),title:p.value,centered:"",width:"1200px",footer:null,onCancel:v},{default:ue(()=>[ee(Ct,{isWindow:"true",showTitle:"false",onClose_window:v})]),_:1},8,["open","title"]),ee(A,{open:g.value,"onUpdate:open":k[2]||(k[2]=K=>g.value=K),title:Z.$t("lemon.model.loginRequired"),centered:"",width:"400px",footer:null,onCancel:b},{default:ue(()=>[I("div",ks,[I("p",xs,re(Z.$t("lemon.model.loginRequiredDescription")),1),I("p",Cs,re(Z.$t("lemon.model.pleaseLoginFirst")),1),ee(q,{type:"primary",onClick:S,style:{"margin-right":"12px"}},{default:ue(()=>[Ce(re(Z.$t("lemon.model.goToLogin")),1)]),_:1}),ee(q,{onClick:b},{default:ue(()=>[Ce(re(Z.$t("lemon.common.cancel")),1)]),_:1})])]),_:1},8,["open","title"])],64)}}},Es=Ie(Ss,[["__scopeId","data-v-fcdde5f8"]]),zs={key:0,class:"recharge-products"},As={class:"product-title"},Is={class:"product-info"},Os={style:{"margin-top":"8px"}},Ts=["loading","onClick"],Ls={key:1},Ms={style:{"text-align":"center",display:"flex","flex-direction":"column","align-items":"center"}},Bs={style:{display:"inline-block"}},Ds={style:{"margin-top":"12px"}},$s={style:{display:"flex","flex-direction":"column",gap:"16px",padding:"12px 4px"}},Rs={class:"payment-content"},Fs={class:"payment-title"},Ps={class:"payment-description"},Us={class:"payment-content"},Ns={class:"payment-title"},js={class:"payment-description"},Ws={__name:"rechargeProducts",props:{open:{type:Boolean,default:!1}},emits:["update:open"],setup(ae,{emit:V}){const{t:f}=He();je();const O=Xe(),{user:w,membership:c,points:l}=Ee(O),s=ae,d=V,m=_e({get:()=>s.open,set:L=>d("update:open",L)}),p=ie(!1),g=ie(""),_=ie(!1),r=ie(null),o=ie(null),t=ie(!1),a=_e(()=>"$"),i=ie([]),v=async L=>{_.value=!0,r.value=L};Je(async()=>{await b()});const b=async()=>{let L=await Ge.getRechargeProductList();i.value=L||[]},S=async L=>{if(_.value=!1,t.value=!0,L==="stripe"){let $=await Ge.createStripePointPurchaseOrder(r.value.id);window.location.href=$.url,t.value=!1}else{let $=await Ge.createPointPurchaseOrder(r.value.id);$&&$.code_url?(t.value=!1,g.value=$.code_url,p.value=!0,E($.order_sn)):t.value=!1,console.log($)}},E=async L=>{let B=0;o.value=setInterval(async()=>{B++;const j=await Ge.checkOrderStatus(L);(j==null?void 0:j.status)==="paid"&&(clearInterval(o.value),p.value=!1,Nt.success(f("member.paymentSuccess")),D(),console.log("支付成功")),B>=20&&(clearInterval(o.value),console.warn("支付超时，请重新下单"))},3e3)},D=()=>{window.location.reload()};return(L,$)=>{const B=Ut,j=Ze;return G(),be(j,{open:m.value,"onUpdate:open":$[4]||($[4]=Q=>m.value=Q),width:"720px",centered:"",footer:null,title:"Buy add-on credits"},{default:ue(()=>[i.value.length?(G(),ne("div",zs,[(G(!0),ne(ke,null,Se(i.value,Q=>(G(),ne("div",{key:Q.id,class:"product-card"},[I("div",As,re(Q.product_name),1),I("div",Is,[I("p",Os,re(a.value)+" "+re(Q.amount),1),I("p",null,re(Q.points_awarded)+re(le(f)("member.pointsUnit")),1)]),I("button",{size:"small",loading:t.value,onClick:y=>v(Q)},re(le(f)("member.buyNow")),9,Ts)]))),128))])):(G(),ne("div",Ls,re(le(f)("member.noPackagesAvailable")),1)),ee(j,{open:p.value,"onUpdate:open":$[0]||($[0]=Q=>p.value=Q),title:le(f)("member.wechatScanToPay"),centered:"",footer:null},{default:ue(()=>[I("div",Ms,[I("div",Bs,[ee(B,{value:g.value,size:200},null,8,["value"])]),I("p",Ds,re(le(f)("member.wechatScanPrompt")),1)])]),_:1},8,["open","title"]),ee(j,{open:_.value,"onUpdate:open":$[3]||($[3]=Q=>_.value=Q),footer:null,centered:"",width:"480",title:L.$t("member.selectPaymentMethod")},{default:ue(()=>[I("div",$s,[I("div",{class:"payment-option",onClick:$[1]||($[1]=Q=>S("stripe"))},[ee(le(mn)),I("div",Rs,[I("div",Fs,re(L.$t("payment.stripe.title")),1),I("div",Ps,re(L.$t("payment.stripe.description")),1)])]),I("div",{class:"payment-option",onClick:$[2]||($[2]=Q=>S("wechat"))},[ee(le(_n)),I("div",Us,[I("div",Ns,re(L.$t("payment.wechat.title")),1),I("div",js,re(L.$t("payment.wechat.description")),1)])])])]),_:1},8,["open","title"])]),_:1},8,["open"])}}},Zs=Ie(Ws,[["__scopeId","data-v-fe4405c7"]]),Hs={class:"chat-input"},Vs={class:"input-wrapper"},qs={class:"input-area"},Gs={class:"input-container"},Ks={class:"input-actions"},Ys={class:"left-actions"},Js={class:"button-row first-row"},Xs={class:"mode-selector-dropdown"},Qs={class:"mode-option"},er={class:"mode-circle"},tr={key:0,class:"mode-inner-circle"},nr={class:"mode-texts"},sr={class:"mode-label"},rr={class:"mode-desc"},ir={class:"mode-name"},ar={class:"mcp-button-container"},or={class:"modal-header"},lr={class:"option-list"},cr=["onClick"],ur={class:"option-info"},dr={class:"option-circle"},hr={key:0,class:"option-inner-circle"},fr={class:"option-texts"},pr={class:"option-label"},mr={class:"option-desc"},_r={class:"modal-header"},vr={class:"option-list"},gr=["onClick"],wr={class:"option-info"},br={class:"option-circle"},yr={key:0,class:"option-inner-circle"},kr={class:"option-texts"},xr={class:"option-label"},Cr={class:"option-desc"},Sr={class:"buy-credits"},Er={class:"upgrade-des-wrapper"},zr={key:0,class:"upgrade-des"},Ar={key:1,class:"upgrade-des"},Ir={__name:"ChatInput",emits:["send"],setup(ae,{emit:V}){const{t:f}=He();je();const O=kt(),w=ie("Upgrade required"),c=Xe(),{user:l,membership:s,points:d}=Ee(c),m=De(),{agent:p,chat:g,model_id:_}=Ee(m),r=ie(""),o=ie(f("lemon.welcome.placeholder")),t=ie([]),a=ie("text"),i=ie(!0),v=ie(!1),b=ie(localStorage.getItem("workMode")||"auto"),S=_e(()=>[{value:"auto",label:f("lemon.workMode.auto.label"),description:f("lemon.workMode.auto.description")},{value:"agent",label:f("lemon.workMode.agent.label"),description:f("lemon.workMode.agent.description")},{value:"chat",label:f("lemon.workMode.chat.label"),description:f("lemon.workMode.chat.description")}]),E=ie([]),D=ie([]),L=V,$=[{value:!0,label:"Public",desc:"Anyone can view and remix"},{value:!1,label:"Personal",desc:"Only visible to yourself"}],B=ie(!1),j=ie(""),Q=ie(""),y=ie(!1),R=ie(!1),n=ie(!1);_e(()=>!!l.value.id);const F=_e(()=>m.mode),Z=_e(()=>O.params.id||null),k=_e(()=>D.value.length===0?["disable"]:D.value),H=_e(()=>{var u;const x=m.list.find(h=>{var C;return h.conversation_id===((C=m.chat)==null?void 0:C.conversation_id)});return console.log(" chat?.status",x==null?void 0:x.status),console.log(" chatStore.chat?.conversation_id ",(u=m.chat)==null?void 0:u.conversation_id),(x==null?void 0:x.status)!="running"}),M=()=>{y.value=window.innerWidth<=768},q=()=>{R.value=!0},A=()=>{const x=document.querySelector(".mobile-mode-selector");x&&x.classList.add("closing"),setTimeout(()=>{R.value=!1},250)},z=()=>{const x=document.querySelector(".mobile-visibility-selector");x&&x.classList.add("closing"),setTimeout(()=>{n.value=!1},250)},te=x=>{de(x),A()},K=x=>{ve(x),z()};Je(async()=>{await ze(),await P(),M(),window.addEventListener("resize",M),Be.on("changeMessageText",x=>{r.value=x}),Be.on("showUpgrade",()=>{w.value="",j.value="You don't have enough credits, and the prediction can't complete the task. ",Q.value="Please upgrade or purchase more credits.",B.value=!0})}),gt(()=>{window.removeEventListener("resize",M)}),Ue(()=>O.params.agentId,()=>{console.log("agent.value 改变",p.value),p.value&&(D.value=p.value.mcp_server_ids||[])});const P=async()=>{const x=await vn.activate_servers();Array.isArray(x)&&(E.value=x),p.value&&(D.value=p.value.mcp_server_ids||[])},he=({key:x})=>{if(x==="disable")D.value=[];else{const u=D.value.indexOf(x);u!==-1?D.value.splice(u,1):D.value.push(x)}localStorage.setItem("selectedMcpServerIds",JSON.stringify(D.value)),p.value&&(p.value.mcp_server_ids=D.value,ge())},ge=async()=>{p.value&&(await St.update(p.value.id,p.value.name,p.value.describe,p.value.mcp_server_ids,p.value.is_public),Be.emit("updateAgentList"))},ce=()=>{B.value=!1},de=x=>{b.value=x,console.log("工作模式切换为:",x),localStorage.setItem("workMode",x)},ve=x=>{var u;if(console.log("handleVisibilityChange",x),!x&&!((u=s.value)!=null&&u.planName)){i.value=!0,w.value="Upgrade required",j.value="",B.value=!0;return}p.value.is_public=x,ge()};Ue(()=>p.value,x=>{var u;p.value&&p.value.is_public!==void 0?i.value=(u=p.value)==null?void 0:u.is_public:i.value=!0},{immediate:!0}),window.addEventListener("message",x=>{if(x.origin!=="https://lemonai.ai")return;const{type:u,payload:h}=x.data;console.log("监听 message 事件",x.data),u==="transferData"&&(m.mode="task",r.value=h,xe())});const pe=ie([]),ze=async()=>{console.log("membership.value",s.value);const x=h=>{if(h.length>0&&!_.value){const C=h[0].id*1;_.value=C}},u=localStorage.getItem("modelList");if(u)try{pe.value=JSON.parse(u),x(pe.value)}catch(h){console.error("Failed to parse cached modelList",h)}try{const h=await xt.getModels();Array.isArray(h)&&(pe.value=h,localStorage.setItem("modelList",JSON.stringify(h)),x(h))}catch(h){console.error("Failed to fetch models from API",h)}},xe=()=>{const x=r.value.trim();if(!x&&t.value.length===0)return;console.log("selectedModelValue.value",_.value);let h=JSON.parse(localStorage.getItem("modelList")).find(C=>C.id===_.value);if(console.log("modelDetail",h),d.value.total<=100&&h.is_subscribe){j.value="You don't have enough credits to use this subscription model. ",Q.value="Please subscribe or purchase more credits to continue.",w.value="",B.value=!0;return}L("send",{text:x,mode:a.value,files:t.value,mcp_server_ids:D.value,is_public:i.value,workMode:b.value}),r.value="",t.value=[]},e=()=>{m.handleStop()},U=x=>{x.shiftKey&&x.key==="Enter"||x.isComposing||x.key==="Enter"&&(x.preventDefault(),xe())};return(x,u)=>{var fe;const h=jt,C=bt,N=We,W=Ht,T=Vt,Y=Zt,se=Wt,J=ot,oe=Ze;return G(),ne(ke,null,[I("div",Hs,[ee(as),I("div",Vs,[I("div",qs,[ee(Yn,{fileList:t.value,"onUpdate:fileList":u[0]||(u[0]=X=>t.value=X),conversation_id:Z.value,"onUpdate:conversation_id":u[1]||(u[1]=X=>Z.value=X)},null,8,["fileList","conversation_id"]),I("div",Gs,[ee(h,{class:"input-textarea",value:r.value,"onUpdate:value":u[2]||(u[2]=X=>r.value=X),placeholder:o.value,"auto-size":{minRows:2,maxRows:8},onKeydown:U},null,8,["value","placeholder"]),I("div",Ks,[I("div",Ys,[I("div",Js,[F.value==="task"?(G(),be(Xn,{key:0,fileList:t.value,"onUpdate:fileList":u[3]||(u[3]=X=>t.value=X),conversation_id:Z.value,"onUpdate:conversation_id":u[4]||(u[4]=X=>Z.value=X),isPublic:i.value},null,8,["fileList","conversation_id","isPublic"])):me("",!0),ee(Es),I("div",Xs,[y.value?(G(),ne("div",{key:1,class:"mobile-mode-trigger",onClick:q},[I("span",ir,re(((fe=S.value.find(X=>X.value===b.value))==null?void 0:fe.label)||"Auto"),1),ee(le(yt),{class:"dropdown-icon"})])):(G(),be(C,{key:0,value:b.value,"onUpdate:value":u[5]||(u[5]=X=>b.value=X),class:"mode-select-dropdown",options:S.value,onChange:de,dropdownMatchSelectWidth:!1,bordered:!1},{option:ue(({value:X,label:ye,description:$e})=>[I("div",Qs,[I("span",er,[b.value===X?(G(),ne("span",tr)):me("",!0)]),I("div",nr,[I("div",sr,re(ye),1),I("div",rr,re($e),1)])])]),_:1},8,["value","options"]))]),I("div",ar,[ee(se,{trigger:["click"],placement:"top",class:"mcp-dropdown"},{overlay:ue(()=>[ee(Y,{selectedKeys:k.value,multiple:"",class:"mcp-server-menu",onClick:he},{default:ue(()=>[ee(W,{key:"disable"},{default:ue(()=>u[12]||(u[12]=[I("span",null,"Close MCP",-1)])),_:1}),ee(T),(G(!0),ne(ke,null,Se(E.value,X=>(G(),be(W,{key:X.id,class:"mcp-server-item"},{default:ue(()=>[I("span",null,re(X.name),1),D.value&&D.value.includes(X.id)?(G(),be(le(qt),{key:0,class:"check-icon"})):me("",!0)]),_:2},1024))),128))]),_:1},8,["selectedKeys"])]),default:ue(()=>[ee(N,{class:Me(["mcp-button",{"mcp-button-active":D.value&&D.value.length>0}])},{icon:ue(()=>[ee(le(ut))]),default:ue(()=>[u[11]||(u[11]=Ce(" MCP "))]),_:1},8,["class"])]),_:1})])])]),H.value?(G(),be(N,{key:0,onClick:xe,class:"send-button",disabled:!r.value},{icon:ue(()=>u[13]||(u[13]=[I("svg",{xmlns:"http://www.w3.org/2000/svg",width:"15",height:"15",viewBox:"0 0 16 16",fill:"#fff"},[I("path",{d:"M7.91699 15.0642C7.53125 15.0642 7.22119 14.9397 6.98682 14.6907C6.75244 14.4465 6.63525 14.1218 6.63525 13.7166V6.39966L6.77441 3.34546L7.48486 3.89478L5.62451 6.12134L3.99121 7.76196C3.87402 7.87915 3.73975 7.97681 3.58838 8.05493C3.44189 8.13306 3.271 8.17212 3.07568 8.17212C2.73389 8.17212 2.4458 8.05981 2.21143 7.83521C1.98193 7.60571 1.86719 7.3103 1.86719 6.94897C1.86719 6.60229 1.99902 6.29712 2.2627 6.03345L6.97949 1.30933C7.0918 1.19214 7.2334 1.10181 7.4043 1.03833C7.5752 0.969971 7.74609 0.935791 7.91699 0.935791C8.08789 0.935791 8.25879 0.969971 8.42969 1.03833C8.60059 1.10181 8.74463 1.19214 8.86182 1.30933L13.5786 6.03345C13.8423 6.29712 13.9741 6.60229 13.9741 6.94897C13.9741 7.3103 13.8569 7.60571 13.6226 7.83521C13.3931 8.05981 13.1074 8.17212 12.7656 8.17212C12.5703 8.17212 12.397 8.13306 12.2456 8.05493C12.0991 7.97681 11.9673 7.87915 11.8501 7.76196L10.2095 6.12134L8.34912 3.89478L9.05957 3.34546L9.19141 6.39966V13.7166C9.19141 14.1218 9.07422 14.4465 8.83984 14.6907C8.60547 14.9397 8.29785 15.0642 7.91699 15.0642Z",fill:"var(--icon-onblack)"})],-1)])),_:1},8,["disabled"])):(G(),ne("button",{key:1,class:"stop-button",onClick:e},u[14]||(u[14]=[I("div",null,null,-1)])))])])])])]),(G(),be(rt,{to:"body"},[R.value?(G(),ne("div",{key:0,class:"mobile-modal-overlay",onClick:A},[I("div",{class:"mobile-mode-selector",onClick:u[6]||(u[6]=Re(()=>{},["stop"]))},[I("div",or,[I("h3",null,re(le(f)("lemon.workMode.title")),1),ee(N,{type:"text",onClick:A,class:"close-btn"},{default:ue(()=>[ee(le(Ye))]),_:1})]),I("div",lr,[(G(!0),ne(ke,null,Se(S.value,X=>(G(),ne("div",{key:X.value,class:Me(["option-item",{selected:X.value===b.value}]),onClick:ye=>te(X.value)},[I("div",ur,[I("span",dr,[b.value===X.value?(G(),ne("span",hr)):me("",!0)]),I("div",fr,[I("div",pr,re(X.label),1),I("div",mr,re(X.description),1)])])],10,cr))),128))])])])):me("",!0)])),(G(),be(rt,{to:"body"},[n.value?(G(),ne("div",{key:0,class:"mobile-modal-overlay",onClick:z},[I("div",{class:"mobile-visibility-selector",onClick:u[7]||(u[7]=Re(()=>{},["stop"]))},[I("div",_r,[u[15]||(u[15]=I("h3",null,"Visibility",-1)),ee(N,{type:"text",onClick:z,class:"close-btn"},{default:ue(()=>[ee(le(Ye))]),_:1})]),I("div",vr,[(G(),ne(ke,null,Se($,X=>I("div",{key:X.value,class:Me(["option-item",{selected:X.value===i.value}]),onClick:ye=>K(X.value)},[I("div",wr,[I("span",br,[i.value===X.value?(G(),ne("span",yr)):me("",!0)]),I("div",kr,[I("div",xr,[Ce(re(X.label)+" ",1),X.value?me("",!0):(G(),be(J,{key:0,size:"small",class:"pro-tag-mobile"},{default:ue(()=>u[16]||(u[16]=[Ce("Pro+")])),_:1}))]),I("div",Cr,re(X.desc),1)])])],10,gr)),64))])])])):me("",!0)])),ee(oe,{open:B.value,"onUpdate:open":u[9]||(u[9]=X=>B.value=X),title:w.value,centered:"",width:"1200px",footer:null,onCancel:ce},{default:ue(()=>{var X;return[I("div",Sr,[I("div",Er,[j.value?(G(),ne("span",zr,re(j.value),1)):me("",!0),Q.value?(G(),ne("span",Ar,re(Q.value),1)):me("",!0)]),(X=le(s))!=null&&X.planName?(G(),be(N,{key:0,type:"primary",onClick:u[8]||(u[8]=ye=>v.value=!0)},{default:ue(()=>u[17]||(u[17]=[Ce("Buy credits")])),_:1})):me("",!0)]),ee(Ct,{isWindow:"true",showTitle:"false",onClose_window:ce})]}),_:1},8,["open","title"]),ee(Zs,{open:v.value,"onUpdate:open":u[10]||(u[10]=X=>v.value=X)},null,8,["open"])],64)}}},dt=Ie(Ir,[["__scopeId","data-v-7208c24a"]]),Or={xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",class:"lucide lucide-arrow-down text-[var(--icon-primary)]",viewBox:"0 0 24 24"};function Tr(ae,V){return G(),ne("svg",Or,V[0]||(V[0]=[I("path",{d:"M12 5v14M19 12l-7 7-7-7"},null,-1)]))}const Lr={render:Tr};function Ke(ae){throw new Error('Could not dynamically require "'+ae+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Et={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(ae,V){(function(f){ae.exports=f()})(function(){return function f(O,w,c){function l(m,p){if(!w[m]){if(!O[m]){var g=typeof Ke=="function"&&Ke;if(!p&&g)return g(m,!0);if(s)return s(m,!0);var _=new Error("Cannot find module '"+m+"'");throw _.code="MODULE_NOT_FOUND",_}var r=w[m]={exports:{}};O[m][0].call(r.exports,function(o){var t=O[m][1][o];return l(t||o)},r,r.exports,f,O,w,c)}return w[m].exports}for(var s=typeof Ke=="function"&&Ke,d=0;d<c.length;d++)l(c[d]);return l}({1:[function(f,O,w){var c=f("./utils"),l=f("./support"),s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";w.encode=function(d){for(var m,p,g,_,r,o,t,a=[],i=0,v=d.length,b=v,S=c.getTypeOf(d)!=="string";i<d.length;)b=v-i,g=S?(m=d[i++],p=i<v?d[i++]:0,i<v?d[i++]:0):(m=d.charCodeAt(i++),p=i<v?d.charCodeAt(i++):0,i<v?d.charCodeAt(i++):0),_=m>>2,r=(3&m)<<4|p>>4,o=1<b?(15&p)<<2|g>>6:64,t=2<b?63&g:64,a.push(s.charAt(_)+s.charAt(r)+s.charAt(o)+s.charAt(t));return a.join("")},w.decode=function(d){var m,p,g,_,r,o,t=0,a=0,i="data:";if(d.substr(0,i.length)===i)throw new Error("Invalid base64 input, it looks like a data url.");var v,b=3*(d=d.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(d.charAt(d.length-1)===s.charAt(64)&&b--,d.charAt(d.length-2)===s.charAt(64)&&b--,b%1!=0)throw new Error("Invalid base64 input, bad content length.");for(v=l.uint8array?new Uint8Array(0|b):new Array(0|b);t<d.length;)m=s.indexOf(d.charAt(t++))<<2|(_=s.indexOf(d.charAt(t++)))>>4,p=(15&_)<<4|(r=s.indexOf(d.charAt(t++)))>>2,g=(3&r)<<6|(o=s.indexOf(d.charAt(t++))),v[a++]=m,r!==64&&(v[a++]=p),o!==64&&(v[a++]=g);return v}},{"./support":30,"./utils":32}],2:[function(f,O,w){var c=f("./external"),l=f("./stream/DataWorker"),s=f("./stream/Crc32Probe"),d=f("./stream/DataLengthProbe");function m(p,g,_,r,o){this.compressedSize=p,this.uncompressedSize=g,this.crc32=_,this.compression=r,this.compressedContent=o}m.prototype={getContentWorker:function(){var p=new l(c.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new d("data_length")),g=this;return p.on("end",function(){if(this.streamInfo.data_length!==g.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),p},getCompressedWorker:function(){return new l(c.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},m.createWorkerFrom=function(p,g,_){return p.pipe(new s).pipe(new d("uncompressedSize")).pipe(g.compressWorker(_)).pipe(new d("compressedSize")).withStreamInfo("compression",g)},O.exports=m},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(f,O,w){var c=f("./stream/GenericWorker");w.STORE={magic:"\0\0",compressWorker:function(){return new c("STORE compression")},uncompressWorker:function(){return new c("STORE decompression")}},w.DEFLATE=f("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(f,O,w){var c=f("./utils"),l=function(){for(var s,d=[],m=0;m<256;m++){s=m;for(var p=0;p<8;p++)s=1&s?3988292384^s>>>1:s>>>1;d[m]=s}return d}();O.exports=function(s,d){return s!==void 0&&s.length?c.getTypeOf(s)!=="string"?function(m,p,g,_){var r=l,o=_+g;m^=-1;for(var t=_;t<o;t++)m=m>>>8^r[255&(m^p[t])];return-1^m}(0|d,s,s.length,0):function(m,p,g,_){var r=l,o=_+g;m^=-1;for(var t=_;t<o;t++)m=m>>>8^r[255&(m^p.charCodeAt(t))];return-1^m}(0|d,s,s.length,0):0}},{"./utils":32}],5:[function(f,O,w){w.base64=!1,w.binary=!1,w.dir=!1,w.createFolders=!0,w.date=null,w.compression=null,w.compressionOptions=null,w.comment=null,w.unixPermissions=null,w.dosPermissions=null},{}],6:[function(f,O,w){var c=null;c=typeof Promise<"u"?Promise:f("lie"),O.exports={Promise:c}},{lie:37}],7:[function(f,O,w){var c=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",l=f("pako"),s=f("./utils"),d=f("./stream/GenericWorker"),m=c?"uint8array":"array";function p(g,_){d.call(this,"FlateWorker/"+g),this._pako=null,this._pakoAction=g,this._pakoOptions=_,this.meta={}}w.magic="\b\0",s.inherits(p,d),p.prototype.processChunk=function(g){this.meta=g.meta,this._pako===null&&this._createPako(),this._pako.push(s.transformTo(m,g.data),!1)},p.prototype.flush=function(){d.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},p.prototype.cleanUp=function(){d.prototype.cleanUp.call(this),this._pako=null},p.prototype._createPako=function(){this._pako=new l[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var g=this;this._pako.onData=function(_){g.push({data:_,meta:g.meta})}},w.compressWorker=function(g){return new p("Deflate",g)},w.uncompressWorker=function(){return new p("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(f,O,w){function c(r,o){var t,a="";for(t=0;t<o;t++)a+=String.fromCharCode(255&r),r>>>=8;return a}function l(r,o,t,a,i,v){var b,S,E=r.file,D=r.compression,L=v!==m.utf8encode,$=s.transformTo("string",v(E.name)),B=s.transformTo("string",m.utf8encode(E.name)),j=E.comment,Q=s.transformTo("string",v(j)),y=s.transformTo("string",m.utf8encode(j)),R=B.length!==E.name.length,n=y.length!==j.length,F="",Z="",k="",H=E.dir,M=E.date,q={crc32:0,compressedSize:0,uncompressedSize:0};o&&!t||(q.crc32=r.crc32,q.compressedSize=r.compressedSize,q.uncompressedSize=r.uncompressedSize);var A=0;o&&(A|=8),L||!R&&!n||(A|=2048);var z=0,te=0;H&&(z|=16),i==="UNIX"?(te=798,z|=function(P,he){var ge=P;return P||(ge=he?16893:33204),(65535&ge)<<16}(E.unixPermissions,H)):(te=20,z|=function(P){return 63&(P||0)}(E.dosPermissions)),b=M.getUTCHours(),b<<=6,b|=M.getUTCMinutes(),b<<=5,b|=M.getUTCSeconds()/2,S=M.getUTCFullYear()-1980,S<<=4,S|=M.getUTCMonth()+1,S<<=5,S|=M.getUTCDate(),R&&(Z=c(1,1)+c(p($),4)+B,F+="up"+c(Z.length,2)+Z),n&&(k=c(1,1)+c(p(Q),4)+y,F+="uc"+c(k.length,2)+k);var K="";return K+=`
\0`,K+=c(A,2),K+=D.magic,K+=c(b,2),K+=c(S,2),K+=c(q.crc32,4),K+=c(q.compressedSize,4),K+=c(q.uncompressedSize,4),K+=c($.length,2),K+=c(F.length,2),{fileRecord:g.LOCAL_FILE_HEADER+K+$+F,dirRecord:g.CENTRAL_FILE_HEADER+c(te,2)+K+c(Q.length,2)+"\0\0\0\0"+c(z,4)+c(a,4)+$+F+Q}}var s=f("../utils"),d=f("../stream/GenericWorker"),m=f("../utf8"),p=f("../crc32"),g=f("../signature");function _(r,o,t,a){d.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=o,this.zipPlatform=t,this.encodeFileName=a,this.streamFiles=r,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}s.inherits(_,d),_.prototype.push=function(r){var o=r.meta.percent||0,t=this.entriesCount,a=this._sources.length;this.accumulate?this.contentBuffer.push(r):(this.bytesWritten+=r.data.length,d.prototype.push.call(this,{data:r.data,meta:{currentFile:this.currentFile,percent:t?(o+100*(t-a-1))/t:100}}))},_.prototype.openedSource=function(r){this.currentSourceOffset=this.bytesWritten,this.currentFile=r.file.name;var o=this.streamFiles&&!r.file.dir;if(o){var t=l(r,o,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:t.fileRecord,meta:{percent:0}})}else this.accumulate=!0},_.prototype.closedSource=function(r){this.accumulate=!1;var o=this.streamFiles&&!r.file.dir,t=l(r,o,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(t.dirRecord),o)this.push({data:function(a){return g.DATA_DESCRIPTOR+c(a.crc32,4)+c(a.compressedSize,4)+c(a.uncompressedSize,4)}(r),meta:{percent:100}});else for(this.push({data:t.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},_.prototype.flush=function(){for(var r=this.bytesWritten,o=0;o<this.dirRecords.length;o++)this.push({data:this.dirRecords[o],meta:{percent:100}});var t=this.bytesWritten-r,a=function(i,v,b,S,E){var D=s.transformTo("string",E(S));return g.CENTRAL_DIRECTORY_END+"\0\0\0\0"+c(i,2)+c(i,2)+c(v,4)+c(b,4)+c(D.length,2)+D}(this.dirRecords.length,t,r,this.zipComment,this.encodeFileName);this.push({data:a,meta:{percent:100}})},_.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},_.prototype.registerPrevious=function(r){this._sources.push(r);var o=this;return r.on("data",function(t){o.processChunk(t)}),r.on("end",function(){o.closedSource(o.previous.streamInfo),o._sources.length?o.prepareNextSource():o.end()}),r.on("error",function(t){o.error(t)}),this},_.prototype.resume=function(){return!!d.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},_.prototype.error=function(r){var o=this._sources;if(!d.prototype.error.call(this,r))return!1;for(var t=0;t<o.length;t++)try{o[t].error(r)}catch{}return!0},_.prototype.lock=function(){d.prototype.lock.call(this);for(var r=this._sources,o=0;o<r.length;o++)r[o].lock()},O.exports=_},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(f,O,w){var c=f("../compressions"),l=f("./ZipFileWorker");w.generateWorker=function(s,d,m){var p=new l(d.streamFiles,m,d.platform,d.encodeFileName),g=0;try{s.forEach(function(_,r){g++;var o=function(v,b){var S=v||b,E=c[S];if(!E)throw new Error(S+" is not a valid compression method !");return E}(r.options.compression,d.compression),t=r.options.compressionOptions||d.compressionOptions||{},a=r.dir,i=r.date;r._compressWorker(o,t).withStreamInfo("file",{name:_,dir:a,date:i,comment:r.comment||"",unixPermissions:r.unixPermissions,dosPermissions:r.dosPermissions}).pipe(p)}),p.entriesCount=g}catch(_){p.error(_)}return p}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(f,O,w){function c(){if(!(this instanceof c))return new c;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var l=new c;for(var s in this)typeof this[s]!="function"&&(l[s]=this[s]);return l}}(c.prototype=f("./object")).loadAsync=f("./load"),c.support=f("./support"),c.defaults=f("./defaults"),c.version="3.10.1",c.loadAsync=function(l,s){return new c().loadAsync(l,s)},c.external=f("./external"),O.exports=c},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(f,O,w){var c=f("./utils"),l=f("./external"),s=f("./utf8"),d=f("./zipEntries"),m=f("./stream/Crc32Probe"),p=f("./nodejsUtils");function g(_){return new l.Promise(function(r,o){var t=_.decompressed.getContentWorker().pipe(new m);t.on("error",function(a){o(a)}).on("end",function(){t.streamInfo.crc32!==_.decompressed.crc32?o(new Error("Corrupted zip : CRC32 mismatch")):r()}).resume()})}O.exports=function(_,r){var o=this;return r=c.extend(r||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:s.utf8decode}),p.isNode&&p.isStream(_)?l.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):c.prepareContent("the loaded zip file",_,!0,r.optimizedBinaryString,r.base64).then(function(t){var a=new d(r);return a.load(t),a}).then(function(t){var a=[l.Promise.resolve(t)],i=t.files;if(r.checkCRC32)for(var v=0;v<i.length;v++)a.push(g(i[v]));return l.Promise.all(a)}).then(function(t){for(var a=t.shift(),i=a.files,v=0;v<i.length;v++){var b=i[v],S=b.fileNameStr,E=c.resolve(b.fileNameStr);o.file(E,b.decompressed,{binary:!0,optimizedBinaryString:!0,date:b.date,dir:b.dir,comment:b.fileCommentStr.length?b.fileCommentStr:null,unixPermissions:b.unixPermissions,dosPermissions:b.dosPermissions,createFolders:r.createFolders}),b.dir||(o.file(E).unsafeOriginalName=S)}return a.zipComment.length&&(o.comment=a.zipComment),o})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(f,O,w){var c=f("../utils"),l=f("../stream/GenericWorker");function s(d,m){l.call(this,"Nodejs stream input adapter for "+d),this._upstreamEnded=!1,this._bindStream(m)}c.inherits(s,l),s.prototype._bindStream=function(d){var m=this;(this._stream=d).pause(),d.on("data",function(p){m.push({data:p,meta:{percent:0}})}).on("error",function(p){m.isPaused?this.generatedError=p:m.error(p)}).on("end",function(){m.isPaused?m._upstreamEnded=!0:m.end()})},s.prototype.pause=function(){return!!l.prototype.pause.call(this)&&(this._stream.pause(),!0)},s.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},O.exports=s},{"../stream/GenericWorker":28,"../utils":32}],13:[function(f,O,w){var c=f("readable-stream").Readable;function l(s,d,m){c.call(this,d),this._helper=s;var p=this;s.on("data",function(g,_){p.push(g)||p._helper.pause(),m&&m(_)}).on("error",function(g){p.emit("error",g)}).on("end",function(){p.push(null)})}f("../utils").inherits(l,c),l.prototype._read=function(){this._helper.resume()},O.exports=l},{"../utils":32,"readable-stream":16}],14:[function(f,O,w){O.exports={isNode:typeof Buffer<"u",newBufferFrom:function(c,l){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(c,l);if(typeof c=="number")throw new Error('The "data" argument must not be a number');return new Buffer(c,l)},allocBuffer:function(c){if(Buffer.alloc)return Buffer.alloc(c);var l=new Buffer(c);return l.fill(0),l},isBuffer:function(c){return Buffer.isBuffer(c)},isStream:function(c){return c&&typeof c.on=="function"&&typeof c.pause=="function"&&typeof c.resume=="function"}}},{}],15:[function(f,O,w){function c(E,D,L){var $,B=s.getTypeOf(D),j=s.extend(L||{},p);j.date=j.date||new Date,j.compression!==null&&(j.compression=j.compression.toUpperCase()),typeof j.unixPermissions=="string"&&(j.unixPermissions=parseInt(j.unixPermissions,8)),j.unixPermissions&&16384&j.unixPermissions&&(j.dir=!0),j.dosPermissions&&16&j.dosPermissions&&(j.dir=!0),j.dir&&(E=i(E)),j.createFolders&&($=a(E))&&v.call(this,$,!0);var Q=B==="string"&&j.binary===!1&&j.base64===!1;L&&L.binary!==void 0||(j.binary=!Q),(D instanceof g&&D.uncompressedSize===0||j.dir||!D||D.length===0)&&(j.base64=!1,j.binary=!0,D="",j.compression="STORE",B="string");var y=null;y=D instanceof g||D instanceof d?D:o.isNode&&o.isStream(D)?new t(E,D):s.prepareContent(E,D,j.binary,j.optimizedBinaryString,j.base64);var R=new _(E,y,j);this.files[E]=R}var l=f("./utf8"),s=f("./utils"),d=f("./stream/GenericWorker"),m=f("./stream/StreamHelper"),p=f("./defaults"),g=f("./compressedObject"),_=f("./zipObject"),r=f("./generate"),o=f("./nodejsUtils"),t=f("./nodejs/NodejsStreamInputAdapter"),a=function(E){E.slice(-1)==="/"&&(E=E.substring(0,E.length-1));var D=E.lastIndexOf("/");return 0<D?E.substring(0,D):""},i=function(E){return E.slice(-1)!=="/"&&(E+="/"),E},v=function(E,D){return D=D!==void 0?D:p.createFolders,E=i(E),this.files[E]||c.call(this,E,null,{dir:!0,createFolders:D}),this.files[E]};function b(E){return Object.prototype.toString.call(E)==="[object RegExp]"}var S={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(E){var D,L,$;for(D in this.files)$=this.files[D],(L=D.slice(this.root.length,D.length))&&D.slice(0,this.root.length)===this.root&&E(L,$)},filter:function(E){var D=[];return this.forEach(function(L,$){E(L,$)&&D.push($)}),D},file:function(E,D,L){if(arguments.length!==1)return E=this.root+E,c.call(this,E,D,L),this;if(b(E)){var $=E;return this.filter(function(j,Q){return!Q.dir&&$.test(j)})}var B=this.files[this.root+E];return B&&!B.dir?B:null},folder:function(E){if(!E)return this;if(b(E))return this.filter(function(B,j){return j.dir&&E.test(B)});var D=this.root+E,L=v.call(this,D),$=this.clone();return $.root=L.name,$},remove:function(E){E=this.root+E;var D=this.files[E];if(D||(E.slice(-1)!=="/"&&(E+="/"),D=this.files[E]),D&&!D.dir)delete this.files[E];else for(var L=this.filter(function(B,j){return j.name.slice(0,E.length)===E}),$=0;$<L.length;$++)delete this.files[L[$].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(E){var D,L={};try{if((L=s.extend(E||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:l.utf8encode})).type=L.type.toLowerCase(),L.compression=L.compression.toUpperCase(),L.type==="binarystring"&&(L.type="string"),!L.type)throw new Error("No output type specified.");s.checkSupport(L.type),L.platform!=="darwin"&&L.platform!=="freebsd"&&L.platform!=="linux"&&L.platform!=="sunos"||(L.platform="UNIX"),L.platform==="win32"&&(L.platform="DOS");var $=L.comment||this.comment||"";D=r.generateWorker(this,L,$)}catch(B){(D=new d("error")).error(B)}return new m(D,L.type||"string",L.mimeType)},generateAsync:function(E,D){return this.generateInternalStream(E).accumulate(D)},generateNodeStream:function(E,D){return(E=E||{}).type||(E.type="nodebuffer"),this.generateInternalStream(E).toNodejsStream(D)}};O.exports=S},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(f,O,w){O.exports=f("stream")},{stream:void 0}],17:[function(f,O,w){var c=f("./DataReader");function l(s){c.call(this,s);for(var d=0;d<this.data.length;d++)s[d]=255&s[d]}f("../utils").inherits(l,c),l.prototype.byteAt=function(s){return this.data[this.zero+s]},l.prototype.lastIndexOfSignature=function(s){for(var d=s.charCodeAt(0),m=s.charCodeAt(1),p=s.charCodeAt(2),g=s.charCodeAt(3),_=this.length-4;0<=_;--_)if(this.data[_]===d&&this.data[_+1]===m&&this.data[_+2]===p&&this.data[_+3]===g)return _-this.zero;return-1},l.prototype.readAndCheckSignature=function(s){var d=s.charCodeAt(0),m=s.charCodeAt(1),p=s.charCodeAt(2),g=s.charCodeAt(3),_=this.readData(4);return d===_[0]&&m===_[1]&&p===_[2]&&g===_[3]},l.prototype.readData=function(s){if(this.checkOffset(s),s===0)return[];var d=this.data.slice(this.zero+this.index,this.zero+this.index+s);return this.index+=s,d},O.exports=l},{"../utils":32,"./DataReader":18}],18:[function(f,O,w){var c=f("../utils");function l(s){this.data=s,this.length=s.length,this.index=0,this.zero=0}l.prototype={checkOffset:function(s){this.checkIndex(this.index+s)},checkIndex:function(s){if(this.length<this.zero+s||s<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+s+"). Corrupted zip ?")},setIndex:function(s){this.checkIndex(s),this.index=s},skip:function(s){this.setIndex(this.index+s)},byteAt:function(){},readInt:function(s){var d,m=0;for(this.checkOffset(s),d=this.index+s-1;d>=this.index;d--)m=(m<<8)+this.byteAt(d);return this.index+=s,m},readString:function(s){return c.transformTo("string",this.readData(s))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var s=this.readInt(4);return new Date(Date.UTC(1980+(s>>25&127),(s>>21&15)-1,s>>16&31,s>>11&31,s>>5&63,(31&s)<<1))}},O.exports=l},{"../utils":32}],19:[function(f,O,w){var c=f("./Uint8ArrayReader");function l(s){c.call(this,s)}f("../utils").inherits(l,c),l.prototype.readData=function(s){this.checkOffset(s);var d=this.data.slice(this.zero+this.index,this.zero+this.index+s);return this.index+=s,d},O.exports=l},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(f,O,w){var c=f("./DataReader");function l(s){c.call(this,s)}f("../utils").inherits(l,c),l.prototype.byteAt=function(s){return this.data.charCodeAt(this.zero+s)},l.prototype.lastIndexOfSignature=function(s){return this.data.lastIndexOf(s)-this.zero},l.prototype.readAndCheckSignature=function(s){return s===this.readData(4)},l.prototype.readData=function(s){this.checkOffset(s);var d=this.data.slice(this.zero+this.index,this.zero+this.index+s);return this.index+=s,d},O.exports=l},{"../utils":32,"./DataReader":18}],21:[function(f,O,w){var c=f("./ArrayReader");function l(s){c.call(this,s)}f("../utils").inherits(l,c),l.prototype.readData=function(s){if(this.checkOffset(s),s===0)return new Uint8Array(0);var d=this.data.subarray(this.zero+this.index,this.zero+this.index+s);return this.index+=s,d},O.exports=l},{"../utils":32,"./ArrayReader":17}],22:[function(f,O,w){var c=f("../utils"),l=f("../support"),s=f("./ArrayReader"),d=f("./StringReader"),m=f("./NodeBufferReader"),p=f("./Uint8ArrayReader");O.exports=function(g){var _=c.getTypeOf(g);return c.checkSupport(_),_!=="string"||l.uint8array?_==="nodebuffer"?new m(g):l.uint8array?new p(c.transformTo("uint8array",g)):new s(c.transformTo("array",g)):new d(g)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(f,O,w){w.LOCAL_FILE_HEADER="PK",w.CENTRAL_FILE_HEADER="PK",w.CENTRAL_DIRECTORY_END="PK",w.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",w.ZIP64_CENTRAL_DIRECTORY_END="PK",w.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(f,O,w){var c=f("./GenericWorker"),l=f("../utils");function s(d){c.call(this,"ConvertWorker to "+d),this.destType=d}l.inherits(s,c),s.prototype.processChunk=function(d){this.push({data:l.transformTo(this.destType,d.data),meta:d.meta})},O.exports=s},{"../utils":32,"./GenericWorker":28}],25:[function(f,O,w){var c=f("./GenericWorker"),l=f("../crc32");function s(){c.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}f("../utils").inherits(s,c),s.prototype.processChunk=function(d){this.streamInfo.crc32=l(d.data,this.streamInfo.crc32||0),this.push(d)},O.exports=s},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(f,O,w){var c=f("../utils"),l=f("./GenericWorker");function s(d){l.call(this,"DataLengthProbe for "+d),this.propName=d,this.withStreamInfo(d,0)}c.inherits(s,l),s.prototype.processChunk=function(d){if(d){var m=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=m+d.data.length}l.prototype.processChunk.call(this,d)},O.exports=s},{"../utils":32,"./GenericWorker":28}],27:[function(f,O,w){var c=f("../utils"),l=f("./GenericWorker");function s(d){l.call(this,"DataWorker");var m=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,d.then(function(p){m.dataIsReady=!0,m.data=p,m.max=p&&p.length||0,m.type=c.getTypeOf(p),m.isPaused||m._tickAndRepeat()},function(p){m.error(p)})}c.inherits(s,l),s.prototype.cleanUp=function(){l.prototype.cleanUp.call(this),this.data=null},s.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,c.delay(this._tickAndRepeat,[],this)),!0)},s.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(c.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},s.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var d=null,m=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":d=this.data.substring(this.index,m);break;case"uint8array":d=this.data.subarray(this.index,m);break;case"array":case"nodebuffer":d=this.data.slice(this.index,m)}return this.index=m,this.push({data:d,meta:{percent:this.max?this.index/this.max*100:0}})},O.exports=s},{"../utils":32,"./GenericWorker":28}],28:[function(f,O,w){function c(l){this.name=l||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}c.prototype={push:function(l){this.emit("data",l)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(l){this.emit("error",l)}return!0},error:function(l){return!this.isFinished&&(this.isPaused?this.generatedError=l:(this.isFinished=!0,this.emit("error",l),this.previous&&this.previous.error(l),this.cleanUp()),!0)},on:function(l,s){return this._listeners[l].push(s),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(l,s){if(this._listeners[l])for(var d=0;d<this._listeners[l].length;d++)this._listeners[l][d].call(this,s)},pipe:function(l){return l.registerPrevious(this)},registerPrevious:function(l){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=l.streamInfo,this.mergeStreamInfo(),this.previous=l;var s=this;return l.on("data",function(d){s.processChunk(d)}),l.on("end",function(){s.end()}),l.on("error",function(d){s.error(d)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var l=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),l=!0),this.previous&&this.previous.resume(),!l},flush:function(){},processChunk:function(l){this.push(l)},withStreamInfo:function(l,s){return this.extraStreamInfo[l]=s,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var l in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,l)&&(this.streamInfo[l]=this.extraStreamInfo[l])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var l="Worker "+this.name;return this.previous?this.previous+" -> "+l:l}},O.exports=c},{}],29:[function(f,O,w){var c=f("../utils"),l=f("./ConvertWorker"),s=f("./GenericWorker"),d=f("../base64"),m=f("../support"),p=f("../external"),g=null;if(m.nodestream)try{g=f("../nodejs/NodejsStreamOutputAdapter")}catch{}function _(o,t){return new p.Promise(function(a,i){var v=[],b=o._internalType,S=o._outputType,E=o._mimeType;o.on("data",function(D,L){v.push(D),t&&t(L)}).on("error",function(D){v=[],i(D)}).on("end",function(){try{var D=function(L,$,B){switch(L){case"blob":return c.newBlob(c.transformTo("arraybuffer",$),B);case"base64":return d.encode($);default:return c.transformTo(L,$)}}(S,function(L,$){var B,j=0,Q=null,y=0;for(B=0;B<$.length;B++)y+=$[B].length;switch(L){case"string":return $.join("");case"array":return Array.prototype.concat.apply([],$);case"uint8array":for(Q=new Uint8Array(y),B=0;B<$.length;B++)Q.set($[B],j),j+=$[B].length;return Q;case"nodebuffer":return Buffer.concat($);default:throw new Error("concat : unsupported type '"+L+"'")}}(b,v),E);a(D)}catch(L){i(L)}v=[]}).resume()})}function r(o,t,a){var i=t;switch(t){case"blob":case"arraybuffer":i="uint8array";break;case"base64":i="string"}try{this._internalType=i,this._outputType=t,this._mimeType=a,c.checkSupport(i),this._worker=o.pipe(new l(i)),o.lock()}catch(v){this._worker=new s("error"),this._worker.error(v)}}r.prototype={accumulate:function(o){return _(this,o)},on:function(o,t){var a=this;return o==="data"?this._worker.on(o,function(i){t.call(a,i.data,i.meta)}):this._worker.on(o,function(){c.delay(t,arguments,a)}),this},resume:function(){return c.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(o){if(c.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new g(this,{objectMode:this._outputType!=="nodebuffer"},o)}},O.exports=r},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(f,O,w){if(w.base64=!0,w.array=!0,w.string=!0,w.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",w.nodebuffer=typeof Buffer<"u",w.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")w.blob=!1;else{var c=new ArrayBuffer(0);try{w.blob=new Blob([c],{type:"application/zip"}).size===0}catch{try{var l=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);l.append(c),w.blob=l.getBlob("application/zip").size===0}catch{w.blob=!1}}}try{w.nodestream=!!f("readable-stream").Readable}catch{w.nodestream=!1}},{"readable-stream":16}],31:[function(f,O,w){for(var c=f("./utils"),l=f("./support"),s=f("./nodejsUtils"),d=f("./stream/GenericWorker"),m=new Array(256),p=0;p<256;p++)m[p]=252<=p?6:248<=p?5:240<=p?4:224<=p?3:192<=p?2:1;m[254]=m[254]=1;function g(){d.call(this,"utf-8 decode"),this.leftOver=null}function _(){d.call(this,"utf-8 encode")}w.utf8encode=function(r){return l.nodebuffer?s.newBufferFrom(r,"utf-8"):function(o){var t,a,i,v,b,S=o.length,E=0;for(v=0;v<S;v++)(64512&(a=o.charCodeAt(v)))==55296&&v+1<S&&(64512&(i=o.charCodeAt(v+1)))==56320&&(a=65536+(a-55296<<10)+(i-56320),v++),E+=a<128?1:a<2048?2:a<65536?3:4;for(t=l.uint8array?new Uint8Array(E):new Array(E),v=b=0;b<E;v++)(64512&(a=o.charCodeAt(v)))==55296&&v+1<S&&(64512&(i=o.charCodeAt(v+1)))==56320&&(a=65536+(a-55296<<10)+(i-56320),v++),a<128?t[b++]=a:(a<2048?t[b++]=192|a>>>6:(a<65536?t[b++]=224|a>>>12:(t[b++]=240|a>>>18,t[b++]=128|a>>>12&63),t[b++]=128|a>>>6&63),t[b++]=128|63&a);return t}(r)},w.utf8decode=function(r){return l.nodebuffer?c.transformTo("nodebuffer",r).toString("utf-8"):function(o){var t,a,i,v,b=o.length,S=new Array(2*b);for(t=a=0;t<b;)if((i=o[t++])<128)S[a++]=i;else if(4<(v=m[i]))S[a++]=65533,t+=v-1;else{for(i&=v===2?31:v===3?15:7;1<v&&t<b;)i=i<<6|63&o[t++],v--;1<v?S[a++]=65533:i<65536?S[a++]=i:(i-=65536,S[a++]=55296|i>>10&1023,S[a++]=56320|1023&i)}return S.length!==a&&(S.subarray?S=S.subarray(0,a):S.length=a),c.applyFromCharCode(S)}(r=c.transformTo(l.uint8array?"uint8array":"array",r))},c.inherits(g,d),g.prototype.processChunk=function(r){var o=c.transformTo(l.uint8array?"uint8array":"array",r.data);if(this.leftOver&&this.leftOver.length){if(l.uint8array){var t=o;(o=new Uint8Array(t.length+this.leftOver.length)).set(this.leftOver,0),o.set(t,this.leftOver.length)}else o=this.leftOver.concat(o);this.leftOver=null}var a=function(v,b){var S;for((b=b||v.length)>v.length&&(b=v.length),S=b-1;0<=S&&(192&v[S])==128;)S--;return S<0||S===0?b:S+m[v[S]]>b?S:b}(o),i=o;a!==o.length&&(l.uint8array?(i=o.subarray(0,a),this.leftOver=o.subarray(a,o.length)):(i=o.slice(0,a),this.leftOver=o.slice(a,o.length))),this.push({data:w.utf8decode(i),meta:r.meta})},g.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:w.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},w.Utf8DecodeWorker=g,c.inherits(_,d),_.prototype.processChunk=function(r){this.push({data:w.utf8encode(r.data),meta:r.meta})},w.Utf8EncodeWorker=_},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(f,O,w){var c=f("./support"),l=f("./base64"),s=f("./nodejsUtils"),d=f("./external");function m(t){return t}function p(t,a){for(var i=0;i<t.length;++i)a[i]=255&t.charCodeAt(i);return a}f("setimmediate"),w.newBlob=function(t,a){w.checkSupport("blob");try{return new Blob([t],{type:a})}catch{try{var i=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return i.append(t),i.getBlob(a)}catch{throw new Error("Bug : can't construct the Blob.")}}};var g={stringifyByChunk:function(t,a,i){var v=[],b=0,S=t.length;if(S<=i)return String.fromCharCode.apply(null,t);for(;b<S;)a==="array"||a==="nodebuffer"?v.push(String.fromCharCode.apply(null,t.slice(b,Math.min(b+i,S)))):v.push(String.fromCharCode.apply(null,t.subarray(b,Math.min(b+i,S)))),b+=i;return v.join("")},stringifyByChar:function(t){for(var a="",i=0;i<t.length;i++)a+=String.fromCharCode(t[i]);return a},applyCanBeUsed:{uint8array:function(){try{return c.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return c.nodebuffer&&String.fromCharCode.apply(null,s.allocBuffer(1)).length===1}catch{return!1}}()}};function _(t){var a=65536,i=w.getTypeOf(t),v=!0;if(i==="uint8array"?v=g.applyCanBeUsed.uint8array:i==="nodebuffer"&&(v=g.applyCanBeUsed.nodebuffer),v)for(;1<a;)try{return g.stringifyByChunk(t,i,a)}catch{a=Math.floor(a/2)}return g.stringifyByChar(t)}function r(t,a){for(var i=0;i<t.length;i++)a[i]=t[i];return a}w.applyFromCharCode=_;var o={};o.string={string:m,array:function(t){return p(t,new Array(t.length))},arraybuffer:function(t){return o.string.uint8array(t).buffer},uint8array:function(t){return p(t,new Uint8Array(t.length))},nodebuffer:function(t){return p(t,s.allocBuffer(t.length))}},o.array={string:_,array:m,arraybuffer:function(t){return new Uint8Array(t).buffer},uint8array:function(t){return new Uint8Array(t)},nodebuffer:function(t){return s.newBufferFrom(t)}},o.arraybuffer={string:function(t){return _(new Uint8Array(t))},array:function(t){return r(new Uint8Array(t),new Array(t.byteLength))},arraybuffer:m,uint8array:function(t){return new Uint8Array(t)},nodebuffer:function(t){return s.newBufferFrom(new Uint8Array(t))}},o.uint8array={string:_,array:function(t){return r(t,new Array(t.length))},arraybuffer:function(t){return t.buffer},uint8array:m,nodebuffer:function(t){return s.newBufferFrom(t)}},o.nodebuffer={string:_,array:function(t){return r(t,new Array(t.length))},arraybuffer:function(t){return o.nodebuffer.uint8array(t).buffer},uint8array:function(t){return r(t,new Uint8Array(t.length))},nodebuffer:m},w.transformTo=function(t,a){if(a=a||"",!t)return a;w.checkSupport(t);var i=w.getTypeOf(a);return o[i][t](a)},w.resolve=function(t){for(var a=t.split("/"),i=[],v=0;v<a.length;v++){var b=a[v];b==="."||b===""&&v!==0&&v!==a.length-1||(b===".."?i.pop():i.push(b))}return i.join("/")},w.getTypeOf=function(t){return typeof t=="string"?"string":Object.prototype.toString.call(t)==="[object Array]"?"array":c.nodebuffer&&s.isBuffer(t)?"nodebuffer":c.uint8array&&t instanceof Uint8Array?"uint8array":c.arraybuffer&&t instanceof ArrayBuffer?"arraybuffer":void 0},w.checkSupport=function(t){if(!c[t.toLowerCase()])throw new Error(t+" is not supported by this platform")},w.MAX_VALUE_16BITS=65535,w.MAX_VALUE_32BITS=-1,w.pretty=function(t){var a,i,v="";for(i=0;i<(t||"").length;i++)v+="\\x"+((a=t.charCodeAt(i))<16?"0":"")+a.toString(16).toUpperCase();return v},w.delay=function(t,a,i){setImmediate(function(){t.apply(i||null,a||[])})},w.inherits=function(t,a){function i(){}i.prototype=a.prototype,t.prototype=new i},w.extend=function(){var t,a,i={};for(t=0;t<arguments.length;t++)for(a in arguments[t])Object.prototype.hasOwnProperty.call(arguments[t],a)&&i[a]===void 0&&(i[a]=arguments[t][a]);return i},w.prepareContent=function(t,a,i,v,b){return d.Promise.resolve(a).then(function(S){return c.blob&&(S instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(S))!==-1)&&typeof FileReader<"u"?new d.Promise(function(E,D){var L=new FileReader;L.onload=function($){E($.target.result)},L.onerror=function($){D($.target.error)},L.readAsArrayBuffer(S)}):S}).then(function(S){var E=w.getTypeOf(S);return E?(E==="arraybuffer"?S=w.transformTo("uint8array",S):E==="string"&&(b?S=l.decode(S):i&&v!==!0&&(S=function(D){return p(D,c.uint8array?new Uint8Array(D.length):new Array(D.length))}(S))),S):d.Promise.reject(new Error("Can't read the data of '"+t+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(f,O,w){var c=f("./reader/readerFor"),l=f("./utils"),s=f("./signature"),d=f("./zipEntry"),m=f("./support");function p(g){this.files=[],this.loadOptions=g}p.prototype={checkSignature:function(g){if(!this.reader.readAndCheckSignature(g)){this.reader.index-=4;var _=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+l.pretty(_)+", expected "+l.pretty(g)+")")}},isSignature:function(g,_){var r=this.reader.index;this.reader.setIndex(g);var o=this.reader.readString(4)===_;return this.reader.setIndex(r),o},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var g=this.reader.readData(this.zipCommentLength),_=m.uint8array?"uint8array":"array",r=l.transformTo(_,g);this.zipComment=this.loadOptions.decodeFileName(r)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var g,_,r,o=this.zip64EndOfCentralSize-44;0<o;)g=this.reader.readInt(2),_=this.reader.readInt(4),r=this.reader.readData(_),this.zip64ExtensibleData[g]={id:g,length:_,value:r}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var g,_;for(g=0;g<this.files.length;g++)_=this.files[g],this.reader.setIndex(_.localHeaderOffset),this.checkSignature(s.LOCAL_FILE_HEADER),_.readLocalPart(this.reader),_.handleUTF8(),_.processAttributes()},readCentralDir:function(){var g;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(s.CENTRAL_FILE_HEADER);)(g=new d({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(g);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var g=this.reader.lastIndexOfSignature(s.CENTRAL_DIRECTORY_END);if(g<0)throw this.isSignature(0,s.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(g);var _=g;if(this.checkSignature(s.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===l.MAX_VALUE_16BITS||this.diskWithCentralDirStart===l.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===l.MAX_VALUE_16BITS||this.centralDirRecords===l.MAX_VALUE_16BITS||this.centralDirSize===l.MAX_VALUE_32BITS||this.centralDirOffset===l.MAX_VALUE_32BITS){if(this.zip64=!0,(g=this.reader.lastIndexOfSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(g),this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,s.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(s.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var r=this.centralDirOffset+this.centralDirSize;this.zip64&&(r+=20,r+=12+this.zip64EndOfCentralSize);var o=_-r;if(0<o)this.isSignature(_,s.CENTRAL_FILE_HEADER)||(this.reader.zero=o);else if(o<0)throw new Error("Corrupted zip: missing "+Math.abs(o)+" bytes.")},prepareReader:function(g){this.reader=c(g)},load:function(g){this.prepareReader(g),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},O.exports=p},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(f,O,w){var c=f("./reader/readerFor"),l=f("./utils"),s=f("./compressedObject"),d=f("./crc32"),m=f("./utf8"),p=f("./compressions"),g=f("./support");function _(r,o){this.options=r,this.loadOptions=o}_.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(r){var o,t;if(r.skip(22),this.fileNameLength=r.readInt(2),t=r.readInt(2),this.fileName=r.readData(this.fileNameLength),r.skip(t),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((o=function(a){for(var i in p)if(Object.prototype.hasOwnProperty.call(p,i)&&p[i].magic===a)return p[i];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+l.pretty(this.compressionMethod)+" unknown (inner file : "+l.transformTo("string",this.fileName)+")");this.decompressed=new s(this.compressedSize,this.uncompressedSize,this.crc32,o,r.readData(this.compressedSize))},readCentralPart:function(r){this.versionMadeBy=r.readInt(2),r.skip(2),this.bitFlag=r.readInt(2),this.compressionMethod=r.readString(2),this.date=r.readDate(),this.crc32=r.readInt(4),this.compressedSize=r.readInt(4),this.uncompressedSize=r.readInt(4);var o=r.readInt(2);if(this.extraFieldsLength=r.readInt(2),this.fileCommentLength=r.readInt(2),this.diskNumberStart=r.readInt(2),this.internalFileAttributes=r.readInt(2),this.externalFileAttributes=r.readInt(4),this.localHeaderOffset=r.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");r.skip(o),this.readExtraFields(r),this.parseZIP64ExtraField(r),this.fileComment=r.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var r=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),r==0&&(this.dosPermissions=63&this.externalFileAttributes),r==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var r=c(this.extraFields[1].value);this.uncompressedSize===l.MAX_VALUE_32BITS&&(this.uncompressedSize=r.readInt(8)),this.compressedSize===l.MAX_VALUE_32BITS&&(this.compressedSize=r.readInt(8)),this.localHeaderOffset===l.MAX_VALUE_32BITS&&(this.localHeaderOffset=r.readInt(8)),this.diskNumberStart===l.MAX_VALUE_32BITS&&(this.diskNumberStart=r.readInt(4))}},readExtraFields:function(r){var o,t,a,i=r.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});r.index+4<i;)o=r.readInt(2),t=r.readInt(2),a=r.readData(t),this.extraFields[o]={id:o,length:t,value:a};r.setIndex(i)},handleUTF8:function(){var r=g.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=m.utf8decode(this.fileName),this.fileCommentStr=m.utf8decode(this.fileComment);else{var o=this.findExtraFieldUnicodePath();if(o!==null)this.fileNameStr=o;else{var t=l.transformTo(r,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(t)}var a=this.findExtraFieldUnicodeComment();if(a!==null)this.fileCommentStr=a;else{var i=l.transformTo(r,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(i)}}},findExtraFieldUnicodePath:function(){var r=this.extraFields[28789];if(r){var o=c(r.value);return o.readInt(1)!==1||d(this.fileName)!==o.readInt(4)?null:m.utf8decode(o.readData(r.length-5))}return null},findExtraFieldUnicodeComment:function(){var r=this.extraFields[25461];if(r){var o=c(r.value);return o.readInt(1)!==1||d(this.fileComment)!==o.readInt(4)?null:m.utf8decode(o.readData(r.length-5))}return null}},O.exports=_},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(f,O,w){function c(o,t,a){this.name=o,this.dir=a.dir,this.date=a.date,this.comment=a.comment,this.unixPermissions=a.unixPermissions,this.dosPermissions=a.dosPermissions,this._data=t,this._dataBinary=a.binary,this.options={compression:a.compression,compressionOptions:a.compressionOptions}}var l=f("./stream/StreamHelper"),s=f("./stream/DataWorker"),d=f("./utf8"),m=f("./compressedObject"),p=f("./stream/GenericWorker");c.prototype={internalStream:function(o){var t=null,a="string";try{if(!o)throw new Error("No output type specified.");var i=(a=o.toLowerCase())==="string"||a==="text";a!=="binarystring"&&a!=="text"||(a="string"),t=this._decompressWorker();var v=!this._dataBinary;v&&!i&&(t=t.pipe(new d.Utf8EncodeWorker)),!v&&i&&(t=t.pipe(new d.Utf8DecodeWorker))}catch(b){(t=new p("error")).error(b)}return new l(t,a,"")},async:function(o,t){return this.internalStream(o).accumulate(t)},nodeStream:function(o,t){return this.internalStream(o||"nodebuffer").toNodejsStream(t)},_compressWorker:function(o,t){if(this._data instanceof m&&this._data.compression.magic===o.magic)return this._data.getCompressedWorker();var a=this._decompressWorker();return this._dataBinary||(a=a.pipe(new d.Utf8EncodeWorker)),m.createWorkerFrom(a,o,t)},_decompressWorker:function(){return this._data instanceof m?this._data.getContentWorker():this._data instanceof p?this._data:new s(this._data)}};for(var g=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],_=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},r=0;r<g.length;r++)c.prototype[g[r]]=_;O.exports=c},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(f,O,w){(function(c){var l,s,d=c.MutationObserver||c.WebKitMutationObserver;if(d){var m=0,p=new d(o),g=c.document.createTextNode("");p.observe(g,{characterData:!0}),l=function(){g.data=m=++m%2}}else if(c.setImmediate||c.MessageChannel===void 0)l="document"in c&&"onreadystatechange"in c.document.createElement("script")?function(){var t=c.document.createElement("script");t.onreadystatechange=function(){o(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},c.document.documentElement.appendChild(t)}:function(){setTimeout(o,0)};else{var _=new c.MessageChannel;_.port1.onmessage=o,l=function(){_.port2.postMessage(0)}}var r=[];function o(){var t,a;s=!0;for(var i=r.length;i;){for(a=r,r=[],t=-1;++t<i;)a[t]();i=r.length}s=!1}O.exports=function(t){r.push(t)!==1||s||l()}}).call(this,typeof Le<"u"?Le:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(f,O,w){var c=f("immediate");function l(){}var s={},d=["REJECTED"],m=["FULFILLED"],p=["PENDING"];function g(i){if(typeof i!="function")throw new TypeError("resolver must be a function");this.state=p,this.queue=[],this.outcome=void 0,i!==l&&t(this,i)}function _(i,v,b){this.promise=i,typeof v=="function"&&(this.onFulfilled=v,this.callFulfilled=this.otherCallFulfilled),typeof b=="function"&&(this.onRejected=b,this.callRejected=this.otherCallRejected)}function r(i,v,b){c(function(){var S;try{S=v(b)}catch(E){return s.reject(i,E)}S===i?s.reject(i,new TypeError("Cannot resolve promise with itself")):s.resolve(i,S)})}function o(i){var v=i&&i.then;if(i&&(typeof i=="object"||typeof i=="function")&&typeof v=="function")return function(){v.apply(i,arguments)}}function t(i,v){var b=!1;function S(L){b||(b=!0,s.reject(i,L))}function E(L){b||(b=!0,s.resolve(i,L))}var D=a(function(){v(E,S)});D.status==="error"&&S(D.value)}function a(i,v){var b={};try{b.value=i(v),b.status="success"}catch(S){b.status="error",b.value=S}return b}(O.exports=g).prototype.finally=function(i){if(typeof i!="function")return this;var v=this.constructor;return this.then(function(b){return v.resolve(i()).then(function(){return b})},function(b){return v.resolve(i()).then(function(){throw b})})},g.prototype.catch=function(i){return this.then(null,i)},g.prototype.then=function(i,v){if(typeof i!="function"&&this.state===m||typeof v!="function"&&this.state===d)return this;var b=new this.constructor(l);return this.state!==p?r(b,this.state===m?i:v,this.outcome):this.queue.push(new _(b,i,v)),b},_.prototype.callFulfilled=function(i){s.resolve(this.promise,i)},_.prototype.otherCallFulfilled=function(i){r(this.promise,this.onFulfilled,i)},_.prototype.callRejected=function(i){s.reject(this.promise,i)},_.prototype.otherCallRejected=function(i){r(this.promise,this.onRejected,i)},s.resolve=function(i,v){var b=a(o,v);if(b.status==="error")return s.reject(i,b.value);var S=b.value;if(S)t(i,S);else{i.state=m,i.outcome=v;for(var E=-1,D=i.queue.length;++E<D;)i.queue[E].callFulfilled(v)}return i},s.reject=function(i,v){i.state=d,i.outcome=v;for(var b=-1,S=i.queue.length;++b<S;)i.queue[b].callRejected(v);return i},g.resolve=function(i){return i instanceof this?i:s.resolve(new this(l),i)},g.reject=function(i){var v=new this(l);return s.reject(v,i)},g.all=function(i){var v=this;if(Object.prototype.toString.call(i)!=="[object Array]")return this.reject(new TypeError("must be an array"));var b=i.length,S=!1;if(!b)return this.resolve([]);for(var E=new Array(b),D=0,L=-1,$=new this(l);++L<b;)B(i[L],L);return $;function B(j,Q){v.resolve(j).then(function(y){E[Q]=y,++D!==b||S||(S=!0,s.resolve($,E))},function(y){S||(S=!0,s.reject($,y))})}},g.race=function(i){var v=this;if(Object.prototype.toString.call(i)!=="[object Array]")return this.reject(new TypeError("must be an array"));var b=i.length,S=!1;if(!b)return this.resolve([]);for(var E=-1,D=new this(l);++E<b;)L=i[E],v.resolve(L).then(function($){S||(S=!0,s.resolve(D,$))},function($){S||(S=!0,s.reject(D,$))});var L;return D}},{immediate:36}],38:[function(f,O,w){var c={};(0,f("./lib/utils/common").assign)(c,f("./lib/deflate"),f("./lib/inflate"),f("./lib/zlib/constants")),O.exports=c},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(f,O,w){var c=f("./zlib/deflate"),l=f("./utils/common"),s=f("./utils/strings"),d=f("./zlib/messages"),m=f("./zlib/zstream"),p=Object.prototype.toString,g=0,_=-1,r=0,o=8;function t(i){if(!(this instanceof t))return new t(i);this.options=l.assign({level:_,method:o,chunkSize:16384,windowBits:15,memLevel:8,strategy:r,to:""},i||{});var v=this.options;v.raw&&0<v.windowBits?v.windowBits=-v.windowBits:v.gzip&&0<v.windowBits&&v.windowBits<16&&(v.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new m,this.strm.avail_out=0;var b=c.deflateInit2(this.strm,v.level,v.method,v.windowBits,v.memLevel,v.strategy);if(b!==g)throw new Error(d[b]);if(v.header&&c.deflateSetHeader(this.strm,v.header),v.dictionary){var S;if(S=typeof v.dictionary=="string"?s.string2buf(v.dictionary):p.call(v.dictionary)==="[object ArrayBuffer]"?new Uint8Array(v.dictionary):v.dictionary,(b=c.deflateSetDictionary(this.strm,S))!==g)throw new Error(d[b]);this._dict_set=!0}}function a(i,v){var b=new t(v);if(b.push(i,!0),b.err)throw b.msg||d[b.err];return b.result}t.prototype.push=function(i,v){var b,S,E=this.strm,D=this.options.chunkSize;if(this.ended)return!1;S=v===~~v?v:v===!0?4:0,typeof i=="string"?E.input=s.string2buf(i):p.call(i)==="[object ArrayBuffer]"?E.input=new Uint8Array(i):E.input=i,E.next_in=0,E.avail_in=E.input.length;do{if(E.avail_out===0&&(E.output=new l.Buf8(D),E.next_out=0,E.avail_out=D),(b=c.deflate(E,S))!==1&&b!==g)return this.onEnd(b),!(this.ended=!0);E.avail_out!==0&&(E.avail_in!==0||S!==4&&S!==2)||(this.options.to==="string"?this.onData(s.buf2binstring(l.shrinkBuf(E.output,E.next_out))):this.onData(l.shrinkBuf(E.output,E.next_out)))}while((0<E.avail_in||E.avail_out===0)&&b!==1);return S===4?(b=c.deflateEnd(this.strm),this.onEnd(b),this.ended=!0,b===g):S!==2||(this.onEnd(g),!(E.avail_out=0))},t.prototype.onData=function(i){this.chunks.push(i)},t.prototype.onEnd=function(i){i===g&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=l.flattenChunks(this.chunks)),this.chunks=[],this.err=i,this.msg=this.strm.msg},w.Deflate=t,w.deflate=a,w.deflateRaw=function(i,v){return(v=v||{}).raw=!0,a(i,v)},w.gzip=function(i,v){return(v=v||{}).gzip=!0,a(i,v)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(f,O,w){var c=f("./zlib/inflate"),l=f("./utils/common"),s=f("./utils/strings"),d=f("./zlib/constants"),m=f("./zlib/messages"),p=f("./zlib/zstream"),g=f("./zlib/gzheader"),_=Object.prototype.toString;function r(t){if(!(this instanceof r))return new r(t);this.options=l.assign({chunkSize:16384,windowBits:0,to:""},t||{});var a=this.options;a.raw&&0<=a.windowBits&&a.windowBits<16&&(a.windowBits=-a.windowBits,a.windowBits===0&&(a.windowBits=-15)),!(0<=a.windowBits&&a.windowBits<16)||t&&t.windowBits||(a.windowBits+=32),15<a.windowBits&&a.windowBits<48&&!(15&a.windowBits)&&(a.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new p,this.strm.avail_out=0;var i=c.inflateInit2(this.strm,a.windowBits);if(i!==d.Z_OK)throw new Error(m[i]);this.header=new g,c.inflateGetHeader(this.strm,this.header)}function o(t,a){var i=new r(a);if(i.push(t,!0),i.err)throw i.msg||m[i.err];return i.result}r.prototype.push=function(t,a){var i,v,b,S,E,D,L=this.strm,$=this.options.chunkSize,B=this.options.dictionary,j=!1;if(this.ended)return!1;v=a===~~a?a:a===!0?d.Z_FINISH:d.Z_NO_FLUSH,typeof t=="string"?L.input=s.binstring2buf(t):_.call(t)==="[object ArrayBuffer]"?L.input=new Uint8Array(t):L.input=t,L.next_in=0,L.avail_in=L.input.length;do{if(L.avail_out===0&&(L.output=new l.Buf8($),L.next_out=0,L.avail_out=$),(i=c.inflate(L,d.Z_NO_FLUSH))===d.Z_NEED_DICT&&B&&(D=typeof B=="string"?s.string2buf(B):_.call(B)==="[object ArrayBuffer]"?new Uint8Array(B):B,i=c.inflateSetDictionary(this.strm,D)),i===d.Z_BUF_ERROR&&j===!0&&(i=d.Z_OK,j=!1),i!==d.Z_STREAM_END&&i!==d.Z_OK)return this.onEnd(i),!(this.ended=!0);L.next_out&&(L.avail_out!==0&&i!==d.Z_STREAM_END&&(L.avail_in!==0||v!==d.Z_FINISH&&v!==d.Z_SYNC_FLUSH)||(this.options.to==="string"?(b=s.utf8border(L.output,L.next_out),S=L.next_out-b,E=s.buf2string(L.output,b),L.next_out=S,L.avail_out=$-S,S&&l.arraySet(L.output,L.output,b,S,0),this.onData(E)):this.onData(l.shrinkBuf(L.output,L.next_out)))),L.avail_in===0&&L.avail_out===0&&(j=!0)}while((0<L.avail_in||L.avail_out===0)&&i!==d.Z_STREAM_END);return i===d.Z_STREAM_END&&(v=d.Z_FINISH),v===d.Z_FINISH?(i=c.inflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===d.Z_OK):v!==d.Z_SYNC_FLUSH||(this.onEnd(d.Z_OK),!(L.avail_out=0))},r.prototype.onData=function(t){this.chunks.push(t)},r.prototype.onEnd=function(t){t===d.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=l.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},w.Inflate=r,w.inflate=o,w.inflateRaw=function(t,a){return(a=a||{}).raw=!0,o(t,a)},w.ungzip=o},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(f,O,w){var c=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";w.assign=function(d){for(var m=Array.prototype.slice.call(arguments,1);m.length;){var p=m.shift();if(p){if(typeof p!="object")throw new TypeError(p+"must be non-object");for(var g in p)p.hasOwnProperty(g)&&(d[g]=p[g])}}return d},w.shrinkBuf=function(d,m){return d.length===m?d:d.subarray?d.subarray(0,m):(d.length=m,d)};var l={arraySet:function(d,m,p,g,_){if(m.subarray&&d.subarray)d.set(m.subarray(p,p+g),_);else for(var r=0;r<g;r++)d[_+r]=m[p+r]},flattenChunks:function(d){var m,p,g,_,r,o;for(m=g=0,p=d.length;m<p;m++)g+=d[m].length;for(o=new Uint8Array(g),m=_=0,p=d.length;m<p;m++)r=d[m],o.set(r,_),_+=r.length;return o}},s={arraySet:function(d,m,p,g,_){for(var r=0;r<g;r++)d[_+r]=m[p+r]},flattenChunks:function(d){return[].concat.apply([],d)}};w.setTyped=function(d){d?(w.Buf8=Uint8Array,w.Buf16=Uint16Array,w.Buf32=Int32Array,w.assign(w,l)):(w.Buf8=Array,w.Buf16=Array,w.Buf32=Array,w.assign(w,s))},w.setTyped(c)},{}],42:[function(f,O,w){var c=f("./common"),l=!0,s=!0;try{String.fromCharCode.apply(null,[0])}catch{l=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{s=!1}for(var d=new c.Buf8(256),m=0;m<256;m++)d[m]=252<=m?6:248<=m?5:240<=m?4:224<=m?3:192<=m?2:1;function p(g,_){if(_<65537&&(g.subarray&&s||!g.subarray&&l))return String.fromCharCode.apply(null,c.shrinkBuf(g,_));for(var r="",o=0;o<_;o++)r+=String.fromCharCode(g[o]);return r}d[254]=d[254]=1,w.string2buf=function(g){var _,r,o,t,a,i=g.length,v=0;for(t=0;t<i;t++)(64512&(r=g.charCodeAt(t)))==55296&&t+1<i&&(64512&(o=g.charCodeAt(t+1)))==56320&&(r=65536+(r-55296<<10)+(o-56320),t++),v+=r<128?1:r<2048?2:r<65536?3:4;for(_=new c.Buf8(v),t=a=0;a<v;t++)(64512&(r=g.charCodeAt(t)))==55296&&t+1<i&&(64512&(o=g.charCodeAt(t+1)))==56320&&(r=65536+(r-55296<<10)+(o-56320),t++),r<128?_[a++]=r:(r<2048?_[a++]=192|r>>>6:(r<65536?_[a++]=224|r>>>12:(_[a++]=240|r>>>18,_[a++]=128|r>>>12&63),_[a++]=128|r>>>6&63),_[a++]=128|63&r);return _},w.buf2binstring=function(g){return p(g,g.length)},w.binstring2buf=function(g){for(var _=new c.Buf8(g.length),r=0,o=_.length;r<o;r++)_[r]=g.charCodeAt(r);return _},w.buf2string=function(g,_){var r,o,t,a,i=_||g.length,v=new Array(2*i);for(r=o=0;r<i;)if((t=g[r++])<128)v[o++]=t;else if(4<(a=d[t]))v[o++]=65533,r+=a-1;else{for(t&=a===2?31:a===3?15:7;1<a&&r<i;)t=t<<6|63&g[r++],a--;1<a?v[o++]=65533:t<65536?v[o++]=t:(t-=65536,v[o++]=55296|t>>10&1023,v[o++]=56320|1023&t)}return p(v,o)},w.utf8border=function(g,_){var r;for((_=_||g.length)>g.length&&(_=g.length),r=_-1;0<=r&&(192&g[r])==128;)r--;return r<0||r===0?_:r+d[g[r]]>_?r:_}},{"./common":41}],43:[function(f,O,w){O.exports=function(c,l,s,d){for(var m=65535&c|0,p=c>>>16&65535|0,g=0;s!==0;){for(s-=g=2e3<s?2e3:s;p=p+(m=m+l[d++]|0)|0,--g;);m%=65521,p%=65521}return m|p<<16|0}},{}],44:[function(f,O,w){O.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(f,O,w){var c=function(){for(var l,s=[],d=0;d<256;d++){l=d;for(var m=0;m<8;m++)l=1&l?3988292384^l>>>1:l>>>1;s[d]=l}return s}();O.exports=function(l,s,d,m){var p=c,g=m+d;l^=-1;for(var _=m;_<g;_++)l=l>>>8^p[255&(l^s[_])];return-1^l}},{}],46:[function(f,O,w){var c,l=f("../utils/common"),s=f("./trees"),d=f("./adler32"),m=f("./crc32"),p=f("./messages"),g=0,_=4,r=0,o=-2,t=-1,a=4,i=2,v=8,b=9,S=286,E=30,D=19,L=2*S+1,$=15,B=3,j=258,Q=j+B+1,y=42,R=113,n=1,F=2,Z=3,k=4;function H(e,U){return e.msg=p[U],U}function M(e){return(e<<1)-(4<e?9:0)}function q(e){for(var U=e.length;0<=--U;)e[U]=0}function A(e){var U=e.state,x=U.pending;x>e.avail_out&&(x=e.avail_out),x!==0&&(l.arraySet(e.output,U.pending_buf,U.pending_out,x,e.next_out),e.next_out+=x,U.pending_out+=x,e.total_out+=x,e.avail_out-=x,U.pending-=x,U.pending===0&&(U.pending_out=0))}function z(e,U){s._tr_flush_block(e,0<=e.block_start?e.block_start:-1,e.strstart-e.block_start,U),e.block_start=e.strstart,A(e.strm)}function te(e,U){e.pending_buf[e.pending++]=U}function K(e,U){e.pending_buf[e.pending++]=U>>>8&255,e.pending_buf[e.pending++]=255&U}function P(e,U){var x,u,h=e.max_chain_length,C=e.strstart,N=e.prev_length,W=e.nice_match,T=e.strstart>e.w_size-Q?e.strstart-(e.w_size-Q):0,Y=e.window,se=e.w_mask,J=e.prev,oe=e.strstart+j,fe=Y[C+N-1],X=Y[C+N];e.prev_length>=e.good_match&&(h>>=2),W>e.lookahead&&(W=e.lookahead);do if(Y[(x=U)+N]===X&&Y[x+N-1]===fe&&Y[x]===Y[C]&&Y[++x]===Y[C+1]){C+=2,x++;do;while(Y[++C]===Y[++x]&&Y[++C]===Y[++x]&&Y[++C]===Y[++x]&&Y[++C]===Y[++x]&&Y[++C]===Y[++x]&&Y[++C]===Y[++x]&&Y[++C]===Y[++x]&&Y[++C]===Y[++x]&&C<oe);if(u=j-(oe-C),C=oe-j,N<u){if(e.match_start=U,W<=(N=u))break;fe=Y[C+N-1],X=Y[C+N]}}while((U=J[U&se])>T&&--h!=0);return N<=e.lookahead?N:e.lookahead}function he(e){var U,x,u,h,C,N,W,T,Y,se,J=e.w_size;do{if(h=e.window_size-e.lookahead-e.strstart,e.strstart>=J+(J-Q)){for(l.arraySet(e.window,e.window,J,J,0),e.match_start-=J,e.strstart-=J,e.block_start-=J,U=x=e.hash_size;u=e.head[--U],e.head[U]=J<=u?u-J:0,--x;);for(U=x=J;u=e.prev[--U],e.prev[U]=J<=u?u-J:0,--x;);h+=J}if(e.strm.avail_in===0)break;if(N=e.strm,W=e.window,T=e.strstart+e.lookahead,Y=h,se=void 0,se=N.avail_in,Y<se&&(se=Y),x=se===0?0:(N.avail_in-=se,l.arraySet(W,N.input,N.next_in,se,T),N.state.wrap===1?N.adler=d(N.adler,W,se,T):N.state.wrap===2&&(N.adler=m(N.adler,W,se,T)),N.next_in+=se,N.total_in+=se,se),e.lookahead+=x,e.lookahead+e.insert>=B)for(C=e.strstart-e.insert,e.ins_h=e.window[C],e.ins_h=(e.ins_h<<e.hash_shift^e.window[C+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[C+B-1])&e.hash_mask,e.prev[C&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=C,C++,e.insert--,!(e.lookahead+e.insert<B)););}while(e.lookahead<Q&&e.strm.avail_in!==0)}function ge(e,U){for(var x,u;;){if(e.lookahead<Q){if(he(e),e.lookahead<Q&&U===g)return n;if(e.lookahead===0)break}if(x=0,e.lookahead>=B&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+B-1])&e.hash_mask,x=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),x!==0&&e.strstart-x<=e.w_size-Q&&(e.match_length=P(e,x)),e.match_length>=B)if(u=s._tr_tally(e,e.strstart-e.match_start,e.match_length-B),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=B){for(e.match_length--;e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+B-1])&e.hash_mask,x=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart,--e.match_length!=0;);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else u=s._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(u&&(z(e,!1),e.strm.avail_out===0))return n}return e.insert=e.strstart<B-1?e.strstart:B-1,U===_?(z(e,!0),e.strm.avail_out===0?Z:k):e.last_lit&&(z(e,!1),e.strm.avail_out===0)?n:F}function ce(e,U){for(var x,u,h;;){if(e.lookahead<Q){if(he(e),e.lookahead<Q&&U===g)return n;if(e.lookahead===0)break}if(x=0,e.lookahead>=B&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+B-1])&e.hash_mask,x=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=B-1,x!==0&&e.prev_length<e.max_lazy_match&&e.strstart-x<=e.w_size-Q&&(e.match_length=P(e,x),e.match_length<=5&&(e.strategy===1||e.match_length===B&&4096<e.strstart-e.match_start)&&(e.match_length=B-1)),e.prev_length>=B&&e.match_length<=e.prev_length){for(h=e.strstart+e.lookahead-B,u=s._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-B),e.lookahead-=e.prev_length-1,e.prev_length-=2;++e.strstart<=h&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+B-1])&e.hash_mask,x=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),--e.prev_length!=0;);if(e.match_available=0,e.match_length=B-1,e.strstart++,u&&(z(e,!1),e.strm.avail_out===0))return n}else if(e.match_available){if((u=s._tr_tally(e,0,e.window[e.strstart-1]))&&z(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return n}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(u=s._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<B-1?e.strstart:B-1,U===_?(z(e,!0),e.strm.avail_out===0?Z:k):e.last_lit&&(z(e,!1),e.strm.avail_out===0)?n:F}function de(e,U,x,u,h){this.good_length=e,this.max_lazy=U,this.nice_length=x,this.max_chain=u,this.func=h}function ve(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=v,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new l.Buf16(2*L),this.dyn_dtree=new l.Buf16(2*(2*E+1)),this.bl_tree=new l.Buf16(2*(2*D+1)),q(this.dyn_ltree),q(this.dyn_dtree),q(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new l.Buf16($+1),this.heap=new l.Buf16(2*S+1),q(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new l.Buf16(2*S+1),q(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function pe(e){var U;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=i,(U=e.state).pending=0,U.pending_out=0,U.wrap<0&&(U.wrap=-U.wrap),U.status=U.wrap?y:R,e.adler=U.wrap===2?0:1,U.last_flush=g,s._tr_init(U),r):H(e,o)}function ze(e){var U=pe(e);return U===r&&function(x){x.window_size=2*x.w_size,q(x.head),x.max_lazy_match=c[x.level].max_lazy,x.good_match=c[x.level].good_length,x.nice_match=c[x.level].nice_length,x.max_chain_length=c[x.level].max_chain,x.strstart=0,x.block_start=0,x.lookahead=0,x.insert=0,x.match_length=x.prev_length=B-1,x.match_available=0,x.ins_h=0}(e.state),U}function xe(e,U,x,u,h,C){if(!e)return o;var N=1;if(U===t&&(U=6),u<0?(N=0,u=-u):15<u&&(N=2,u-=16),h<1||b<h||x!==v||u<8||15<u||U<0||9<U||C<0||a<C)return H(e,o);u===8&&(u=9);var W=new ve;return(e.state=W).strm=e,W.wrap=N,W.gzhead=null,W.w_bits=u,W.w_size=1<<W.w_bits,W.w_mask=W.w_size-1,W.hash_bits=h+7,W.hash_size=1<<W.hash_bits,W.hash_mask=W.hash_size-1,W.hash_shift=~~((W.hash_bits+B-1)/B),W.window=new l.Buf8(2*W.w_size),W.head=new l.Buf16(W.hash_size),W.prev=new l.Buf16(W.w_size),W.lit_bufsize=1<<h+6,W.pending_buf_size=4*W.lit_bufsize,W.pending_buf=new l.Buf8(W.pending_buf_size),W.d_buf=1*W.lit_bufsize,W.l_buf=3*W.lit_bufsize,W.level=U,W.strategy=C,W.method=x,ze(e)}c=[new de(0,0,0,0,function(e,U){var x=65535;for(x>e.pending_buf_size-5&&(x=e.pending_buf_size-5);;){if(e.lookahead<=1){if(he(e),e.lookahead===0&&U===g)return n;if(e.lookahead===0)break}e.strstart+=e.lookahead,e.lookahead=0;var u=e.block_start+x;if((e.strstart===0||e.strstart>=u)&&(e.lookahead=e.strstart-u,e.strstart=u,z(e,!1),e.strm.avail_out===0)||e.strstart-e.block_start>=e.w_size-Q&&(z(e,!1),e.strm.avail_out===0))return n}return e.insert=0,U===_?(z(e,!0),e.strm.avail_out===0?Z:k):(e.strstart>e.block_start&&(z(e,!1),e.strm.avail_out),n)}),new de(4,4,8,4,ge),new de(4,5,16,8,ge),new de(4,6,32,32,ge),new de(4,4,16,16,ce),new de(8,16,32,32,ce),new de(8,16,128,128,ce),new de(8,32,128,256,ce),new de(32,128,258,1024,ce),new de(32,258,258,4096,ce)],w.deflateInit=function(e,U){return xe(e,U,v,15,8,0)},w.deflateInit2=xe,w.deflateReset=ze,w.deflateResetKeep=pe,w.deflateSetHeader=function(e,U){return e&&e.state?e.state.wrap!==2?o:(e.state.gzhead=U,r):o},w.deflate=function(e,U){var x,u,h,C;if(!e||!e.state||5<U||U<0)return e?H(e,o):o;if(u=e.state,!e.output||!e.input&&e.avail_in!==0||u.status===666&&U!==_)return H(e,e.avail_out===0?-5:o);if(u.strm=e,x=u.last_flush,u.last_flush=U,u.status===y)if(u.wrap===2)e.adler=0,te(u,31),te(u,139),te(u,8),u.gzhead?(te(u,(u.gzhead.text?1:0)+(u.gzhead.hcrc?2:0)+(u.gzhead.extra?4:0)+(u.gzhead.name?8:0)+(u.gzhead.comment?16:0)),te(u,255&u.gzhead.time),te(u,u.gzhead.time>>8&255),te(u,u.gzhead.time>>16&255),te(u,u.gzhead.time>>24&255),te(u,u.level===9?2:2<=u.strategy||u.level<2?4:0),te(u,255&u.gzhead.os),u.gzhead.extra&&u.gzhead.extra.length&&(te(u,255&u.gzhead.extra.length),te(u,u.gzhead.extra.length>>8&255)),u.gzhead.hcrc&&(e.adler=m(e.adler,u.pending_buf,u.pending,0)),u.gzindex=0,u.status=69):(te(u,0),te(u,0),te(u,0),te(u,0),te(u,0),te(u,u.level===9?2:2<=u.strategy||u.level<2?4:0),te(u,3),u.status=R);else{var N=v+(u.w_bits-8<<4)<<8;N|=(2<=u.strategy||u.level<2?0:u.level<6?1:u.level===6?2:3)<<6,u.strstart!==0&&(N|=32),N+=31-N%31,u.status=R,K(u,N),u.strstart!==0&&(K(u,e.adler>>>16),K(u,65535&e.adler)),e.adler=1}if(u.status===69)if(u.gzhead.extra){for(h=u.pending;u.gzindex<(65535&u.gzhead.extra.length)&&(u.pending!==u.pending_buf_size||(u.gzhead.hcrc&&u.pending>h&&(e.adler=m(e.adler,u.pending_buf,u.pending-h,h)),A(e),h=u.pending,u.pending!==u.pending_buf_size));)te(u,255&u.gzhead.extra[u.gzindex]),u.gzindex++;u.gzhead.hcrc&&u.pending>h&&(e.adler=m(e.adler,u.pending_buf,u.pending-h,h)),u.gzindex===u.gzhead.extra.length&&(u.gzindex=0,u.status=73)}else u.status=73;if(u.status===73)if(u.gzhead.name){h=u.pending;do{if(u.pending===u.pending_buf_size&&(u.gzhead.hcrc&&u.pending>h&&(e.adler=m(e.adler,u.pending_buf,u.pending-h,h)),A(e),h=u.pending,u.pending===u.pending_buf_size)){C=1;break}C=u.gzindex<u.gzhead.name.length?255&u.gzhead.name.charCodeAt(u.gzindex++):0,te(u,C)}while(C!==0);u.gzhead.hcrc&&u.pending>h&&(e.adler=m(e.adler,u.pending_buf,u.pending-h,h)),C===0&&(u.gzindex=0,u.status=91)}else u.status=91;if(u.status===91)if(u.gzhead.comment){h=u.pending;do{if(u.pending===u.pending_buf_size&&(u.gzhead.hcrc&&u.pending>h&&(e.adler=m(e.adler,u.pending_buf,u.pending-h,h)),A(e),h=u.pending,u.pending===u.pending_buf_size)){C=1;break}C=u.gzindex<u.gzhead.comment.length?255&u.gzhead.comment.charCodeAt(u.gzindex++):0,te(u,C)}while(C!==0);u.gzhead.hcrc&&u.pending>h&&(e.adler=m(e.adler,u.pending_buf,u.pending-h,h)),C===0&&(u.status=103)}else u.status=103;if(u.status===103&&(u.gzhead.hcrc?(u.pending+2>u.pending_buf_size&&A(e),u.pending+2<=u.pending_buf_size&&(te(u,255&e.adler),te(u,e.adler>>8&255),e.adler=0,u.status=R)):u.status=R),u.pending!==0){if(A(e),e.avail_out===0)return u.last_flush=-1,r}else if(e.avail_in===0&&M(U)<=M(x)&&U!==_)return H(e,-5);if(u.status===666&&e.avail_in!==0)return H(e,-5);if(e.avail_in!==0||u.lookahead!==0||U!==g&&u.status!==666){var W=u.strategy===2?function(T,Y){for(var se;;){if(T.lookahead===0&&(he(T),T.lookahead===0)){if(Y===g)return n;break}if(T.match_length=0,se=s._tr_tally(T,0,T.window[T.strstart]),T.lookahead--,T.strstart++,se&&(z(T,!1),T.strm.avail_out===0))return n}return T.insert=0,Y===_?(z(T,!0),T.strm.avail_out===0?Z:k):T.last_lit&&(z(T,!1),T.strm.avail_out===0)?n:F}(u,U):u.strategy===3?function(T,Y){for(var se,J,oe,fe,X=T.window;;){if(T.lookahead<=j){if(he(T),T.lookahead<=j&&Y===g)return n;if(T.lookahead===0)break}if(T.match_length=0,T.lookahead>=B&&0<T.strstart&&(J=X[oe=T.strstart-1])===X[++oe]&&J===X[++oe]&&J===X[++oe]){fe=T.strstart+j;do;while(J===X[++oe]&&J===X[++oe]&&J===X[++oe]&&J===X[++oe]&&J===X[++oe]&&J===X[++oe]&&J===X[++oe]&&J===X[++oe]&&oe<fe);T.match_length=j-(fe-oe),T.match_length>T.lookahead&&(T.match_length=T.lookahead)}if(T.match_length>=B?(se=s._tr_tally(T,1,T.match_length-B),T.lookahead-=T.match_length,T.strstart+=T.match_length,T.match_length=0):(se=s._tr_tally(T,0,T.window[T.strstart]),T.lookahead--,T.strstart++),se&&(z(T,!1),T.strm.avail_out===0))return n}return T.insert=0,Y===_?(z(T,!0),T.strm.avail_out===0?Z:k):T.last_lit&&(z(T,!1),T.strm.avail_out===0)?n:F}(u,U):c[u.level].func(u,U);if(W!==Z&&W!==k||(u.status=666),W===n||W===Z)return e.avail_out===0&&(u.last_flush=-1),r;if(W===F&&(U===1?s._tr_align(u):U!==5&&(s._tr_stored_block(u,0,0,!1),U===3&&(q(u.head),u.lookahead===0&&(u.strstart=0,u.block_start=0,u.insert=0))),A(e),e.avail_out===0))return u.last_flush=-1,r}return U!==_?r:u.wrap<=0?1:(u.wrap===2?(te(u,255&e.adler),te(u,e.adler>>8&255),te(u,e.adler>>16&255),te(u,e.adler>>24&255),te(u,255&e.total_in),te(u,e.total_in>>8&255),te(u,e.total_in>>16&255),te(u,e.total_in>>24&255)):(K(u,e.adler>>>16),K(u,65535&e.adler)),A(e),0<u.wrap&&(u.wrap=-u.wrap),u.pending!==0?r:1)},w.deflateEnd=function(e){var U;return e&&e.state?(U=e.state.status)!==y&&U!==69&&U!==73&&U!==91&&U!==103&&U!==R&&U!==666?H(e,o):(e.state=null,U===R?H(e,-3):r):o},w.deflateSetDictionary=function(e,U){var x,u,h,C,N,W,T,Y,se=U.length;if(!e||!e.state||(C=(x=e.state).wrap)===2||C===1&&x.status!==y||x.lookahead)return o;for(C===1&&(e.adler=d(e.adler,U,se,0)),x.wrap=0,se>=x.w_size&&(C===0&&(q(x.head),x.strstart=0,x.block_start=0,x.insert=0),Y=new l.Buf8(x.w_size),l.arraySet(Y,U,se-x.w_size,x.w_size,0),U=Y,se=x.w_size),N=e.avail_in,W=e.next_in,T=e.input,e.avail_in=se,e.next_in=0,e.input=U,he(x);x.lookahead>=B;){for(u=x.strstart,h=x.lookahead-(B-1);x.ins_h=(x.ins_h<<x.hash_shift^x.window[u+B-1])&x.hash_mask,x.prev[u&x.w_mask]=x.head[x.ins_h],x.head[x.ins_h]=u,u++,--h;);x.strstart=u,x.lookahead=B-1,he(x)}return x.strstart+=x.lookahead,x.block_start=x.strstart,x.insert=x.lookahead,x.lookahead=0,x.match_length=x.prev_length=B-1,x.match_available=0,e.next_in=W,e.input=T,e.avail_in=N,x.wrap=C,r},w.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(f,O,w){O.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(f,O,w){O.exports=function(c,l){var s,d,m,p,g,_,r,o,t,a,i,v,b,S,E,D,L,$,B,j,Q,y,R,n,F;s=c.state,d=c.next_in,n=c.input,m=d+(c.avail_in-5),p=c.next_out,F=c.output,g=p-(l-c.avail_out),_=p+(c.avail_out-257),r=s.dmax,o=s.wsize,t=s.whave,a=s.wnext,i=s.window,v=s.hold,b=s.bits,S=s.lencode,E=s.distcode,D=(1<<s.lenbits)-1,L=(1<<s.distbits)-1;e:do{b<15&&(v+=n[d++]<<b,b+=8,v+=n[d++]<<b,b+=8),$=S[v&D];t:for(;;){if(v>>>=B=$>>>24,b-=B,(B=$>>>16&255)===0)F[p++]=65535&$;else{if(!(16&B)){if(!(64&B)){$=S[(65535&$)+(v&(1<<B)-1)];continue t}if(32&B){s.mode=12;break e}c.msg="invalid literal/length code",s.mode=30;break e}j=65535&$,(B&=15)&&(b<B&&(v+=n[d++]<<b,b+=8),j+=v&(1<<B)-1,v>>>=B,b-=B),b<15&&(v+=n[d++]<<b,b+=8,v+=n[d++]<<b,b+=8),$=E[v&L];n:for(;;){if(v>>>=B=$>>>24,b-=B,!(16&(B=$>>>16&255))){if(!(64&B)){$=E[(65535&$)+(v&(1<<B)-1)];continue n}c.msg="invalid distance code",s.mode=30;break e}if(Q=65535&$,b<(B&=15)&&(v+=n[d++]<<b,(b+=8)<B&&(v+=n[d++]<<b,b+=8)),r<(Q+=v&(1<<B)-1)){c.msg="invalid distance too far back",s.mode=30;break e}if(v>>>=B,b-=B,(B=p-g)<Q){if(t<(B=Q-B)&&s.sane){c.msg="invalid distance too far back",s.mode=30;break e}if(R=i,(y=0)===a){if(y+=o-B,B<j){for(j-=B;F[p++]=i[y++],--B;);y=p-Q,R=F}}else if(a<B){if(y+=o+a-B,(B-=a)<j){for(j-=B;F[p++]=i[y++],--B;);if(y=0,a<j){for(j-=B=a;F[p++]=i[y++],--B;);y=p-Q,R=F}}}else if(y+=a-B,B<j){for(j-=B;F[p++]=i[y++],--B;);y=p-Q,R=F}for(;2<j;)F[p++]=R[y++],F[p++]=R[y++],F[p++]=R[y++],j-=3;j&&(F[p++]=R[y++],1<j&&(F[p++]=R[y++]))}else{for(y=p-Q;F[p++]=F[y++],F[p++]=F[y++],F[p++]=F[y++],2<(j-=3););j&&(F[p++]=F[y++],1<j&&(F[p++]=F[y++]))}break}}break}}while(d<m&&p<_);d-=j=b>>3,v&=(1<<(b-=j<<3))-1,c.next_in=d,c.next_out=p,c.avail_in=d<m?m-d+5:5-(d-m),c.avail_out=p<_?_-p+257:257-(p-_),s.hold=v,s.bits=b}},{}],49:[function(f,O,w){var c=f("../utils/common"),l=f("./adler32"),s=f("./crc32"),d=f("./inffast"),m=f("./inftrees"),p=1,g=2,_=0,r=-2,o=1,t=852,a=592;function i(y){return(y>>>24&255)+(y>>>8&65280)+((65280&y)<<8)+((255&y)<<24)}function v(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new c.Buf16(320),this.work=new c.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function b(y){var R;return y&&y.state?(R=y.state,y.total_in=y.total_out=R.total=0,y.msg="",R.wrap&&(y.adler=1&R.wrap),R.mode=o,R.last=0,R.havedict=0,R.dmax=32768,R.head=null,R.hold=0,R.bits=0,R.lencode=R.lendyn=new c.Buf32(t),R.distcode=R.distdyn=new c.Buf32(a),R.sane=1,R.back=-1,_):r}function S(y){var R;return y&&y.state?((R=y.state).wsize=0,R.whave=0,R.wnext=0,b(y)):r}function E(y,R){var n,F;return y&&y.state?(F=y.state,R<0?(n=0,R=-R):(n=1+(R>>4),R<48&&(R&=15)),R&&(R<8||15<R)?r:(F.window!==null&&F.wbits!==R&&(F.window=null),F.wrap=n,F.wbits=R,S(y))):r}function D(y,R){var n,F;return y?(F=new v,(y.state=F).window=null,(n=E(y,R))!==_&&(y.state=null),n):r}var L,$,B=!0;function j(y){if(B){var R;for(L=new c.Buf32(512),$=new c.Buf32(32),R=0;R<144;)y.lens[R++]=8;for(;R<256;)y.lens[R++]=9;for(;R<280;)y.lens[R++]=7;for(;R<288;)y.lens[R++]=8;for(m(p,y.lens,0,288,L,0,y.work,{bits:9}),R=0;R<32;)y.lens[R++]=5;m(g,y.lens,0,32,$,0,y.work,{bits:5}),B=!1}y.lencode=L,y.lenbits=9,y.distcode=$,y.distbits=5}function Q(y,R,n,F){var Z,k=y.state;return k.window===null&&(k.wsize=1<<k.wbits,k.wnext=0,k.whave=0,k.window=new c.Buf8(k.wsize)),F>=k.wsize?(c.arraySet(k.window,R,n-k.wsize,k.wsize,0),k.wnext=0,k.whave=k.wsize):(F<(Z=k.wsize-k.wnext)&&(Z=F),c.arraySet(k.window,R,n-F,Z,k.wnext),(F-=Z)?(c.arraySet(k.window,R,n-F,F,0),k.wnext=F,k.whave=k.wsize):(k.wnext+=Z,k.wnext===k.wsize&&(k.wnext=0),k.whave<k.wsize&&(k.whave+=Z))),0}w.inflateReset=S,w.inflateReset2=E,w.inflateResetKeep=b,w.inflateInit=function(y){return D(y,15)},w.inflateInit2=D,w.inflate=function(y,R){var n,F,Z,k,H,M,q,A,z,te,K,P,he,ge,ce,de,ve,pe,ze,xe,e,U,x,u,h=0,C=new c.Buf8(4),N=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!y||!y.state||!y.output||!y.input&&y.avail_in!==0)return r;(n=y.state).mode===12&&(n.mode=13),H=y.next_out,Z=y.output,q=y.avail_out,k=y.next_in,F=y.input,M=y.avail_in,A=n.hold,z=n.bits,te=M,K=q,U=_;e:for(;;)switch(n.mode){case o:if(n.wrap===0){n.mode=13;break}for(;z<16;){if(M===0)break e;M--,A+=F[k++]<<z,z+=8}if(2&n.wrap&&A===35615){C[n.check=0]=255&A,C[1]=A>>>8&255,n.check=s(n.check,C,2,0),z=A=0,n.mode=2;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&A)<<8)+(A>>8))%31){y.msg="incorrect header check",n.mode=30;break}if((15&A)!=8){y.msg="unknown compression method",n.mode=30;break}if(z-=4,e=8+(15&(A>>>=4)),n.wbits===0)n.wbits=e;else if(e>n.wbits){y.msg="invalid window size",n.mode=30;break}n.dmax=1<<e,y.adler=n.check=1,n.mode=512&A?10:12,z=A=0;break;case 2:for(;z<16;){if(M===0)break e;M--,A+=F[k++]<<z,z+=8}if(n.flags=A,(255&n.flags)!=8){y.msg="unknown compression method",n.mode=30;break}if(57344&n.flags){y.msg="unknown header flags set",n.mode=30;break}n.head&&(n.head.text=A>>8&1),512&n.flags&&(C[0]=255&A,C[1]=A>>>8&255,n.check=s(n.check,C,2,0)),z=A=0,n.mode=3;case 3:for(;z<32;){if(M===0)break e;M--,A+=F[k++]<<z,z+=8}n.head&&(n.head.time=A),512&n.flags&&(C[0]=255&A,C[1]=A>>>8&255,C[2]=A>>>16&255,C[3]=A>>>24&255,n.check=s(n.check,C,4,0)),z=A=0,n.mode=4;case 4:for(;z<16;){if(M===0)break e;M--,A+=F[k++]<<z,z+=8}n.head&&(n.head.xflags=255&A,n.head.os=A>>8),512&n.flags&&(C[0]=255&A,C[1]=A>>>8&255,n.check=s(n.check,C,2,0)),z=A=0,n.mode=5;case 5:if(1024&n.flags){for(;z<16;){if(M===0)break e;M--,A+=F[k++]<<z,z+=8}n.length=A,n.head&&(n.head.extra_len=A),512&n.flags&&(C[0]=255&A,C[1]=A>>>8&255,n.check=s(n.check,C,2,0)),z=A=0}else n.head&&(n.head.extra=null);n.mode=6;case 6:if(1024&n.flags&&(M<(P=n.length)&&(P=M),P&&(n.head&&(e=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),c.arraySet(n.head.extra,F,k,P,e)),512&n.flags&&(n.check=s(n.check,F,P,k)),M-=P,k+=P,n.length-=P),n.length))break e;n.length=0,n.mode=7;case 7:if(2048&n.flags){if(M===0)break e;for(P=0;e=F[k+P++],n.head&&e&&n.length<65536&&(n.head.name+=String.fromCharCode(e)),e&&P<M;);if(512&n.flags&&(n.check=s(n.check,F,P,k)),M-=P,k+=P,e)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=8;case 8:if(4096&n.flags){if(M===0)break e;for(P=0;e=F[k+P++],n.head&&e&&n.length<65536&&(n.head.comment+=String.fromCharCode(e)),e&&P<M;);if(512&n.flags&&(n.check=s(n.check,F,P,k)),M-=P,k+=P,e)break e}else n.head&&(n.head.comment=null);n.mode=9;case 9:if(512&n.flags){for(;z<16;){if(M===0)break e;M--,A+=F[k++]<<z,z+=8}if(A!==(65535&n.check)){y.msg="header crc mismatch",n.mode=30;break}z=A=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),y.adler=n.check=0,n.mode=12;break;case 10:for(;z<32;){if(M===0)break e;M--,A+=F[k++]<<z,z+=8}y.adler=n.check=i(A),z=A=0,n.mode=11;case 11:if(n.havedict===0)return y.next_out=H,y.avail_out=q,y.next_in=k,y.avail_in=M,n.hold=A,n.bits=z,2;y.adler=n.check=1,n.mode=12;case 12:if(R===5||R===6)break e;case 13:if(n.last){A>>>=7&z,z-=7&z,n.mode=27;break}for(;z<3;){if(M===0)break e;M--,A+=F[k++]<<z,z+=8}switch(n.last=1&A,z-=1,3&(A>>>=1)){case 0:n.mode=14;break;case 1:if(j(n),n.mode=20,R!==6)break;A>>>=2,z-=2;break e;case 2:n.mode=17;break;case 3:y.msg="invalid block type",n.mode=30}A>>>=2,z-=2;break;case 14:for(A>>>=7&z,z-=7&z;z<32;){if(M===0)break e;M--,A+=F[k++]<<z,z+=8}if((65535&A)!=(A>>>16^65535)){y.msg="invalid stored block lengths",n.mode=30;break}if(n.length=65535&A,z=A=0,n.mode=15,R===6)break e;case 15:n.mode=16;case 16:if(P=n.length){if(M<P&&(P=M),q<P&&(P=q),P===0)break e;c.arraySet(Z,F,k,P,H),M-=P,k+=P,q-=P,H+=P,n.length-=P;break}n.mode=12;break;case 17:for(;z<14;){if(M===0)break e;M--,A+=F[k++]<<z,z+=8}if(n.nlen=257+(31&A),A>>>=5,z-=5,n.ndist=1+(31&A),A>>>=5,z-=5,n.ncode=4+(15&A),A>>>=4,z-=4,286<n.nlen||30<n.ndist){y.msg="too many length or distance symbols",n.mode=30;break}n.have=0,n.mode=18;case 18:for(;n.have<n.ncode;){for(;z<3;){if(M===0)break e;M--,A+=F[k++]<<z,z+=8}n.lens[N[n.have++]]=7&A,A>>>=3,z-=3}for(;n.have<19;)n.lens[N[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,x={bits:n.lenbits},U=m(0,n.lens,0,19,n.lencode,0,n.work,x),n.lenbits=x.bits,U){y.msg="invalid code lengths set",n.mode=30;break}n.have=0,n.mode=19;case 19:for(;n.have<n.nlen+n.ndist;){for(;de=(h=n.lencode[A&(1<<n.lenbits)-1])>>>16&255,ve=65535&h,!((ce=h>>>24)<=z);){if(M===0)break e;M--,A+=F[k++]<<z,z+=8}if(ve<16)A>>>=ce,z-=ce,n.lens[n.have++]=ve;else{if(ve===16){for(u=ce+2;z<u;){if(M===0)break e;M--,A+=F[k++]<<z,z+=8}if(A>>>=ce,z-=ce,n.have===0){y.msg="invalid bit length repeat",n.mode=30;break}e=n.lens[n.have-1],P=3+(3&A),A>>>=2,z-=2}else if(ve===17){for(u=ce+3;z<u;){if(M===0)break e;M--,A+=F[k++]<<z,z+=8}z-=ce,e=0,P=3+(7&(A>>>=ce)),A>>>=3,z-=3}else{for(u=ce+7;z<u;){if(M===0)break e;M--,A+=F[k++]<<z,z+=8}z-=ce,e=0,P=11+(127&(A>>>=ce)),A>>>=7,z-=7}if(n.have+P>n.nlen+n.ndist){y.msg="invalid bit length repeat",n.mode=30;break}for(;P--;)n.lens[n.have++]=e}}if(n.mode===30)break;if(n.lens[256]===0){y.msg="invalid code -- missing end-of-block",n.mode=30;break}if(n.lenbits=9,x={bits:n.lenbits},U=m(p,n.lens,0,n.nlen,n.lencode,0,n.work,x),n.lenbits=x.bits,U){y.msg="invalid literal/lengths set",n.mode=30;break}if(n.distbits=6,n.distcode=n.distdyn,x={bits:n.distbits},U=m(g,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,x),n.distbits=x.bits,U){y.msg="invalid distances set",n.mode=30;break}if(n.mode=20,R===6)break e;case 20:n.mode=21;case 21:if(6<=M&&258<=q){y.next_out=H,y.avail_out=q,y.next_in=k,y.avail_in=M,n.hold=A,n.bits=z,d(y,K),H=y.next_out,Z=y.output,q=y.avail_out,k=y.next_in,F=y.input,M=y.avail_in,A=n.hold,z=n.bits,n.mode===12&&(n.back=-1);break}for(n.back=0;de=(h=n.lencode[A&(1<<n.lenbits)-1])>>>16&255,ve=65535&h,!((ce=h>>>24)<=z);){if(M===0)break e;M--,A+=F[k++]<<z,z+=8}if(de&&!(240&de)){for(pe=ce,ze=de,xe=ve;de=(h=n.lencode[xe+((A&(1<<pe+ze)-1)>>pe)])>>>16&255,ve=65535&h,!(pe+(ce=h>>>24)<=z);){if(M===0)break e;M--,A+=F[k++]<<z,z+=8}A>>>=pe,z-=pe,n.back+=pe}if(A>>>=ce,z-=ce,n.back+=ce,n.length=ve,de===0){n.mode=26;break}if(32&de){n.back=-1,n.mode=12;break}if(64&de){y.msg="invalid literal/length code",n.mode=30;break}n.extra=15&de,n.mode=22;case 22:if(n.extra){for(u=n.extra;z<u;){if(M===0)break e;M--,A+=F[k++]<<z,z+=8}n.length+=A&(1<<n.extra)-1,A>>>=n.extra,z-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=23;case 23:for(;de=(h=n.distcode[A&(1<<n.distbits)-1])>>>16&255,ve=65535&h,!((ce=h>>>24)<=z);){if(M===0)break e;M--,A+=F[k++]<<z,z+=8}if(!(240&de)){for(pe=ce,ze=de,xe=ve;de=(h=n.distcode[xe+((A&(1<<pe+ze)-1)>>pe)])>>>16&255,ve=65535&h,!(pe+(ce=h>>>24)<=z);){if(M===0)break e;M--,A+=F[k++]<<z,z+=8}A>>>=pe,z-=pe,n.back+=pe}if(A>>>=ce,z-=ce,n.back+=ce,64&de){y.msg="invalid distance code",n.mode=30;break}n.offset=ve,n.extra=15&de,n.mode=24;case 24:if(n.extra){for(u=n.extra;z<u;){if(M===0)break e;M--,A+=F[k++]<<z,z+=8}n.offset+=A&(1<<n.extra)-1,A>>>=n.extra,z-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){y.msg="invalid distance too far back",n.mode=30;break}n.mode=25;case 25:if(q===0)break e;if(P=K-q,n.offset>P){if((P=n.offset-P)>n.whave&&n.sane){y.msg="invalid distance too far back",n.mode=30;break}he=P>n.wnext?(P-=n.wnext,n.wsize-P):n.wnext-P,P>n.length&&(P=n.length),ge=n.window}else ge=Z,he=H-n.offset,P=n.length;for(q<P&&(P=q),q-=P,n.length-=P;Z[H++]=ge[he++],--P;);n.length===0&&(n.mode=21);break;case 26:if(q===0)break e;Z[H++]=n.length,q--,n.mode=21;break;case 27:if(n.wrap){for(;z<32;){if(M===0)break e;M--,A|=F[k++]<<z,z+=8}if(K-=q,y.total_out+=K,n.total+=K,K&&(y.adler=n.check=n.flags?s(n.check,Z,K,H-K):l(n.check,Z,K,H-K)),K=q,(n.flags?A:i(A))!==n.check){y.msg="incorrect data check",n.mode=30;break}z=A=0}n.mode=28;case 28:if(n.wrap&&n.flags){for(;z<32;){if(M===0)break e;M--,A+=F[k++]<<z,z+=8}if(A!==(4294967295&n.total)){y.msg="incorrect length check",n.mode=30;break}z=A=0}n.mode=29;case 29:U=1;break e;case 30:U=-3;break e;case 31:return-4;case 32:default:return r}return y.next_out=H,y.avail_out=q,y.next_in=k,y.avail_in=M,n.hold=A,n.bits=z,(n.wsize||K!==y.avail_out&&n.mode<30&&(n.mode<27||R!==4))&&Q(y,y.output,y.next_out,K-y.avail_out)?(n.mode=31,-4):(te-=y.avail_in,K-=y.avail_out,y.total_in+=te,y.total_out+=K,n.total+=K,n.wrap&&K&&(y.adler=n.check=n.flags?s(n.check,Z,K,y.next_out-K):l(n.check,Z,K,y.next_out-K)),y.data_type=n.bits+(n.last?64:0)+(n.mode===12?128:0)+(n.mode===20||n.mode===15?256:0),(te==0&&K===0||R===4)&&U===_&&(U=-5),U)},w.inflateEnd=function(y){if(!y||!y.state)return r;var R=y.state;return R.window&&(R.window=null),y.state=null,_},w.inflateGetHeader=function(y,R){var n;return y&&y.state&&2&(n=y.state).wrap?((n.head=R).done=!1,_):r},w.inflateSetDictionary=function(y,R){var n,F=R.length;return y&&y.state?(n=y.state).wrap!==0&&n.mode!==11?r:n.mode===11&&l(1,R,F,0)!==n.check?-3:Q(y,R,F,F)?(n.mode=31,-4):(n.havedict=1,_):r},w.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(f,O,w){var c=f("../utils/common"),l=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],s=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],d=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],m=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];O.exports=function(p,g,_,r,o,t,a,i){var v,b,S,E,D,L,$,B,j,Q=i.bits,y=0,R=0,n=0,F=0,Z=0,k=0,H=0,M=0,q=0,A=0,z=null,te=0,K=new c.Buf16(16),P=new c.Buf16(16),he=null,ge=0;for(y=0;y<=15;y++)K[y]=0;for(R=0;R<r;R++)K[g[_+R]]++;for(Z=Q,F=15;1<=F&&K[F]===0;F--);if(F<Z&&(Z=F),F===0)return o[t++]=20971520,o[t++]=20971520,i.bits=1,0;for(n=1;n<F&&K[n]===0;n++);for(Z<n&&(Z=n),y=M=1;y<=15;y++)if(M<<=1,(M-=K[y])<0)return-1;if(0<M&&(p===0||F!==1))return-1;for(P[1]=0,y=1;y<15;y++)P[y+1]=P[y]+K[y];for(R=0;R<r;R++)g[_+R]!==0&&(a[P[g[_+R]]++]=R);if(L=p===0?(z=he=a,19):p===1?(z=l,te-=257,he=s,ge-=257,256):(z=d,he=m,-1),y=n,D=t,H=R=A=0,S=-1,E=(q=1<<(k=Z))-1,p===1&&852<q||p===2&&592<q)return 1;for(;;){for($=y-H,j=a[R]<L?(B=0,a[R]):a[R]>L?(B=he[ge+a[R]],z[te+a[R]]):(B=96,0),v=1<<y-H,n=b=1<<k;o[D+(A>>H)+(b-=v)]=$<<24|B<<16|j|0,b!==0;);for(v=1<<y-1;A&v;)v>>=1;if(v!==0?(A&=v-1,A+=v):A=0,R++,--K[y]==0){if(y===F)break;y=g[_+a[R]]}if(Z<y&&(A&E)!==S){for(H===0&&(H=Z),D+=n,M=1<<(k=y-H);k+H<F&&!((M-=K[k+H])<=0);)k++,M<<=1;if(q+=1<<k,p===1&&852<q||p===2&&592<q)return 1;o[S=A&E]=Z<<24|k<<16|D-t|0}}return A!==0&&(o[D+A]=y-H<<24|64<<16|0),i.bits=Z,0}},{"../utils/common":41}],51:[function(f,O,w){O.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(f,O,w){var c=f("../utils/common"),l=0,s=1;function d(h){for(var C=h.length;0<=--C;)h[C]=0}var m=0,p=29,g=256,_=g+1+p,r=30,o=19,t=2*_+1,a=15,i=16,v=7,b=256,S=16,E=17,D=18,L=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],$=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],B=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],j=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Q=new Array(2*(_+2));d(Q);var y=new Array(2*r);d(y);var R=new Array(512);d(R);var n=new Array(256);d(n);var F=new Array(p);d(F);var Z,k,H,M=new Array(r);function q(h,C,N,W,T){this.static_tree=h,this.extra_bits=C,this.extra_base=N,this.elems=W,this.max_length=T,this.has_stree=h&&h.length}function A(h,C){this.dyn_tree=h,this.max_code=0,this.stat_desc=C}function z(h){return h<256?R[h]:R[256+(h>>>7)]}function te(h,C){h.pending_buf[h.pending++]=255&C,h.pending_buf[h.pending++]=C>>>8&255}function K(h,C,N){h.bi_valid>i-N?(h.bi_buf|=C<<h.bi_valid&65535,te(h,h.bi_buf),h.bi_buf=C>>i-h.bi_valid,h.bi_valid+=N-i):(h.bi_buf|=C<<h.bi_valid&65535,h.bi_valid+=N)}function P(h,C,N){K(h,N[2*C],N[2*C+1])}function he(h,C){for(var N=0;N|=1&h,h>>>=1,N<<=1,0<--C;);return N>>>1}function ge(h,C,N){var W,T,Y=new Array(a+1),se=0;for(W=1;W<=a;W++)Y[W]=se=se+N[W-1]<<1;for(T=0;T<=C;T++){var J=h[2*T+1];J!==0&&(h[2*T]=he(Y[J]++,J))}}function ce(h){var C;for(C=0;C<_;C++)h.dyn_ltree[2*C]=0;for(C=0;C<r;C++)h.dyn_dtree[2*C]=0;for(C=0;C<o;C++)h.bl_tree[2*C]=0;h.dyn_ltree[2*b]=1,h.opt_len=h.static_len=0,h.last_lit=h.matches=0}function de(h){8<h.bi_valid?te(h,h.bi_buf):0<h.bi_valid&&(h.pending_buf[h.pending++]=h.bi_buf),h.bi_buf=0,h.bi_valid=0}function ve(h,C,N,W){var T=2*C,Y=2*N;return h[T]<h[Y]||h[T]===h[Y]&&W[C]<=W[N]}function pe(h,C,N){for(var W=h.heap[N],T=N<<1;T<=h.heap_len&&(T<h.heap_len&&ve(C,h.heap[T+1],h.heap[T],h.depth)&&T++,!ve(C,W,h.heap[T],h.depth));)h.heap[N]=h.heap[T],N=T,T<<=1;h.heap[N]=W}function ze(h,C,N){var W,T,Y,se,J=0;if(h.last_lit!==0)for(;W=h.pending_buf[h.d_buf+2*J]<<8|h.pending_buf[h.d_buf+2*J+1],T=h.pending_buf[h.l_buf+J],J++,W===0?P(h,T,C):(P(h,(Y=n[T])+g+1,C),(se=L[Y])!==0&&K(h,T-=F[Y],se),P(h,Y=z(--W),N),(se=$[Y])!==0&&K(h,W-=M[Y],se)),J<h.last_lit;);P(h,b,C)}function xe(h,C){var N,W,T,Y=C.dyn_tree,se=C.stat_desc.static_tree,J=C.stat_desc.has_stree,oe=C.stat_desc.elems,fe=-1;for(h.heap_len=0,h.heap_max=t,N=0;N<oe;N++)Y[2*N]!==0?(h.heap[++h.heap_len]=fe=N,h.depth[N]=0):Y[2*N+1]=0;for(;h.heap_len<2;)Y[2*(T=h.heap[++h.heap_len]=fe<2?++fe:0)]=1,h.depth[T]=0,h.opt_len--,J&&(h.static_len-=se[2*T+1]);for(C.max_code=fe,N=h.heap_len>>1;1<=N;N--)pe(h,Y,N);for(T=oe;N=h.heap[1],h.heap[1]=h.heap[h.heap_len--],pe(h,Y,1),W=h.heap[1],h.heap[--h.heap_max]=N,h.heap[--h.heap_max]=W,Y[2*T]=Y[2*N]+Y[2*W],h.depth[T]=(h.depth[N]>=h.depth[W]?h.depth[N]:h.depth[W])+1,Y[2*N+1]=Y[2*W+1]=T,h.heap[1]=T++,pe(h,Y,1),2<=h.heap_len;);h.heap[--h.heap_max]=h.heap[1],function(X,ye){var $e,Oe,Fe,we,Ve,Qe,Te=ye.dyn_tree,ht=ye.max_code,At=ye.stat_desc.static_tree,It=ye.stat_desc.has_stree,Ot=ye.stat_desc.extra_bits,ft=ye.stat_desc.extra_base,Pe=ye.stat_desc.max_length,qe=0;for(we=0;we<=a;we++)X.bl_count[we]=0;for(Te[2*X.heap[X.heap_max]+1]=0,$e=X.heap_max+1;$e<t;$e++)Pe<(we=Te[2*Te[2*(Oe=X.heap[$e])+1]+1]+1)&&(we=Pe,qe++),Te[2*Oe+1]=we,ht<Oe||(X.bl_count[we]++,Ve=0,ft<=Oe&&(Ve=Ot[Oe-ft]),Qe=Te[2*Oe],X.opt_len+=Qe*(we+Ve),It&&(X.static_len+=Qe*(At[2*Oe+1]+Ve)));if(qe!==0){do{for(we=Pe-1;X.bl_count[we]===0;)we--;X.bl_count[we]--,X.bl_count[we+1]+=2,X.bl_count[Pe]--,qe-=2}while(0<qe);for(we=Pe;we!==0;we--)for(Oe=X.bl_count[we];Oe!==0;)ht<(Fe=X.heap[--$e])||(Te[2*Fe+1]!==we&&(X.opt_len+=(we-Te[2*Fe+1])*Te[2*Fe],Te[2*Fe+1]=we),Oe--)}}(h,C),ge(Y,fe,h.bl_count)}function e(h,C,N){var W,T,Y=-1,se=C[1],J=0,oe=7,fe=4;for(se===0&&(oe=138,fe=3),C[2*(N+1)+1]=65535,W=0;W<=N;W++)T=se,se=C[2*(W+1)+1],++J<oe&&T===se||(J<fe?h.bl_tree[2*T]+=J:T!==0?(T!==Y&&h.bl_tree[2*T]++,h.bl_tree[2*S]++):J<=10?h.bl_tree[2*E]++:h.bl_tree[2*D]++,Y=T,fe=(J=0)===se?(oe=138,3):T===se?(oe=6,3):(oe=7,4))}function U(h,C,N){var W,T,Y=-1,se=C[1],J=0,oe=7,fe=4;for(se===0&&(oe=138,fe=3),W=0;W<=N;W++)if(T=se,se=C[2*(W+1)+1],!(++J<oe&&T===se)){if(J<fe)for(;P(h,T,h.bl_tree),--J!=0;);else T!==0?(T!==Y&&(P(h,T,h.bl_tree),J--),P(h,S,h.bl_tree),K(h,J-3,2)):J<=10?(P(h,E,h.bl_tree),K(h,J-3,3)):(P(h,D,h.bl_tree),K(h,J-11,7));Y=T,fe=(J=0)===se?(oe=138,3):T===se?(oe=6,3):(oe=7,4)}}d(M);var x=!1;function u(h,C,N,W){K(h,(m<<1)+(W?1:0),3),function(T,Y,se,J){de(T),te(T,se),te(T,~se),c.arraySet(T.pending_buf,T.window,Y,se,T.pending),T.pending+=se}(h,C,N)}w._tr_init=function(h){x||(function(){var C,N,W,T,Y,se=new Array(a+1);for(T=W=0;T<p-1;T++)for(F[T]=W,C=0;C<1<<L[T];C++)n[W++]=T;for(n[W-1]=T,T=Y=0;T<16;T++)for(M[T]=Y,C=0;C<1<<$[T];C++)R[Y++]=T;for(Y>>=7;T<r;T++)for(M[T]=Y<<7,C=0;C<1<<$[T]-7;C++)R[256+Y++]=T;for(N=0;N<=a;N++)se[N]=0;for(C=0;C<=143;)Q[2*C+1]=8,C++,se[8]++;for(;C<=255;)Q[2*C+1]=9,C++,se[9]++;for(;C<=279;)Q[2*C+1]=7,C++,se[7]++;for(;C<=287;)Q[2*C+1]=8,C++,se[8]++;for(ge(Q,_+1,se),C=0;C<r;C++)y[2*C+1]=5,y[2*C]=he(C,5);Z=new q(Q,L,g+1,_,a),k=new q(y,$,0,r,a),H=new q(new Array(0),B,0,o,v)}(),x=!0),h.l_desc=new A(h.dyn_ltree,Z),h.d_desc=new A(h.dyn_dtree,k),h.bl_desc=new A(h.bl_tree,H),h.bi_buf=0,h.bi_valid=0,ce(h)},w._tr_stored_block=u,w._tr_flush_block=function(h,C,N,W){var T,Y,se=0;0<h.level?(h.strm.data_type===2&&(h.strm.data_type=function(J){var oe,fe=4093624447;for(oe=0;oe<=31;oe++,fe>>>=1)if(1&fe&&J.dyn_ltree[2*oe]!==0)return l;if(J.dyn_ltree[18]!==0||J.dyn_ltree[20]!==0||J.dyn_ltree[26]!==0)return s;for(oe=32;oe<g;oe++)if(J.dyn_ltree[2*oe]!==0)return s;return l}(h)),xe(h,h.l_desc),xe(h,h.d_desc),se=function(J){var oe;for(e(J,J.dyn_ltree,J.l_desc.max_code),e(J,J.dyn_dtree,J.d_desc.max_code),xe(J,J.bl_desc),oe=o-1;3<=oe&&J.bl_tree[2*j[oe]+1]===0;oe--);return J.opt_len+=3*(oe+1)+5+5+4,oe}(h),T=h.opt_len+3+7>>>3,(Y=h.static_len+3+7>>>3)<=T&&(T=Y)):T=Y=N+5,N+4<=T&&C!==-1?u(h,C,N,W):h.strategy===4||Y===T?(K(h,2+(W?1:0),3),ze(h,Q,y)):(K(h,4+(W?1:0),3),function(J,oe,fe,X){var ye;for(K(J,oe-257,5),K(J,fe-1,5),K(J,X-4,4),ye=0;ye<X;ye++)K(J,J.bl_tree[2*j[ye]+1],3);U(J,J.dyn_ltree,oe-1),U(J,J.dyn_dtree,fe-1)}(h,h.l_desc.max_code+1,h.d_desc.max_code+1,se+1),ze(h,h.dyn_ltree,h.dyn_dtree)),ce(h),W&&de(h)},w._tr_tally=function(h,C,N){return h.pending_buf[h.d_buf+2*h.last_lit]=C>>>8&255,h.pending_buf[h.d_buf+2*h.last_lit+1]=255&C,h.pending_buf[h.l_buf+h.last_lit]=255&N,h.last_lit++,C===0?h.dyn_ltree[2*N]++:(h.matches++,C--,h.dyn_ltree[2*(n[N]+g+1)]++,h.dyn_dtree[2*z(C)]++),h.last_lit===h.lit_bufsize-1},w._tr_align=function(h){K(h,2,3),P(h,b,Q),function(C){C.bi_valid===16?(te(C,C.bi_buf),C.bi_buf=0,C.bi_valid=0):8<=C.bi_valid&&(C.pending_buf[C.pending++]=255&C.bi_buf,C.bi_buf>>=8,C.bi_valid-=8)}(h)}},{"../utils/common":41}],53:[function(f,O,w){O.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(f,O,w){(function(c){(function(l,s){if(!l.setImmediate){var d,m,p,g,_=1,r={},o=!1,t=l.document,a=Object.getPrototypeOf&&Object.getPrototypeOf(l);a=a&&a.setTimeout?a:l,d={}.toString.call(l.process)==="[object process]"?function(S){process.nextTick(function(){v(S)})}:function(){if(l.postMessage&&!l.importScripts){var S=!0,E=l.onmessage;return l.onmessage=function(){S=!1},l.postMessage("","*"),l.onmessage=E,S}}()?(g="setImmediate$"+Math.random()+"$",l.addEventListener?l.addEventListener("message",b,!1):l.attachEvent("onmessage",b),function(S){l.postMessage(g+S,"*")}):l.MessageChannel?((p=new MessageChannel).port1.onmessage=function(S){v(S.data)},function(S){p.port2.postMessage(S)}):t&&"onreadystatechange"in t.createElement("script")?(m=t.documentElement,function(S){var E=t.createElement("script");E.onreadystatechange=function(){v(S),E.onreadystatechange=null,m.removeChild(E),E=null},m.appendChild(E)}):function(S){setTimeout(v,0,S)},a.setImmediate=function(S){typeof S!="function"&&(S=new Function(""+S));for(var E=new Array(arguments.length-1),D=0;D<E.length;D++)E[D]=arguments[D+1];var L={callback:S,args:E};return r[_]=L,d(_),_++},a.clearImmediate=i}function i(S){delete r[S]}function v(S){if(o)setTimeout(v,0,S);else{var E=r[S];if(E){o=!0;try{(function(D){var L=D.callback,$=D.args;switch($.length){case 0:L();break;case 1:L($[0]);break;case 2:L($[0],$[1]);break;case 3:L($[0],$[1],$[2]);break;default:L.apply(s,$)}})(E)}finally{i(S),o=!1}}}}function b(S){S.source===l&&typeof S.data=="string"&&S.data.indexOf(g)===0&&v(+S.data.slice(g.length))}})(typeof self>"u"?c===void 0?this:c:self)}).call(this,typeof Le<"u"?Le:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(Et);var Mr=Et.exports;const Br=Gt(Mr);var zt={exports:{}};(function(ae,V){(function(f,O){O()})(Le,function(){function f(m,p){return typeof p>"u"?p={autoBom:!1}:typeof p!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),p={autoBom:!p}),p.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(m.type)?new Blob(["\uFEFF",m],{type:m.type}):m}function O(m,p,g){var _=new XMLHttpRequest;_.open("GET",m),_.responseType="blob",_.onload=function(){d(_.response,p,g)},_.onerror=function(){console.error("could not download file")},_.send()}function w(m){var p=new XMLHttpRequest;p.open("HEAD",m,!1);try{p.send()}catch{}return 200<=p.status&&299>=p.status}function c(m){try{m.dispatchEvent(new MouseEvent("click"))}catch{var p=document.createEvent("MouseEvents");p.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),m.dispatchEvent(p)}}var l=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof Le=="object"&&Le.global===Le?Le:void 0,s=l.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),d=l.saveAs||(typeof window!="object"||window!==l?function(){}:"download"in HTMLAnchorElement.prototype&&!s?function(m,p,g){var _=l.URL||l.webkitURL,r=document.createElement("a");p=p||m.name||"download",r.download=p,r.rel="noopener",typeof m=="string"?(r.href=m,r.origin===location.origin?c(r):w(r.href)?O(m,p,g):c(r,r.target="_blank")):(r.href=_.createObjectURL(m),setTimeout(function(){_.revokeObjectURL(r.href)},4e4),setTimeout(function(){c(r)},0))}:"msSaveOrOpenBlob"in navigator?function(m,p,g){if(p=p||m.name||"download",typeof m!="string")navigator.msSaveOrOpenBlob(f(m,g),p);else if(w(m))O(m,p,g);else{var _=document.createElement("a");_.href=m,_.target="_blank",setTimeout(function(){c(_)})}}:function(m,p,g,_){if(_=_||open("","_blank"),_&&(_.document.title=_.document.body.innerText="downloading..."),typeof m=="string")return O(m,p,g);var r=m.type==="application/octet-stream",o=/constructor/i.test(l.HTMLElement)||l.safari,t=/CriOS\/[\d]+/.test(navigator.userAgent);if((t||r&&o||s)&&typeof FileReader<"u"){var a=new FileReader;a.onloadend=function(){var b=a.result;b=t?b:b.replace(/^data:[^;]*;/,"data:attachment/file;"),_?_.location.href=b:location=b,_=null},a.readAsDataURL(m)}else{var i=l.URL||l.webkitURL,v=i.createObjectURL(m);_?_.location=v:location.href=v,_=null,setTimeout(function(){i.revokeObjectURL(v)},4e4)}});l.saveAs=d.saveAs=d,ae.exports=d})})(zt);var Dr=zt.exports;const $r={xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",fill:"none"};function Rr(ae,V){return G(),ne("svg",$r,V[0]||(V[0]=[Kt('<g stroke="currentColor" stroke-width="1.67" clip-path="url(#a)"><path stroke-linecap="round" stroke-linejoin="round" d="m9.5 12 2.5 2.497L14.5 12M11.998 14.494V9.5"></path><path d="M15 4.446V3a2 2 0 0 0-2-2H3a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h1.446"></path><rect width="14" height="14" x="5" y="5" rx="2"></rect></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h20v20H0z"></path></clipPath></defs>',2)]))}const vt={render:Rr},Fr={xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",class:"lucide lucide-file",viewBox:"0 0 24 24"};function Pr(ae,V){return G(),ne("svg",Fr,V[0]||(V[0]=[I("path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"},null,-1),I("path",{d:"M14 2v4a2 2 0 0 0 2 2h4"},null,-1)]))}const Ur={render:Pr},Nr={xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",class:"lucide lucide-mouse-pointer-click",viewBox:"0 0 24 24"};function jr(ae,V){return G(),ne("svg",Nr,V[0]||(V[0]=[I("path",{d:"M14 4.1 12 6M5.1 8l-2.9-.8M6 12l-1.9 2M7.2 2.2 8 5.1M9.037 9.69a.498.498 0 0 1 .653-.653l11 4.5a.5.5 0 0 1-.074.949l-4.349 1.041a1 1 0 0 0-.74.739l-1.04 4.35a.5.5 0 0 1-.95.074z"},null,-1)]))}const Wr={render:jr},Zr={class:"content"},Hr={key:0,class:"classList"},Vr={class:"header"},qr={class:"title"},Gr={class:"btns"},Kr={class:"svg"},Yr={class:"main"},Jr={class:"classTitle"},Xr=["onClick"],Qr={key:0,class:"classFiles"},ei={class:"timeTitle"},ti={class:"fileList"},ni=["onClick"],si={class:"fileInfo"},ri={class:"fileNameContainer"},ii={class:"fileNameDiv"},ai={class:"fileNameSpan"},oi={class:"time"},li={class:"custom-tooltip"},ci=["onClick"],ui=["onClick"],di={key:1,class:"empty"},hi={class:"emptyIcon"},fi={class:"emptyText"},pi={key:1,class:"batchDownloadList"},mi={class:"header"},_i={class:"batchMain"},vi={class:"batchMainContent"},gi={class:"timeTitle"},wi={class:"fileList"},bi={class:"timeContainer"},yi={class:"fileName"},ki={class:"time"},xi={class:"batchFooter"},Ci={class:"span"},Si={__name:"fileClass",setup(ae){const V=De(),{messages:f}=Ee(V),{t:O}=He(),w=ie(!1),c=ie(!1),l=ie("all"),s=ie(!1),d=ie({}),m=ie(""),p=ie(!1),g=ie(!1),_=Yt([]),r=()=>{const k=an.viewLocal(f.value,!1),H=new Map(_.map(M=>[M.id,M.selected]));_.length=0,k.forEach(M=>{_.push({...M,selected:H.get(M.id)??!1})})};r(),Ue(f,r,{deep:!0});const o=["all","document","image","codeFile","link"],t={link:["com"],codeFile:["js","css","html","java","c#","cpp","py","go","php","ruby","swift","kotlin","scala","rust"],image:["jpg","jpeg","png","gif","bmp","svg","tiff","webp","ico"],document:["doc","docx","xls","xlsx","ppt","pptx","pdf","txt","md"]},a=_e(()=>(console.log("chooseClassType.value",l.value),l.value==="all"?_:_.filter(k=>{var M;const H=k.filename.split(".").pop().toLowerCase();return(M=t[l.value])==null?void 0:M.includes(H)}))),i=_e(()=>L(a.value)),v=ie(!1),b=_e(()=>{const k=a.value;if(k.length===0)return!1;const H=k.some(q=>q.selected),M=k.every(q=>q.selected);return H&&!M}),S=()=>{v.value=!v.value,a.value.forEach(k=>{k.selected=v.value})},E=()=>{const k=a.value;if(k.length===0){v.value=!1;return}v.value=k.every(H=>H.selected)},D=_e(()=>Object.values(i.value).some(k=>k.some(H=>H.selected)));Ue(D,k=>{g.value=!k},{immediate:!0}),Ue(a,k=>{E()},{immediate:!0});function L(k){s.value=k.length==0;const H=new Date;H.setHours(0,0,0,0);const M=new Date(H);M.setDate(M.getDate()-1);const q={today:[],yesterday:[],earlier:[]};return k.sort((A,z)=>new Date(z.timestamp)-new Date(A.timestamp)),k.forEach(A=>{const z=new Date(A.timestamp);z.setHours(0,0,0,0),z.getTime()===H.getTime()?q.today.push(A):z.getTime()===M.getTime()?q.yesterday.push(A):q.earlier.push(A)}),Object.fromEntries(Object.entries(q).filter(([A,z])=>z.length>0))}const $=()=>{c.value=!1},B=()=>{w.value=!0},j=()=>{w.value=!1,v.value=!1,_.forEach(k=>{k.selected=!1})};async function Q(k){d.value[k.id]=!1,tt.handleFileDownload(k)}const y=k=>{tt.imgType.includes(k.filename.split(".").pop())?nt.getFile(k.filepath).then(H=>{m.value=URL.createObjectURL(H),p.value=!0}):Be.emit("fullPreviewVisable",k),c.value=!1},R=k=>{tt.imgType.includes(k.filename.split(".").pop())?nt.getFile(k.filepath).then(H=>{m.value=URL.createObjectURL(H),p.value=!0}):y(k),d.value[k.id]=!1},n=k=>{d.value[k]=!d.value[k]},F=(k,H)=>{d.value[k]=H};async function Z(){if(g.value)return;const k=Object.values(i.value).flat().filter(q=>q.selected);if(k.length===0){w.value=!1;return}console.log("selectedFiles",k);const H=new Br,M=k.map(async q=>{const A=q.filename.split("/").pop(),z=await nt.getFile(q.filepath);console.log("fileContent",z);const te=A.split(".").pop().toLowerCase(),K=t.image.includes(te)||["pdf","doc","docx","xls","xlsx","ppt","pptx","zip","rar"].includes(te);let P=z;!K&&typeof z!="string"&&(P=typeof z=="object"?JSON.stringify(z,null,2):String(z)),H.file(A,P,{binary:K})});try{await Promise.all(M);const q=await H.generateAsync({type:"blob"});Dr.saveAs(q,`files_${new Date().toISOString().slice(0,10)}.zip`)}catch(q){console.error("Error creating ZIP file:",q)}w.value=!1,v.value=!1,_.forEach(q=>{q.selected=!1})}return Be.on("file-explorer-visible",()=>{c.value=!0}),(k,H)=>{const M=Jt,q=Xt,A=We,z=Ze;return G(),ne(ke,null,[ee(z,{open:c.value,footer:null,style:{width:"600px","background-color":"#fff","border-color":"hsla(0, 0%, 100%, .05)","border-width":"1px","border-radius":"20px",overflow:"auto","flex-direction":"column","max-width":"95%","max-height":"95%",height:"680px",padding:"0px"},closable:!1,onCancel:$,centered:!0,class:"modal"},{default:ue(()=>[I("div",Zr,[w.value?(G(),ne("div",pi,[I("div",mi,[I("div",{class:"selectAll",onClick:S},[ee(q,{checked:v.value,"onUpdate:checked":H[1]||(H[1]=te=>v.value=te),indeterminate:b.value},null,8,["checked","indeterminate"]),I("span",null,re(k.$t("lemon.fileExplorer.selectAll")),1)]),I("span",{class:"cancel",onClick:j},re(k.$t("lemon.fileExplorer.cancel")),1)]),I("div",_i,[I("div",vi,[(G(!0),ne(ke,null,Se(i.value,(te,K)=>(G(),ne("div",{key:K,class:"timeGroup"},[I("h3",gi,re(k.$t(`lemon.fileExplorer.timeGroups.${K}`)),1),I("div",wi,[(G(!0),ne(ke,null,Se(te,P=>(G(),ne("div",{key:P.id,class:"fileItem"},[ee(q,{checked:P.selected,"onUpdate:checked":he=>P.selected=he,onChange:E},null,8,["checked","onUpdate:checked"]),ee(at,{url:P.filepath,filepath:P.filepath,class:"svgItem"},null,8,["url","filepath"]),I("div",bi,[I("span",yi,re(P.filename.split("/").pop().split("\\").pop()),1),I("span",ki,re(le(mt)(P.timestamp)),1)])]))),128))])]))),128))])]),I("div",xi,[ee(A,{type:"primary",onClick:Z,class:Me(["btnDownload",g.value?"disableDownload":"enableDownload"])},{default:ue(()=>[ee(le(vt),{class:"svg"}),I("span",Ci,re(k.$t("lemon.fileExplorer.batchDownload")),1)]),_:1},8,["class"])])])):(G(),ne("div",Hr,[I("div",Vr,[I("h1",qr,re(k.$t("lemon.fileExplorer.allFilesInTask")),1),I("div",Gr,[I("div",Kr,[ee(le(vt),{onClick:B,class:Me(s.value?"disable":"svgDownload")},null,8,["class"])]),I("div",{class:"svg",onClick:$},[ee(le(nn),{class:"svgClose"})])])]),I("div",Yr,[I("div",Jr,[(G(),ne(ke,null,Se(o,te=>I("div",{key:te,class:Me(["classBtn",l.value===te?"active":""]),onClick:K=>l.value=te},re(k.$t(`lemon.fileExplorer.fileTypes.${te}`)),11,Xr)),64))]),s.value?s.value?(G(),ne("div",di,[I("div",hi,[ee(le(Ur))]),I("div",fi,[I("span",null,re(k.$t("lemon.fileExplorer.noContent")),1)])])):me("",!0):(G(),ne("div",Qr,[(G(!0),ne(ke,null,Se(i.value,(te,K)=>(G(),ne("div",{key:K,class:"timeGroup"},[I("h3",ei,re(k.$t(`lemon.fileExplorer.timeGroups.${K}`)),1),I("div",ti,[(G(!0),ne(ke,null,Se(te,P=>(G(),ne("div",{key:P.id,class:"fileItem",onClick:he=>y(P)},[ee(at,{url:P.filename,filepath:P.filepath,class:"svgItem"},null,8,["url","filepath"]),I("div",si,[I("div",ri,[I("div",ii,[I("span",ai,re(P.filename.split("/").pop().split("\\").pop()),1)]),I("span",oi,re(le(mt)(P.timestamp)),1)]),I("div",{class:"moreOption",onClick:H[0]||(H[0]=Re(()=>{},["stop"]))},[ee(M,{placement:"bottomRight",arrow:!1,color:"#ffffff",trigger:"click",visible:d.value[P.id]||!1,onVisibleChange:he=>F(P.id,he)},{title:ue(()=>[I("div",li,[I("div",{class:"svg-tooltip",onClick:he=>R(P)},[ee(le(Wr)),Ce(" "+re(k.$t("lemon.fileExplorer.preview")),1)],8,ci),I("div",{class:"svg-tooltip",onClick:he=>Q(P)},[ee(le(ln)),Ce(" "+re(k.$t("lemon.fileExplorer.download")),1)],8,ui)])]),default:ue(()=>[ee(le(on),{onClick:he=>n(P.id)},null,8,["onClick"])]),_:2},1032,["visible","onVisibleChange"])])])],8,ni))),128))])]))),128))]))])]))])]),_:1},8,["open"]),ee(rn,{url:m.value,visible:p.value,onClose:H[2]||(H[2]=te=>p.value=!1)},null,8,["url","visible"])],64)}}},Ei=Ie(Si,[["__scopeId","data-v-e8c0ea7c"]]),zi={class:"welcome-screen"},Ai={class:"welcome-content"},Ii={key:0},Oi={key:1},Ti={key:0,class:"agent-loading"},Li={class:"tip"},Mi={__name:"Welcome",props:{username:String},setup(ae){const V=De(),f=je(),{t:O}=He(),{chatInfo:w,mode:c}=Ee(V),l=ie(!1),s=ie("Creating Agent...");function d(r="Creating Agent..."){s.value=r,l.value=!0}function m(r){s.value=r}function p(){l.value=!1}const g=async r=>{const{text:o,files:t,mcp_server_ids:a,is_public:i,workMode:v}=r,b=await V.createConversation(o,c.value),{conversation_id:S}=b;if(c.value==="chat"&&S)f.push(`/lemon/chat/${S}`),await Ne.sendMessage(o,S,[],a,v);else{d("Creating Agent..."),await new Promise(D=>setTimeout(D,1e3)),m("Learning from the Experience base...");let E=await St.generate(o,S,i);p(),Be.emit("selectedAgent",E),f.push(`/lemon/${E.id}/${S}`),await Ne.sendMessage(o,S,t,a,v)}};_e(()=>c.value==="chat"?"ChatBot":"Agent");const _=()=>{console.log("toggleMobileMenu"),Be.emit("toggleMobileMenu",!0)};return(r,o)=>(G(),ne("div",zi,[I("div",{class:"welcome-header"},[I("button",{class:"mobile-menu-btn",onClick:_},o[0]||(o[0]=[I("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[I("path",{d:"M3 12H21",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),I("path",{d:"M3 6H21",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),I("path",{d:"M3 18H21",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)]))]),o[2]||(o[2]=I("div",{class:"welcome-mode"},null,-1)),I("div",Ai,[I("h1",null,re(r.$t("lemon.welcome.greeting",{username:ae.username})),1),le(c)=="chat"?(G(),ne("p",Ii,re(r.$t("lemon.welcome.question")),1)):(G(),ne("p",Oi,"Create, Training, Evoloving you new Agent")),ee(dt,{onSend:g})]),l.value?(G(),ne("div",Ti,[o[1]||(o[1]=I("div",{class:"loader"},null,-1)),I("p",Li,re(s.value),1)])):me("",!0)]))}},Bi=Ie(Mi,[["__scopeId","data-v-07c46877"]]),Di={class:"welcome-mode"},$i={key:0,class:"dropdown-menu"},Ri={class:"welcome-content"},Fi={__name:"AgentWelcome",props:{username:String},setup(ae){const V=De(),f=je(),{t:O}=He(),{mode:w,agent:c}=Ee(V),l=ie(null),s=ie(!1),d=()=>{console.log("editKnowledge"),g.value=!1,l.value.visible=!0},m=()=>{g.value=!1,s.value=!0},p=async o=>{const{text:t,files:a,mcp_server_ids:i,workMode:v}=o,b=await V.createConversation(t,w.value),{conversation_id:S}=b;S&&f.push(`/lemon/${c.value.id}/${S}`),w.value==="chat"?await Ne.sendMessage(t,S,[],i,v):await Ne.sendMessage(t,S,a,i,v)};_e(()=>"Agent");const g=ie(!1),_=()=>{g.value=!g.value},r=()=>{g.value=!1};return(o,t)=>(G(),ne("div",{class:"welcome-screen",onClick:r},[I("div",Di,[I("span",null,re(le(c).name),1),I("div",{class:"dropdown-icon-wrapper",onClick:Re(_,["stop"])},[ee(le(Qt),{class:"dropdown-icon"}),g.value?(G(),ne("div",$i,[I("div",{class:"menu-item",onClick:Re(m,["stop"])},[ee(le(en),{class:"icon"}),t[2]||(t[2]=Ce(" Edit "))]),I("div",{class:"menu-item",onClick:Re(d,["stop"])},[ee(le(gn),{class:"icon"}),t[3]||(t[3]=Ce(" Knowledge "))])])):me("",!0)])]),I("div",Ri,[I("h1",null,re(o.$t("lemon.welcome.greeting",{username:ae.username})),1),t[4]||(t[4]=I("p",null,"Create, Training, Evoloving you new Agent",-1)),ee(dt,{onSend:p})]),ee(wn,{ref_key:"knowledgeModalRef",ref:l,agentId:null},null,512),ee(bn,{visible:s.value,"onUpdate:visible":t[0]||(t[0]=a=>s.value=a),id:le(c).id,"onUpdate:id":t[1]||(t[1]=a=>le(c).id=a)},null,8,["visible","id"])]))}},Pi=Ie(Fi,[["__scopeId","data-v-9d790234"]]);function Ui(ae){console.log("convertToTree",ae);const V=new Map;ae.forEach(O=>{console.log("msg",O);let w=O.meta;typeof w=="string"&&(w=JSON.parse(w)),V.set(O.id,{id:O.id,pid:w.pid,role:O.role,content:O.content,is_active:w.is_active,children:[]})}),console.log("messageMap",V);const f=[];return V.forEach(O=>{if(O.pid===-1)f.push(O);else{const w=V.get(O.pid);w&&w.children.push(O)}}),f.sort((O,w)=>O.id-w.id),f}const Ni={convertToTree:Ui},ji=Xe(),Ae=De(),{chatInfo:Wi,mode:Zi,model_id:Hi,agent:Vi}=Ee(Ae),{membership:qi,points:Gi}=Ee(ji),st=ct();async function Ki(){const ae=localStorage.getItem("model_info");if(ae&&!JSON.parse(ae).is_subscribe)return;let V=await pn.getUserInfo();qi.value=V.membership,Gi.value=V.points}const Yi=async(ae,V)=>{ae.forEach(async f=>{await lt.putFile(f.id,V)})},Ji=ae=>{},Xi=()=>{console.log("throttledScrollToBottom")},Qi=async(ae,V,f,O=[],w="auto")=>{const c=new AbortController;let l=[];f&&f.length>0&&(l=f.map(a=>a.id),f=f.map(a=>{const i=`${a.workspace_dir}/Conversation_${V.slice(0,6)}/upload/${a.name}`,v=a.name;return{...a,filepath:i,filename:v}}),await Yi(f,V));let s=Ae.list.find(a=>a.conversation_id==V);s&&(s.status="running");const d=st.selectedHtml,m=st.selectedPath,p=st.selectedScreenshot;Ae.handleInitMessage(ae,f,p,m);let g="/api/agent/coding/sse",_={requirement:ae,selection:d,screenshot:p,filepath:m,agent_id:Vi.value.id,conversation_id:V,fileIds:l,mcp_server_ids:O,model_id:Hi.value,mode:w};console.log("options",_),console.log("mode.value",Zi.value),console.log("chatInfo.value",Wi.value);let r=null;cn(g,_,(a,i,v)=>{let b=Ae.list.find(E=>E.conversation_id==v);if(b&&b.status==="done")return;const S=Ae.conversationId;if(console.log("onTokenStream",i),i.startsWith("__lemon_mode__"))try{const E=i.substring(14);r=JSON.parse(E).mode;const L=Ae.messages.findLastIndex($=>$.role==="assistant"&&$.is_temp===!0);if(L!==-1){const $=Ae.messages[L];r=="chat"?($.meta={action_type:"chat"},$.content=""):$.content=it.global.t("lemon.message.botInitialResponse")}else if(r=="chat"){const $={content:"",role:"assistant",meta:{action_type:"chat"},is_temp:!0};Ae.messages.push($)}else{const $={content:it.global.t("lemon.message.botInitialResponse"),role:"assistant",is_temp:!0};Ae.messages.push($)}return}catch(E){console.error("Failed to parse mode data:",E);return}i&&i.startsWith("{")&&i.endsWith("}")&&S===v&&ea(i)},Ji(),"",Xi,c,V).then(a=>a).catch(a=>(console.error(a),"")).finally(()=>{Be.emit("coding-message-sent",{conversationId:V}),Ae.list.find(a=>a.conversation_id==V).status="done",Ki()})};function ea(ae,V){let f;try{f=JSON.parse(ae)}catch{console.error("Failed to parse JSON:",ae);return}console.log("=== ch === ",f);const O=Ae.messages,w=ta(O);w!==-1&&O.splice(w,1),sn.handleMessage(f,O),Ae.scrollToBottom()}function ta(ae){return ae.findIndex(V=>V.is_temp===!0&&V.role==="assistant")}const na={sendMessage:Qi},sa={class:"chat-layout"},ra={class:"chat-panel"},ia={key:1,class:"chat-panel-content"},aa={__name:"ChatPanel",setup(ae){const V=De(),f=kt(),{chatInfo:O,mode:w}=Ee(V),c=ct(),l=async o=>{const{text:t,mode:a,files:i,mcp_server_ids:v,workMode:b}=o;if(c.showSelectionPreview){c.setShowSelectionPreview(!1),await na.sendMessage(t,V.chat.conversation_id,i,v,b);return}await Ne.sendMessage(t,V.chat.conversation_id,i,v,b)},s=ie(f.params.id),d=_e(()=>f.params.agentId&&f.params.agentId!="chat");wt(()=>{console.log("route.params",f.params),s.value=f.params.id,f.params.id||(V.conversationId=null,V.chat=null,V.messages=[])});const m=_e(()=>V.chat);ie("");const p=_e(()=>{switch(console.log("出发了messages computed"),w.value){case"task":return V.messages;case"chat":return console.log("chatInfo.value.msgList",O.value.msgList),Ni.convertToTree(O.value.msgList);default:return V.messages}}),g=ie(!1);Je(()=>{const o=document.querySelector(".chat-messages");if(!o)return!1;o.addEventListener("scroll",()=>{o.scrollHeight-o.scrollTop-o.clientHeight>200?g.value=!0:g.value=!1})});const _=()=>{const o=document.querySelector(".chat-messages");if(!o)return!1;o.scrollTop=o.scrollHeight-o.clientHeight};ie(!1);const r=()=>{};return(o,t)=>{var a;return G(),ne("div",sa,[ee($n),I("div",ra,[d.value&&!s.value?(G(),be(Pi,{key:0,class:"welcome"})):s.value?(G(),ne("div",ia,[ee(un,{title:(a=m.value)==null?void 0:a.title,onShare:r},null,8,["title"]),ee(dn,{messages:p.value,mode:le(w)},null,8,["messages","mode"]),ee(dt,{onSend:l}),g.value?(G(),ne("div",{key:0,class:"scroll-to-bottom",onClick:_},[ee(le(Lr))])):me("",!0)])):(G(),be(Bi,{key:2,class:"welcome"})),ee(Ei)]),ee(hn,{class:"preview"}),ee(fn,{class:"preview"})])}}},Ca=Ie(aa,[["__scopeId","data-v-a6bdabfc"]]);export{Ca as default};
