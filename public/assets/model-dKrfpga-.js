import{a as s,I as ae,_ as ee,i as R,h as c,w as p,l as r,c as h,aI as Z,U as ue,V as ne,a4 as pe,j as P,a5 as fe,k as E,P as ve,X as re,u as V,r as y,g as w,t as _,B as _e,aD as Ve,aJ as Ge,aK as ze,F as W,Y,af as ie,aG as Se,aL as He,aM as de,e as q,o as le,A as be,a3 as Je,aN as De,aO as Ie,aE as qe,av as We,W as Qe,aP as Ye,v as ke,a9 as oe,aQ as Xe}from"./index-C9fJEsZT.js";import{h as G}from"./http-B5vhwVWP.js";import"./marked.esm-BktMfnUh.js";import{e as B}from"./emitter-E5P-NQ8u.js";import{G as ce}from"./GlobalOutlined-CesCSQX0.js";import{T as me}from"./ToolOutlined-CEDchPG2.js";import{S as Te}from"./SettingOutlined-FVVhqs6f.js";import{A as Oe}from"./driver-BxHdV7Lz.js";import{u as Ce}from"./user-MVXz8V5n.js";var Ze={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M740 161c-61.8 0-112 50.2-112 112 0 50.1 33.1 92.6 78.5 106.9v95.9L320 602.4V318.1c44.2-15 76-56.9 76-106.1 0-61.8-50.2-112-112-112s-112 50.2-112 112c0 49.2 31.8 91 76 106.1V706c-44.2 15-76 56.9-76 106.1 0 61.8 50.2 112 112 112s112-50.2 112-112c0-49.2-31.8-91-76-106.1v-27.8l423.5-138.7a50.52 50.52 0 0034.9-48.2V378.2c42.9-15.8 73.6-57 73.6-105.2 0-61.8-50.2-112-112-112zm-504 51a48.01 48.01 0 0196 0 48.01 48.01 0 01-96 0zm96 600a48.01 48.01 0 01-96 0 48.01 48.01 0 0196 0zm408-491a48.01 48.01 0 010-96 48.01 48.01 0 010 96z"}}]},name:"branches",theme:"outlined"};function Pe(o){for(var t=1;t<arguments.length;t++){var l=arguments[t]!=null?Object(arguments[t]):{},e=Object.keys(l);typeof Object.getOwnPropertySymbols=="function"&&(e=e.concat(Object.getOwnPropertySymbols(l).filter(function(i){return Object.getOwnPropertyDescriptor(l,i).enumerable}))),e.forEach(function(i){Ke(o,i,l[i])})}return o}function Ke(o,t,l){return t in o?Object.defineProperty(o,t,{value:l,enumerable:!0,configurable:!0,writable:!0}):o[t]=l,o}var K=function(t,l){var e=Pe({},t,l.attrs);return s(ae,Pe({},e,{icon:Ze}),null)};K.displayName="BranchesOutlined";K.inheritAttrs=!1;var $e={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M864 248H728l-32.4-90.8a32.07 32.07 0 00-30.2-21.2H358.6c-13.5 0-25.6 8.5-30.1 21.2L296 248H160c-44.2 0-80 35.8-80 80v456c0 44.2 35.8 80 80 80h704c44.2 0 80-35.8 80-80V328c0-44.2-35.8-80-80-80zm8 536c0 4.4-3.6 8-8 8H160c-4.4 0-8-3.6-8-8V328c0-4.4 3.6-8 8-8h186.7l17.1-47.8 22.9-64.2h250.5l22.9 64.2 17.1 47.8H864c4.4 0 8 3.6 8 8v456zM512 384c-88.4 0-160 71.6-160 160s71.6 160 160 160 160-71.6 160-160-71.6-160-160-160zm0 256c-53 0-96-43-96-96s43-96 96-96 96 43 96 96-43 96-96 96z"}}]},name:"camera",theme:"outlined"};function we(o){for(var t=1;t<arguments.length;t++){var l=arguments[t]!=null?Object(arguments[t]):{},e=Object.keys(l);typeof Object.getOwnPropertySymbols=="function"&&(e=e.concat(Object.getOwnPropertySymbols(l).filter(function(i){return Object.getOwnPropertyDescriptor(l,i).enumerable}))),e.forEach(function(i){et(o,i,l[i])})}return o}function et(o,t,l){return t in o?Object.defineProperty(o,t,{value:l,enumerable:!0,configurable:!0,writable:!0}):o[t]=l,o}var $=function(t,l){var e=we({},t,l.attrs);return s(ae,we({},e,{icon:$e}),null)};$.displayName="CameraOutlined";$.inheritAttrs=!1;var tt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M872 474H152c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h720c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8z"}}]},name:"minus",theme:"outlined"};function Me(o){for(var t=1;t<arguments.length;t++){var l=arguments[t]!=null?Object(arguments[t]):{},e=Object.keys(l);typeof Object.getOwnPropertySymbols=="function"&&(e=e.concat(Object.getOwnPropertySymbols(l).filter(function(i){return Object.getOwnPropertyDescriptor(l,i).enumerable}))),e.forEach(function(i){ot(o,i,l[i])})}return o}function ot(o,t,l){return t in o?Object.defineProperty(o,t,{value:l,enumerable:!0,configurable:!0,writable:!0}):o[t]=l,o}var ge=function(t,l){var e=Me({},t,l.attrs);return s(ae,Me({},e,{icon:tt}),null)};ge.displayName="MinusOutlined";ge.inheritAttrs=!1;var lt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 112H724V72c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v40H500V72c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v40H320c-17.7 0-32 14.3-32 32v120h-96c-17.7 0-32 14.3-32 32v632c0 17.7 14.3 32 32 32h512c17.7 0 32-14.3 32-32v-96h96c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32zM664 888H232V336h218v174c0 22.1 17.9 40 40 40h174v338zm0-402H514V336h.2L664 485.8v.2zm128 274h-56V456L544 264H360v-80h68v32c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-32h152v32c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-32h68v576z"}}]},name:"snippets",theme:"outlined"};function Ae(o){for(var t=1;t<arguments.length;t++){var l=arguments[t]!=null?Object(arguments[t]):{},e=Object.keys(l);typeof Object.getOwnPropertySymbols=="function"&&(e=e.concat(Object.getOwnPropertySymbols(l).filter(function(i){return Object.getOwnPropertyDescriptor(l,i).enumerable}))),e.forEach(function(i){at(o,i,l[i])})}return o}function at(o,t,l){return t in o?Object.defineProperty(o,t,{value:l,enumerable:!0,configurable:!0,writable:!0}):o[t]=l,o}var se=function(t,l){var e=Ae({},t,l.attrs);return s(ae,Ae({},e,{icon:lt}),null)};se.displayName="SnippetsOutlined";se.inheritAttrs=!1;const U={async getPlatforms(){const t=await G.get("/api/platform");return Array.isArray(t)?t:(t==null?void 0:t.data)||[]},async insertPlatform(o){return await G.post("/api/platform",o)||{}},async updatePlatform(o){const t=`/api/platform/${o.id}`;return(await G.put(t,o)).data||{}},async deletePlatform(o){const t=`/api/platform/${o}`;return(await G.del(t)).data||{}},async getModels(o){const t=`/api/model/list/${o}`;return await G.get(t)||[]},async deleteModel(o){const t=`/api/model/${o}`;return(await G.del(t,{id:o})).data||{}},async insertModel(o){return await G.post("/api/model",o)||{}},async updateModel(o){const t=`/api/model/${o.id}`;return(await G.put(t,o)).data||{}},async checkApiAvailability(o){return await G.post("/api/platform/check_api_availability",o)||{}}},nt="#4ECDC4",rt={__name:"addPlatform",emits:["add-platform"],setup(o,{expose:t,emit:l}){const{t:e}=V(),i=l,k=y(!1),d=y(null),a=y(null),m=y({name:"",provider_type:"OpenAI",logo_url:"",source_type:"user"}),f={name:[{required:!0,message:e("setting.modelService.enterName"),trigger:"blur"}],provider_type:[{required:!0,message:e("setting.modelService.selectType"),trigger:"change"}]},g=()=>{d.value.click()},O=async A=>{const n=A.target.files[0];if(n){if(!["image/png","image/jpeg","image/gif","image/webp"].includes(n.type)){console.error("Invalid file type. Please select an image (PNG, JPEG, GIF, or WebP).");return}const H=()=>new Promise((S,D)=>{const I=new FileReader;I.onload=L=>{S(L.target.result)},I.onerror=L=>{D(L)},I.readAsDataURL(n)});try{const S=await H();m.value.logo_url=S}catch{}}},v=async()=>{try{U.insertPlatform(m.value).then(A=>{A.id!==void 0?(w.success(e("setting.modelService.addPlatformSuccess")),i("add-platform",A),B.emit("fresh-pages")):w.error(e("setting.modelService.addPlatformFailed"))}),k.value=!1,N()}catch(A){console.error("Form validation failed:",A),w.error(e("setting.modelService.formValidationFailed"))}},M=()=>{k.value=!1,N()},N=()=>{var A;m.value={name:"",provider_type:"OpenAI",logo_url:"",source_type:"user"},(A=a.value)==null||A.resetFields()},F=()=>{k.value=!0};t({showModal:F});const C={t:e,emit:i,visible:k,fileInput:d,formRef:a,defaultColor:nt,formData:m,rules:f,triggerFileInput:g,handleFileChange:O,handleOk:v,handleCancel:M,resetForm:N,showModal:F,ref:y,get useI18n(){return V},get service(){return U},get message(){return w},get emitter(){return B}};return Object.defineProperty(C,"__isScriptSetup",{enumerable:!1,value:!0}),C}},st={class:"add-platform-form"},it=["src","alt"];function dt(o,t,l,e,i,k){const d=ne,a=ue,m=fe,f=pe,g=ve,O=re;return c(),R(O,{open:e.visible,"onUpdate:open":t[2]||(t[2]=v=>e.visible=v),title:o.$t("setting.modelService.addProvider"),onOk:e.handleOk,onCancel:e.handleCancel,maskClosable:!1,centered:!0,okText:o.$t("setting.modelService.confirm"),cancelText:o.$t("setting.modelService.cancel")},{default:p(()=>[r("div",st,[r("div",{class:"platform-logo-upload",onClick:e.triggerFileInput},[e.formData.logo_url?(c(),h("img",{key:1,src:e.formData.logo_url,alt:o.$t("setting.modelService.platformLogo"),class:"platform-logo"},null,8,it)):(c(),h("div",{key:0,class:"platform-letter",style:Z({backgroundColor:e.defaultColor})}," P ",4)),r("input",{type:"file",ref:"fileInput",style:{display:"none"},accept:"image/*",onChange:e.handleFileChange},null,544)]),s(g,{model:e.formData,rules:e.rules,ref:"formRef"},{default:p(()=>[s(a,{label:o.$t("setting.modelService.providerName"),name:"name"},{default:p(()=>[s(d,{value:e.formData.name,"onUpdate:value":t[0]||(t[0]=v=>e.formData.name=v),placeholder:o.$t("setting.modelService.namePlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),s(a,{label:o.$t("setting.modelService.providerType"),name:"type",style:{"margin-left":"10px"}},{default:p(()=>[s(f,{value:e.formData.provider_type,"onUpdate:value":t[1]||(t[1]=v=>e.formData.provider_type=v),placeholder:o.$t("setting.modelService.typePlaceholder")},{default:p(()=>[s(m,{value:"openai"},{default:p(()=>t[3]||(t[3]=[E("OpenAI")])),_:1}),P(" only support OpenAI "),P(` <a-select-option value="gemini">Gemini</a-select-option>
            <a-select-option value="anthropic">Anthropic</a-select-option>
            <a-select-option value="azure">Azure OpenAI</a-select-option> `)]),_:1},8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])])]),_:1},8,["open","title","okText","cancelText"])}const ct=ee(rt,[["render",dt],["__scopeId","data-v-08f9b186"],["__file","/Users/samihalawa/git/PROJECTS_CODING/lemonai/frontend/src/components/platforms/addPlatform.vue"]]),mt="#4ECDC4",ut={__name:"settingPlatform",emits:["update-platform"],setup(o,{expose:t,emit:l}){const{t:e}=V(),i=l,k=y(!1),d=y(null),a=y(null),m=y("OpenAI"),f=y({id:"",name:"",provider_type:"",logo_url:"",source_type:"user",api_key:"",api_url:"",api_version:"",is_enabled:!0,activate_time:-1,key_obtain_url:""}),g={name:[{required:!0,message:e("setting.modelService.enterName"),trigger:"blur"}],provider_type:[{required:!0,message:e("setting.modelService.selectType"),trigger:"change"}]},O=()=>{d.value.click()},v=async n=>{const x=n.target.files[0];if(x){if(!["image/png","image/jpeg","image/gif","image/webp"].includes(x.type)){console.error("Invalid file type. Please select an image (PNG, JPEG, GIF, or WebP).");return}const S=()=>new Promise((D,I)=>{const L=new FileReader;L.onload=Q=>{D(Q.target.result)},L.onerror=Q=>{I(Q)},L.readAsDataURL(x)});try{const D=await S();f.value.logo_url=D,console.log("Selected file:",x),console.log("Form data:",f.value)}catch(D){console.error("Error loading image:",D)}}},M=async()=>{try{await a.value.validate(),U.updatePlatform(f.value).then(n=>{i("update-platform",n),B.emit("fresh-pages"),w.success(e("setting.modelService.updatePlatformSuccess"))}),k.value=!1}catch{}},N=()=>{k.value=!1},F=async()=>{try{const n=await U.deletePlatform(f.value.id);console.log(n),n.code===0&&w.success(e("setting.modelService.deletePlatformSuccess")),k.value=!1,B.emit("fresh-pages")}catch(n){console.error("Failed to delete platform:",n)}},C=n=>{f.value={...n},k.value=!0};t({showModal:C});const A={t:e,emit:i,visible:k,fileInput:d,formRef:a,defaultColor:mt,OpenAI:m,formData:f,rules:g,triggerFileInput:O,handleFileChange:v,handleOk:M,handleCancel:N,handleDelete:F,showModal:C,ref:y,get useI18n(){return V},get DeleteOutlined(){return Ve},get service(){return U},get message(){return w},get emitter(){return B}};return Object.defineProperty(A,"__isScriptSetup",{enumerable:!1,value:!0}),A}},pt={style:{display:"flex","align-items":"center","justify-content":"start"}},ft={class:"add-platform-form"},vt=["src","alt"];function _t(o,t,l,e,i,k){const d=_e,a=ne,m=ue,f=fe,g=pe,O=ve,v=re;return c(),R(v,{open:e.visible,"onUpdate:open":t[2]||(t[2]=M=>e.visible=M),maskClosable:!1,centered:!0,okText:o.$t("setting.modelService.confirm"),cancelText:o.$t("setting.modelService.cancel"),onOk:e.handleOk,onCancel:e.handleCancel},{title:p(()=>[r("div",pt,[r("span",null,_(o.$t("setting.modelService.editProvider")),1),s(d,{type:"text",danger:"",class:"delete-button"},{default:p(()=>[s(e.DeleteOutlined,{onClick:e.handleDelete})]),_:1})])]),default:p(()=>[r("div",ft,[r("div",{class:"platform-logo-upload",onClick:e.triggerFileInput},[e.formData.logo_url?(c(),h("img",{key:1,src:e.formData.logo_url,alt:o.$t("setting.modelService.platformLogo"),class:"platform-logo"},null,8,vt)):(c(),h("div",{key:0,class:"platform-letter",style:Z({backgroundColor:e.defaultColor})},_(e.formData.name?e.formData.name.charAt(0):"P"),5)),r("input",{type:"file",ref:"fileInput",style:{display:"none"},accept:"image/*",onChange:e.handleFileChange},null,544)]),s(O,{model:e.formData,rules:e.rules,ref:"formRef"},{default:p(()=>[s(m,{label:o.$t("setting.modelService.providerName"),name:"name"},{default:p(()=>[s(a,{value:e.formData.name,"onUpdate:value":t[0]||(t[0]=M=>e.formData.name=M),placeholder:o.$t("setting.modelService.namePlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),s(m,{label:o.$t("setting.modelService.providerType"),name:"type",style:{"margin-left":"10px"}},{default:p(()=>[P(' <a-select v-model:value="formData.provider_type"> '),s(g,{value:e.OpenAI,"onUpdate:value":t[1]||(t[1]=M=>e.OpenAI=M)},{default:p(()=>[s(f,{value:"OpenAI"},{default:p(()=>t[3]||(t[3]=[E("OpenAI")])),_:1})]),_:1},8,["value"])]),_:1},8,["label"])]),_:1},8,["model"])])]),_:1},8,["open","okText","cancelText"])}const gt=ee(ut,[["render",_t],["__scopeId","data-v-ef151620"],["__file","/Users/samihalawa/git/PROJECTS_CODING/lemonai/frontend/src/components/platforms/settingPlatform.vue"]]),ht={__name:"modelinfo",props:{platform_id:{type:Number,default:-1}},setup(o,{expose:t}){const{t:l}=V(),e=y(!1),i=y(null),k=y(!1),d=y(!1),a=o,m=y({model_id:"",model_name:"",group_name:"",model_types:[],platform_id:-1,logo_url:""}),f={model_id:[{required:!0,message:l("setting.modelService.enterModelId"),trigger:"blur"}],model_name:[{required:!1,message:l("setting.modelService.enterModelName"),trigger:"blur"}],group_name:[{required:!1,message:l("setting.modelService.enterGroupName"),trigger:"blur"}],model_types:[{required:!1,type:"array",message:l("setting.modelService.selectModelType"),trigger:"change"}]},g=async()=>{try{if(await i.value.validate(),k.value)await U.updateModel(m.value),B.emit("fresh-models",!0),w.success(l("setting.modelService.updateModelSuccess"));else{m.value.platform_id=a.platform_id;const C=await U.insertModel(m.value);if(C.code===1){w.error(l("setting.modelService.modelAlreadyExists"));return}B.emit("fresh-models",C),w.success(l("setting.modelService.addModelSuccess"))}e.value=!1,v()}catch(C){console.error("Form validation failed:",C),w.error(l("setting.modelService.formValidationFailed"))}},O=()=>{e.value=!1,v()},v=()=>{var C;m.value={model_id:"",model_name:"",group_name:"",model_types:[],platform_id:a.platform_id,logo_url:""},d.value=!1,(C=i.value)==null||C.resetFields()},M=(C=null)=>{C?(k.value=!0,m.value={...C,model_name:C.model_name||"",model_types:C.model_types||[],platform_id:C.platform_id||a.platform_id}):(k.value=!1,v()),e.value=!0},N=()=>{d.value=!d.value};t({showModal:M});const F={t:l,visible:e,formRef:i,isEdit:k,showModelTypes:d,props:a,formData:m,rules:f,handleOk:g,handleCancel:O,resetForm:v,showModal:M,toggleModelTypes:N,ref:y,get useI18n(){return V},get service(){return U},get message(){return w},get emitter(){return B}};return Object.defineProperty(F,"__isScriptSetup",{enumerable:!1,value:!0}),F}},yt={class:"model-form"},St={class:"more-options"};function bt(o,t,l,e,i,k){const d=ne,a=ue,m=ze,f=Ge,g=ve,O=re;return c(),R(O,{open:e.visible,"onUpdate:open":t[4]||(t[4]=v=>e.visible=v),title:e.isEdit?o.$t("setting.modelService.editModel"):o.$t("setting.modelService.addModel"),onOk:e.handleOk,onCancel:e.handleCancel,maskClosable:!1,centered:!0,okText:o.$t("setting.modelService.confirm"),cancelText:o.$t("setting.modelService.cancel")},{default:p(()=>[r("div",yt,[s(g,{model:e.formData,rules:e.rules,ref:"formRef"},{default:p(()=>[s(a,{label:o.$t("setting.modelService.modelId"),name:"model_id",style:{display:"flex","justify-content":"end"}},{default:p(()=>[s(d,{value:e.formData.model_id,"onUpdate:value":t[0]||(t[0]=v=>e.formData.model_id=v),placeholder:o.$t("setting.modelService.modelIdPlaceholder"),disabled:e.isEdit},null,8,["value","placeholder","disabled"])]),_:1},8,["label"]),s(a,{label:o.$t("setting.modelService.modelName"),name:"model_name"},{default:p(()=>[s(d,{value:e.formData.model_name,"onUpdate:value":t[1]||(t[1]=v=>e.formData.model_name=v),placeholder:o.$t("setting.modelService.modelNamePlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),s(a,{label:o.$t("setting.modelService.groupName"),name:"group_name"},{default:p(()=>[s(d,{value:e.formData.group_name,"onUpdate:value":t[2]||(t[2]=v=>e.formData.group_name=v),placeholder:o.$t("setting.modelService.groupNamePlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),r("div",St,[r("a",{onClick:e.toggleModelTypes,class:"toggle-link"},_(e.showModelTypes?o.$t("setting.modelService.hideOptions"):o.$t("setting.modelService.showMoreOptions")),1)]),e.showModelTypes?(c(),R(a,{key:0,label:o.$t("setting.modelService.modelTypes"),name:"model_types",class:"model-types-item"},{default:p(()=>[s(f,{value:e.formData.model_types,"onUpdate:value":t[3]||(t[3]=v=>e.formData.model_types=v),class:"model-type-group"},{default:p(()=>[s(m,{class:"checkbox-item",value:"vision"},{default:p(()=>[E(_(o.$t("setting.modelService.typeVision")),1)]),_:1}),s(m,{class:"checkbox-item",value:"network"},{default:p(()=>[E(_(o.$t("setting.modelService.typeNetwork")),1)]),_:1}),s(m,{class:"checkbox-item",value:"embed"},{default:p(()=>[E(_(o.$t("setting.modelService.typeEmbed")),1)]),_:1}),s(m,{class:"checkbox-item",value:"tool"},{default:p(()=>[E(_(o.$t("setting.modelService.typeTool")),1)]),_:1}),s(m,{class:"checkbox-item",value:"reasoning"},{default:p(()=>[E(_(o.$t("setting.modelService.typeReasoning")),1)]),_:1})]),_:1},8,["value"])]),_:1},8,["label"])):P("v-if",!0)]),_:1},8,["model"])])]),_:1},8,["open","title","okText","cancelText"])}const kt=ee(ht,[["render",bt],["__scopeId","data-v-7a539ac2"],["__file","/Users/samihalawa/git/PROJECTS_CODING/lemonai/frontend/src/components/platforms/modelinfo.vue"]]),Ot={__name:"modelsList",props:{models:{type:Array,default:()=>[]},platform_id:{type:Number,default:-1},is_subscribe:{type:Boolean,default:!1}},emits:["setting","delete","add-model","update-model"],setup(o,{expose:t,emit:l}){t();const{t:e}=V(),i=o,k=l,d=y({}),a=y(null),m=y({}),f=q(()=>{const S={};return i.models.forEach(D=>{const I=D.group_name||e("setting.modelService.ungrouped");S[I]||(S[I]={name:I,models:[]},d.value[I]===void 0&&(d.value[I]=!0)),S[I].models.push(D)}),Object.values(S)}),g=S=>{d.value[S]=!d.value[S]},O=y({}),v=["#FF6B6B","#4ECDC4","#45B7D1","#96CEB4","#FFEEAD","#D4A5A5","#9B59B6","#3498DB"],M=S=>{if(!O.value[S]){const D=Math.abs(S.split("").reduce((I,L)=>I+L.charCodeAt(0),0))%v.length;O.value[S]=v[D]}return O.value[S]},N=(S=null)=>{a.value.showModal(S),k("setting",S)},F=async S=>{try{await U.deleteModel(S.id),B.emit("fresh-models"),w.success(e("setting.modelService.deleteModelSuccess"))}catch(D){console.error("Failed to delete model:",D),w.error(e("setting.modelService.deleteModelFailed"))}},C={tool:{component:me,class:"type-tool"},network:{component:ce,class:"type-network"},embed:{component:()=>be("div",{},"em"),class:"type-embed"},reasoning:{component:K,class:"type-reasoning"},vision:{component:$,class:"type-vision"}};le(()=>{});const H={t:e,props:i,emit:k,groupStates:d,modelInfoRef:a,copyState:m,groupedModels:f,toggleGroup:g,modelColors:O,colors:v,getRandomColor:M,handleModelSetting:N,handleModelDelete:F,typeIconMap:C,handleAddModel:S=>{},handleUpdateModel:S=>{k("update-model",S)},copyModelName:(S,D)=>{navigator.clipboard.writeText(D).then(()=>{m.value[S]={isCopied:!0},w.success(e("setting.modelService.copySuccess")),setTimeout(()=>{m.value[S]={isCopied:!1}},2e3)}).catch(I=>{console.error("Failed to copy:",I),w.error(e("setting.modelService.copyFailed"))})},computed:q,ref:y,h:be,onMounted:le,get useI18n(){return V},get SettingOutlined(){return Te},get MinusOutlined(){return ge},get PlusOutlined(){return qe},get DownOutlined(){return Ie},get RightOutlined(){return De},get SnippetsOutlined(){return se},get CheckOutlined(){return Je},get ToolOutlined(){return me},get GlobalOutlined(){return ce},get BranchesOutlined(){return K},get CameraOutlined(){return $},get message(){return w},ModelInfo:kt,get service(){return U},get emitter(){return B}};return Object.defineProperty(H,"__isScriptSetup",{enumerable:!1,value:!0}),H}},Ct={class:"platform-model-container"},Pt={class:"model-header"},wt={class:"models-list"},Mt=["onClick"],At={class:"group-toggle"},Dt={class:"group-name"},It={class:"model-logo"},Tt={key:0,class:"logo-image"},Nt=["src"],Ft={class:"model-info"},Bt={style:{display:"flex","flex-direction":"row","justify-items":"center","align-items":"center",gap:"5px"}},Ut={style:{display:"flex","justify-content":"center","align-content":"center"}},Lt={class:"model-name"},jt={style:{display:"flex","flex-direction":"row","justify-items":"center","align-items":"center"}},Et={key:0,class:"model-actions"},xt={class:"model-more-detail"},Rt={key:0};function Vt(o,t,l,e,i,k){const d=He,a=_e;return c(),h("div",Ct,[r("div",Pt,[r("span",null,_(o.$t("setting.modelService.models")),1)]),r("div",wt,[(c(!0),h(W,null,Y(e.groupedModels,m=>(c(),h("div",{key:m.name,class:"model-group"},[r("div",{class:"group-header",onClick:f=>e.toggleGroup(m.name)},[r("span",At,[e.groupStates[m.name]?(c(),R(e.DownOutlined,{key:0})):(c(),R(e.RightOutlined,{key:1}))]),r("span",Dt,_(m.name),1)],8,Mt),r("div",{class:ie(["model-items",{collapsed:!e.groupStates[m.name]}])},[(c(!0),h(W,null,Y(m.models,f=>(c(),h("div",{key:f.id,class:"model-item"},[r("div",It,[f.logo_url?(c(),h("div",Tt,[r("img",{src:f.logo_url,alt:"logo"},null,8,Nt)])):(c(),h("div",{key:1,class:"logo-letter",style:Z({backgroundColor:e.getRandomColor(f.model_id)})},_(f.model_id.charAt(0)),5))]),r("div",Ft,[s(d,null,{content:p(()=>{var g;return[r("div",Bt,[r("span",Ut,_(f.model_name),1),(c(),R(Se((g=e.copyState[f.model_id])!=null&&g.isCopied?e.CheckOutlined:e.SnippetsOutlined),{style:{"align-items":"center"},onClick:O=>e.copyModelName(f.model_id,f.model_name)},null,8,["onClick"]))])]}),default:p(()=>[r("span",Lt,_(f.model_name),1)]),_:2},1024),(c(!0),h(W,null,Y(f.model_types,g=>(c(),h("div",{class:"model-type",key:g},[s(d,null,{content:p(()=>[r("div",jt,[r("span",null,_(g),1)])]),default:p(()=>{var O,v;return[e.typeIconMap[g]?(c(),R(Se((O=e.typeIconMap[g])==null?void 0:O.component),{key:0,class:ie([(v=e.typeIconMap[g])==null?void 0:v.class,"type-icon"])},null,8,["class"])):P("v-if",!0)]}),_:2},1024)]))),128))]),l.is_subscribe?P("v-if",!0):(c(),h("div",Et,[s(e.SettingOutlined,{class:"action-icon",onClick:de(g=>e.handleModelSetting(f),["stop"])},null,8,["onClick"]),s(e.MinusOutlined,{class:"action-icon",onClick:de(g=>e.handleModelDelete(f),["stop"])},null,8,["onClick"])]))]))),128))],2)]))),128))]),r("div",xt,[r("span",null,_(o.$t("setting.modelService.viewOfficialDocs")),1)]),l.is_subscribe?P("v-if",!0):(c(),h("div",Rt,[s(a,{type:"primary",class:"addmodel",onClick:t[0]||(t[0]=m=>e.handleModelSetting())},{default:p(()=>[s(e.PlusOutlined),E(" "+_(o.$t("setting.modelService.add")),1)]),_:1})])),P(" 集成 ModelInfo 组件 "),s(e.ModelInfo,{platform_id:e.props.platform_id,ref:"modelInfoRef"},null,8,["platform_id"])])}const Gt=ee(Ot,[["render",Vt],["__scopeId","data-v-5f091aa9"],["__file","/Users/samihalawa/git/PROJECTS_CODING/lemonai/frontend/src/components/platforms/modelsList.vue"]]),zt={__name:"model",setup(o,{expose:t}){t();const{t:l}=V(),{user:e,membership:i,points:k}=Ce(),d=y([]),a=y({id:"default",name:"OpenAI"}),m=y(""),f=y([]),g=y({}),O=y(!1),v=y(!0),M=y(!1),N=y(null),F=y(!1),C=async()=>{M.value=!0},A=async()=>{if(!N.value){w.error(l("setting.modelService.selectCheckModel"));return}M.value=!1,F.value=!0;let u=await U.checkApiAvailability({base_url:a.value.api_url,api_key:a.value.api_key,model:N.value});if(F.value=!1,u.status)w.success(l("setting.modelService.apiCallSucceeded"));else if(u.message.startsWith("LLM API call failed")){let b=u.message.replace("LLM API call failed",l("setting.modelService.apiCallFailed"));w.error(b)}else if(u.message.startsWith("LLM API call timed out")){let b=u.message.replace("LLM API call timed out",l("setting.modelService.apiCallTimeout"));w.error(b)}else if(u.message.startsWith("Network or other error occurred during LLM API call")){let b=u.message.replace("Network or other error occurred during LLM API call",l("setting.modelService.unknownError"));w.error(b)}};function n(u){const b=`setting.modelService.platforms.${u.replace(" ","")}`,T=l(b);return T===b?u:T}B.on("fresh-models",u=>{z(a.value.id)});const x=q(()=>a.value.name.toLocaleString()==="Ollama"),H=q(()=>a.value.name==="Cloudsway"?l("setting.modelService.ak"):l("setting.modelService.apiKey")),S=q(()=>a.value.name==="Cloudsway"?l("setting.modelService.akPlaceholder"):l("setting.modelService.apiKeyPlaceholder")),D=u=>{a.value=JSON.parse(JSON.stringify(u)),g.value={api_key:u.api_key,api_url:u.api_url,is_enabled:u.is_enabled},z(a.value.id),v.value=!0};ke([()=>a.value.api_key,()=>a.value.api_url,()=>a.value.is_enabled],()=>{g.value&&(O.value=a.value.api_key!==g.value.api_key||a.value.api_url!==g.value.api_url||a.value.is_enabled!==g.value.is_enabled)},{deep:!0});const I=async()=>{try{await U.updatePlatform({id:a.value.id,api_key:a.value.api_key,api_url:a.value.api_url,is_enabled:a.value.is_enabled,name:a.value.name,logo_url:a.value.logo_url,provider_type:a.value.provider_type,api_version:a.value.api_version}),g.value={api_key:a.value.api_key,api_url:a.value.api_url,is_enabled:a.value.is_enabled},O.value=!1}catch{return}te(a.value.id)},L=y(null),Q=y(null),Ne=()=>{var u;(u=L.value)==null||u.showModal()},Fe=()=>{var u;(u=Q.value)==null||u.showModal(a.value)},Be=u=>{f.value=f.value.filter(b=>b.id!==u.id)},Ue=u=>{const b={...u,is_enabled:!0,source_type:"user",color:X[d.value.length%X.length]};d.value=[...d.value,b],a.value=b,z(a.value.id)},Le=u=>{const b=d.value.findIndex(T=>T.id===u.id);b!==-1&&(d.value[b]={...u,color:d.value[b].color},a.value.id===u.id&&(a.value=d.value[b]))},X=["#FF6B6B","#4ECDC4","#45B7D1","#96CEB4","#FFEEAD","#D4A5A5","#9B59B6","#3498DB"];le(async()=>{setTimeout(()=>{console.log("触发 closeTour"),B.emit("closeTour")},500),await te(),localStorage.getItem("tour")==="true"&&localStorage.getItem("tour_end")!=="true"&&he()});let J=null;const he=async()=>{J=Oe({animate:!0,showProgress:!0,prevBtnText:l("setting.prevStep"),nextBtnText:l("setting.nextStep"),doneBtnText:l("setting.doneStep"),steps:[{element:".platform-list",popover:{side:"bottom",title:l("setting.modelService.modelService"),description:l("setting.modelService.modelServiceTipsOne"),onNextClick:async()=>{oe(()=>{J.moveNext()})}}},{element:"#api-key-value",popover:{side:"bottom",title:l("setting.modelService.modelService"),description:l("setting.modelService.modelServiceTipsTwo"),onNextClick:async()=>{oe(()=>{J.moveNext()})}}},{element:".platform-status",popover:{side:"bottom",title:l("setting.modelService.modelService"),description:l("setting.modelService.modelServiceTipsThree"),onNextClick:async()=>{oe(()=>{localStorage.setItem("tour_end","true"),J.moveNext(),B.emit("onSearchService")})}}}]}),J.drive()};function te(u){return U.getPlatforms().then(b=>{if(!Array.isArray(b)){console.error("getPlatforms did not return an array:",typeof b,b);return}if(console.log("Platforms loaded:",b.length),i&&(i!=null&&i.startDate)&&(i!=null&&i.endDate)){const T=new Date(i.startDate),j=new Date(i.endDate);!isNaN(T.getTime())&&isNaN(j.getTime())}d.value=b.sort((T,j)=>T.name.localeCompare(j.name)).map((T,j)=>({...T,color:X[j%X.length]})),console.log("platforms.value after assignment:",d.value),u?(a.value=d.value.find(T=>T.id===u),z(a.value.id)):(a.value=d.value[0],z(a.value.id))}).catch(b=>{console.error("Error in init getPlatforms:",b)})}const z=u=>{U.getModels(u).then(b=>{var T;f.value=b,N.value=(T=b[0])==null?void 0:T.model_id})},je=q(()=>{const b=[...Array.isArray(d.value)?d.value:[]].sort((j,Re)=>(Re.is_enabled?1:0)-(j.is_enabled?1:0));if(!m.value)return b;const T=m.value.toLowerCase();return b.filter(j=>j.name&&j.name.toLowerCase().includes(T)||n(j.name).includes(T))}),Ee=async u=>{z(a.value.id)},xe=async u=>{z(a.value.id)};B.on("fresh-pages",u=>{te()});const ye={t:l,user:e,membership:i,points:k,platforms:d,choose_platform:a,searchQuery:m,models:f,originalInfo:g,isInfoChanged:O,showInfoPlatform:v,modelVisible:M,selectedModel:N,checkLoading:F,handleCheckApiKey:C,handleOk:A,getPlatformDisplayName:n,handleShowCheckButton:x,handleApiTitle:H,handleApiPlaceholder:S,handlePlatform:D,handleSaveChanges:I,addPlatformRef:L,settingPlatformRef:Q,handlePlatformAdd:Ne,handlePlatformSetting:Fe,handleModelDelete:Be,handleAddPlatform:Ue,handleUpdatePlatform:Le,colors:X,get tourDriver(){return J},set tourDriver(u){J=u},step1:he,init:te,handleGetModels:z,filteredPlatforms:je,handleModelAdd:Ee,handleModelUpdate:xe,ref:y,onMounted:le,computed:q,watch:ke,nextTick:oe,get useI18n(){return V},get service(){return U},get SettingOutlined(){return Te},get SearchOutlined(){return Xe},get DownOutlined(){return Ie},get RightOutlined(){return De},get SnippetsOutlined(){return se},get ToolOutlined(){return me},get GlobalOutlined(){return ce},get BranchesOutlined(){return K},get CameraOutlined(){return $},get message(){return w},AddPlatform:ct,SettingPlatform:gt,ModelsList:Gt,get emitter(){return B},get driver(){return Oe},get useUserStore(){return Ce}};return Object.defineProperty(ye,"__isScriptSetup",{enumerable:!1,value:!0}),ye}},Ht={class:"model-service"},Jt={class:"model-service-container"},qt={class:"provider-sidebar"},Wt={class:"provider-search",style:{"justify-content":"center","align-items":"center"}},Qt={class:"platform-list"},Yt=["onClick"],Xt={key:0,class:"platform-logo"},Zt=["src"],Kt={class:"platform-name"},$t={key:2,class:"status-text"},eo={class:"provider-sidebar-mobile"},to={style:{display:"flex","flex-direction":"row","justify-content":"space-between","align-items":"center","margin-bottom":"8px"}},oo={style:{color:"#213547","font-size":"18px","font-weight":"700"}},lo={class:"platform-item"},ao={key:0,class:"platform-logo"},no=["src"],ro={class:"platform-name"},so={key:2,class:"status-text"},io={class:"provider-info"},co={class:"info-header"},mo={class:"info-model-header"},uo={key:0,class:"platform-icon"},po={key:1,class:"platform-status"},fo={class:"info-content"},vo={key:0,class:"info-platform"},_o={class:"api-msg-container"},go={key:0},ho={key:1},yo={class:"api-key"},So=["href"],bo={class:"api-address-title"},ko={class:"show-api-tips"},Oo={key:0,class:"api-address"},Co={key:1,class:"api-address"},Po={key:2,class:"api-address"},wo={class:"api-address"},Mo={class:"info-model"};function Ao(o,t,l,e,i,k){var M,N,F,C,A;const d=ne,a=fe,m=pe,f=We,g=_e,O=Qe,v=re;return c(),h(W,null,[r("div",Ht,[r("h2",null,_(o.$t("setting.modelService.title")),1),r("div",Jt,[r("div",qt,[r("div",Wt,[s(d,{value:e.searchQuery,"onUpdate:value":t[0]||(t[0]=n=>e.searchQuery=n),placeholder:o.$t("setting.modelService.searchPlaceholder"),"prefix-icon":"",style:{"font-size":"14px",height:"36px","margin-bottom":"16px"}},{prefix:p(()=>[s(e.SearchOutlined)]),_:1},8,["value","placeholder"])]),r("div",Qt,[(c(!0),h(W,null,Y(e.filteredPlatforms,n=>(c(),h("div",{key:n.id,class:ie(["platform-item",{"platform-item-active":e.choose_platform.id===n.id}]),onClick:x=>e.handlePlatform(n)},[n.logo_url?(c(),h("div",Xt,[r("img",{src:n.logo_url,alt:"logo",class:"logo"},null,8,Zt)])):(c(),h("div",{key:1,class:"platform-letter platform-logo",style:Z({backgroundColor:n.color})},_(n.name.charAt(0)),5)),r("span",Kt,_(e.getPlatformDisplayName(n.name)),1),n.is_enabled?(c(),h("span",$t,_(o.$t("setting.modelService.statusOn")),1)):P("v-if",!0)],10,Yt))),128))]),r("div",{class:"provider-post platform-item",onClick:t[1]||(t[1]=n=>e.handlePlatformAdd())}," + "+_(o.$t("setting.modelService.addPlatform")),1)]),r("div",eo,[r("div",to,[r("div",oo,_(o.$t("setting.modelService.modelPlatform")),1),r("div",{class:"provider-post",onClick:t[2]||(t[2]=n=>e.handlePlatformAdd())}," + "+_(o.$t("setting.modelService.addPlatform")),1)]),s(m,{style:{width:"100%"},value:e.choose_platform.id,"onUpdate:value":t[3]||(t[3]=n=>e.choose_platform.id=n)},{default:p(()=>[(c(!0),h(W,null,Y(e.filteredPlatforms,n=>(c(),R(a,{key:n.id,value:n.id,onClick:x=>e.handlePlatform(n)},{default:p(()=>[r("div",lo,[n.logo_url?(c(),h("div",ao,[r("img",{src:n.logo_url,alt:"logo",class:"logo"},null,8,no)])):(c(),h("div",{key:1,class:"platform-letter platform-logo",style:Z({backgroundColor:n.color})},_(n.name.charAt(0)),5)),r("span",ro,_(n.name),1),n.is_enabled?(c(),h("span",so,_(o.$t("setting.modelService.statusOn")),1)):P("v-if",!0)])]),_:2},1032,["value","onClick"]))),128))]),_:1},8,["value"])]),r("div",io,[r("div",co,[r("span",mo,_(e.getPlatformDisplayName(e.choose_platform.name)),1),e.choose_platform.source_type==="user"?(c(),h("span",uo,[s(e.SettingOutlined,{class:"platform-setting",onClick:de(e.handlePlatformSetting,["stop"])})])):P("v-if",!0),e.choose_platform.is_subscribe?P("v-if",!0):(c(),h("span",po,[s(f,{checked:e.choose_platform.is_enabled,"onUpdate:checked":t[4]||(t[4]=n=>e.choose_platform.is_enabled=n),class:"custom-switch",onChange:e.handleSaveChanges},null,8,["checked"])])),P(` <a-button :disabled="!isInfoChanged" type="primary" class="save-button" @click="handleSaveChanges">{{
            $t('setting.modelService.save') }}</a-button> `)]),r("div",fo,[e.choose_platform.is_subscribe?P("v-if",!0):(c(),h("div",vo,[P("      provider info DIY      "),r("div",_o,[P('              <div v-if="choose_platform.name===`Cloudsway`">'),P(`                <span class="api-key">{{ $t('setting.modelService.ak') }}</span>`),P('                <a-input-password v-if="choose_platform.name===`Cloudsway`" id="api-key-value"'),P('                                  v-model:value="choose_platform.api_key"'),P(`                                  :placeholder="$t('setting.modelService.akPlaceholder')" class="api-input" @blur="handleSaveChanges"/>`),P("              </div>"),e.choose_platform.name.toLocaleString()==="Ollama"?(c(),h("div",go,[P("       ollama do not have apikey           ")])):(c(),h("div",ho,[r("span",yo,_(e.handleApiTitle),1),s(O,{id:"api-key-value",value:e.choose_platform.api_key,"onUpdate:value":t[5]||(t[5]=n=>e.choose_platform.api_key=n),placeholder:e.handleApiPlaceholder,onChange:e.handleSaveChanges},{addonAfter:p(()=>[s(g,{class:"no-button",onClick:e.handleCheckApiKey,loading:e.checkLoading},{default:p(()=>[E(_(o.$t("setting.modelService.check")),1)]),_:1},8,["loading"])]),_:1},8,["value","placeholder"])]))]),e.choose_platform.key_obtain_url?(c(),h("a",{key:0,href:e.choose_platform.key_obtain_url,target:"_blank",class:"get-api-link"},_(o.$t("setting.modelService.getApiKey")),9,So)):P("v-if",!0),r("span",bo,_(o.$t("setting.modelService.apiAddress")),1),s(d,{value:e.choose_platform.api_url,"onUpdate:value":t[6]||(t[6]=n=>e.choose_platform.api_url=n),placeholder:o.$t("setting.modelService.apiAddressPlaceholder"),class:"api-input",onChange:e.handleSaveChanges},Ye({_:2},[e.handleShowCheckButton?{name:"addonAfter",fn:p(()=>[s(g,{class:"no-button",onClick:e.handleCheckApiKey,loading:e.checkLoading},{default:p(()=>[E(_(o.$t("setting.modelService.check")),1)]),_:1},8,["loading"])]),key:"0"}:void 0]),1032,["value","placeholder"]),r("div",ko,[r("div",null,[(N=(M=e.choose_platform)==null?void 0:M.api_url)!=null&&N.endsWith("#")?(c(),h("span",Oo,_(e.choose_platform.api_url.substring(0,e.choose_platform.api_url.length-1)),1)):(C=(F=e.choose_platform)==null?void 0:F.api_url)!=null&&C.endsWith("/")?(c(),h("span",Co,_(e.choose_platform.api_url)+"chat/completions ",1)):(c(),h("span",Po,_((A=e.choose_platform)==null?void 0:A.api_url)+"/chat/completions ",1))]),r("div",wo,_(o.$t("setting.modelService.apiAddressTip")),1)])])),r("div",Mo,[r("div",null,[s(e.ModelsList,{models:e.models,platform_id:e.choose_platform.id,is_subscribe:e.choose_platform.is_subscribe,onSetting:t[7]||(t[7]=()=>{}),onDelete:e.handleModelDelete,onAddModel:e.handleModelAdd,onUpdateModel:e.handleModelUpdate},null,8,["models","platform_id","is_subscribe"])])])])])]),s(e.AddPlatform,{ref:"addPlatformRef",onAddPlatform:e.handleAddPlatform},null,512),s(e.SettingPlatform,{ref:"settingPlatformRef",onUpdatePlatform:e.handleUpdatePlatform},null,512)]),P(" 选择模型弹窗 "),s(v,{cancelText:o.$t("setting.modelService.cancel"),okText:o.$t("setting.modelService.confirm"),open:e.modelVisible,"onUpdate:open":t[9]||(t[9]=n=>e.modelVisible=n),centered:"",title:o.$t("setting.modelService.selectCheckModel"),width:"400px",onOk:e.handleOk},{default:p(()=>[s(m,{value:e.selectedModel,"onUpdate:value":t[8]||(t[8]=n=>e.selectedModel=n),style:{width:"100%"}},{default:p(()=>[(c(!0),h(W,null,Y(e.models,n=>(c(),R(a,{key:n.id,value:n.model_id},{default:p(()=>[E(_(n.model_name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1},8,["cancelText","okText","open","title"])],64)}const Eo=ee(zt,[["render",Ao],["__scopeId","data-v-41e46add"],["__file","/Users/samihalawa/git/PROJECTS_CODING/lemonai/frontend/src/view/setting/model.vue"]]);export{Eo as default};
