import{l as x}from"./lemon-D5W0kMi6.js";import{e as s,I as ee,d as M,h as v,l as o,q as H,u as B,O as W,r as F,c as O,i as R,j as T,w as u,k as h,t as d,x as z,B as G,Q as N,U as j,V as Q,P as D,aI as X,f,X as oe,o as te,g as se}from"./index-BlGINy0I.js";import{s as V}from"./auth-BilQ5inf.js";import{u as ae}from"./user-CVczdK57.js";import"./http-BD0bo4QE.js";var le={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M744 62H280c-35.3 0-64 28.7-64 64v768c0 35.3 28.7 64 64 64h464c35.3 0 64-28.7 64-64V126c0-35.3-28.7-64-64-64zm-8 824H288V134h448v752zM472 784a40 40 0 1080 0 40 40 0 10-80 0z"}}]},name:"mobile",theme:"outlined"};function Y(P){for(var $=1;$<arguments.length;$++){var g=arguments[$]!=null?Object(arguments[$]):{},_=Object.keys(g);typeof Object.getOwnPropertySymbols=="function"&&(_=_.concat(Object.getOwnPropertySymbols(g).filter(function(t){return Object.getOwnPropertyDescriptor(g,t).enumerable}))),_.forEach(function(t){ne(P,t,g[t])})}return P}function ne(P,$,g){return $ in P?Object.defineProperty(P,$,{value:g,enumerable:!0,configurable:!0,writable:!0}):P[$]=g,P}var J=function($,g){var _=Y({},$,g.attrs);return s(ee,Y({},_,{icon:le}),null)};J.displayName="MobileOutlined";J.inheritAttrs=!1;const re={xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",fill:"none",viewBox:"0 0 24 24"};function ue(P,$){return v(),M("svg",re,$[0]||($[0]=[o("path",{fill:"#4285F4",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09"},null,-1),o("path",{fill:"#34A853",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23"},null,-1),o("path",{fill:"#FBBC05",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22z"},null,-1),o("path",{fill:"#EA4335",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53"},null,-1)]))}const K={render:ue},ie={class:"social-buttons"},de={class:"divider"},pe={class:"form-label"},me={class:"form-label"},ce={class:"password-label-container"},he={class:"form-label"},fe={class:"auth-footer"},ge={__name:"login",emits:["toRegister","toForgot","handleLogin","handleGoogleLogin"],setup(P,{emit:$}){const{t:g}=B(),_=$,t=W({email:"",phone:"",password:"",remember:!1}),e=F(!0),m=O(()=>{const p=!!t.password;return e.value?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t.email||"")&&p:/^1[3-9]\d{9}$/.test(t.phone||"")&&p}),S=p=>{_("handleLogin",p)},I=()=>{_("handleSMSLogin")},k=()=>{_("handleGoogleLogin")},U=()=>{_("toRegister")},w=()=>{_("toForgot")};return(p,n)=>{const c=G,q=j,r=N,i=Q,y=D;return v(),M("div",null,[o("div",ie,[e.value?(v(),R(c,{key:0,class:"social-button google",onClick:k},{icon:u(()=>[s(z(K))]),default:u(()=>[h(" "+d(p.$t("auth.loginWithGoogle")),1)]),_:1})):T("",!0),e.value?T("",!0):(v(),R(c,{key:1,class:"social-button phone",onClick:I},{icon:u(()=>[s(z(J))]),default:u(()=>[h(" "+d(p.$t("auth.loginWithPhone")),1)]),_:1}))]),o("div",de,[o("span",null,d(p.$t("auth.or")),1)]),s(y,{model:t,name:"login-form",onFinish:S,autocomplete:"off",layout:"vertical"},{default:u(()=>[e.value?(v(),R(r,{key:0,name:"email",rules:[{required:!0,message:p.$t("auth.pleaseInputEmail")},{type:"email",message:p.$t("auth.pleaseInputValidEmail")}]},{default:u(()=>[o("div",pe,[h(d(p.$t("auth.email")),1),n[3]||(n[3]=o("span",{class:"required-mark"},"*",-1))]),s(q,{value:t.email,"onUpdate:value":n[0]||(n[0]=C=>t.email=C),placeholder:p.$t("auth.pleaseInputEmail")},null,8,["value","placeholder"])]),_:1},8,["rules"])):(v(),R(r,{key:1,name:"phone",rules:[{required:!0,message:p.$t("auth.pleaseInputPhone")},{pattern:/^1[3-9]\d{9}$/,message:p.$t("auth.pleaseInputValidPhone")}]},{default:u(()=>[o("div",me,[h(d(p.$t("auth.phone")),1),n[4]||(n[4]=o("span",{class:"required-mark"},"*",-1))]),s(q,{value:t.phone,"onUpdate:value":n[1]||(n[1]=C=>t.phone=C),placeholder:p.$t("auth.pleaseInputPhone")},null,8,["value","placeholder"])]),_:1},8,["rules"])),s(r,{name:"password",rules:[{required:!0,message:p.$t("auth.pleaseInputPassword")}]},{default:u(()=>[o("div",ce,[o("div",he,[h(d(p.$t("auth.password")),1),n[5]||(n[5]=o("span",{class:"required-mark"},"*",-1))]),o("a",{class:"forgot-link",onClick:w},d(p.$t("auth.forgotPassword")),1)]),s(i,{value:t.password,"onUpdate:value":n[2]||(n[2]=C=>t.password=C),placeholder:p.$t("auth.pleaseInputPassword")},null,8,["value","placeholder"])]),_:1},8,["rules"]),s(r,null,{default:u(()=>[s(c,{type:"primary","html-type":"submit",block:"",loading:p.loading,disabled:!m.value},{default:u(()=>[h(d(p.$t("auth.login")),1)]),_:1},8,["loading","disabled"])]),_:1}),o("div",fe,[o("span",null,d(p.$t("auth.noAccount")),1),o("a",{onClick:U},d(p.$t("auth.register")),1)])]),_:1},8,["model"])])}}},ve=H(ge,[["__scopeId","data-v-6462da53"]]),$e={class:"social-buttons"},_e={key:0,class:"divider"},we={class:"form-label"},ye={class:"form-label"},Ce={class:"form-label"},be={class:"form-label"},Ie={class:"form-label"},Se={class:"auth-footer"},ke={__name:"register",emits:["toLogin","handleRegister","handleGoogleRegister"],setup(P,{emit:$}){const g=F(!0),{t:_}=B(),t=$,e=F({fullname:"",email:"",phone:"",password:"",smsCode:""}),m=F(0);let S=null;const I=O(()=>e.value.fullname&&(g.value?e.value.email:e.value.phone)&&e.value.password&&(g.value?!0:e.value.smsCode)),k=async()=>{t("handleGoogleRegister")},U=()=>{t("toLogin")},w=async n=>{t("handleRegister",n)};function p(){if(!/^1[3-9]\d{9}$/.test(e.value.phone)){f.error(_("auth.pleaseInputValidPhone"));return}V.sendSmsCode(e.value.phone),m.value=60,S=setInterval(()=>{m.value--,m.value<=0&&(clearInterval(S),S=null)},1e3)}return(n,c)=>{const q=G,r=j,i=N,y=Q,C=X,l=D;return v(),M("div",null,[o("div",$e,[g.value?(v(),R(q,{key:0,class:"social-button google",onClick:k},{icon:u(()=>[s(z(K))]),default:u(()=>[h(" "+d(n.$t("auth.registerWithGoogle")),1)]),_:1})):T("",!0)]),g.value?(v(),M("div",_e,[o("span",null,d(n.$t("auth.or")),1)])):T("",!0),s(l,{model:e.value,name:"register-form",onFinish:w,autocomplete:"off",layout:"vertical"},{default:u(()=>[s(i,{name:"fullname",rules:[{required:!0,message:n.$t("auth.pleaseInputFullname")}]},{default:u(()=>[o("div",we,[h(d(n.$t("auth.fullname")),1),c[5]||(c[5]=o("span",{class:"required-mark"},"*",-1))]),s(r,{value:e.value.fullname,"onUpdate:value":c[0]||(c[0]=a=>e.value.fullname=a),placeholder:n.$t("auth.pleaseInputFullname")},null,8,["value","placeholder"])]),_:1},8,["rules"]),g.value?(v(),R(i,{key:0,name:"email",rules:[{required:!0,message:n.$t("auth.pleaseInputEmail")},{type:"email",message:n.$t("auth.pleaseInputValidEmail")}]},{default:u(()=>[o("div",ye,[h(d(n.$t("auth.email")),1),c[6]||(c[6]=o("span",{class:"required-mark"},"*",-1))]),s(r,{value:e.value.email,"onUpdate:value":c[1]||(c[1]=a=>e.value.email=a),placeholder:n.$t("auth.pleaseInputEmail")},null,8,["value","placeholder"])]),_:1},8,["rules"])):(v(),R(i,{key:1,name:"phone",rules:[{required:!0,message:n.$t("auth.pleaseInputPhone")},{pattern:/^1[3-9]\d{9}$/,message:n.$t("auth.pleaseInputValidPhone")}]},{default:u(()=>[o("div",Ce,[h(d(n.$t("auth.phone")),1),c[7]||(c[7]=o("span",{class:"required-mark"},"*",-1))]),s(r,{value:e.value.phone,"onUpdate:value":c[2]||(c[2]=a=>e.value.phone=a),placeholder:n.$t("auth.pleaseInputPhone")},null,8,["value","placeholder"])]),_:1},8,["rules"])),s(i,{name:"password",rules:[{required:!0,message:n.$t("auth.pleaseInputPassword")}]},{default:u(()=>[o("div",be,[h(d(n.$t("auth.password")),1),c[8]||(c[8]=o("span",{class:"required-mark"},"*",-1))]),s(y,{value:e.value.password,"onUpdate:value":c[3]||(c[3]=a=>e.value.password=a),placeholder:n.$t("auth.pleaseInputPassword")},null,8,["value","placeholder"])]),_:1},8,["rules"]),g.value?T("",!0):(v(),R(i,{key:2,name:"smsCode",rules:[{required:!0,message:n.$t("auth.pleaseInputSMSCode")}]},{default:u(()=>[o("div",Ie,[h(d(n.$t("auth.smsCode")),1),c[9]||(c[9]=o("span",{class:"required-mark"},"*",-1))]),s(C,{compact:""},{default:u(()=>[s(r,{value:e.value.smsCode,"onUpdate:value":c[4]||(c[4]=a=>e.value.smsCode=a),style:{width:"65%"},placeholder:n.$t("auth.pleaseInputSMSCode")},null,8,["value","placeholder"]),s(q,{style:{width:"30%","margin-left":"5%",color:"#fff"},disabled:m.value>0,onClick:p},{default:u(()=>[h(d(m.value>0?`${m.value}s`:n.$t("auth.sendCode")),1)]),_:1},8,["disabled"])]),_:1})]),_:1},8,["rules"])),s(i,null,{default:u(()=>[s(q,{type:"primary","html-type":"submit",block:"",loading:n.loading,disabled:!I.value},{default:u(()=>[h(d(n.$t("auth.register")),1)]),_:1},8,["loading","disabled"])]),_:1}),o("div",Se,[o("span",null,d(n.$t("auth.haveAccount")),1),o("a",{onClick:U},d(n.$t("auth.login")),1)])]),_:1},8,["model"])])}}},Pe=H(ke,[["__scopeId","data-v-3789ecc6"]]),Ve={class:"form-label"},Le={class:"form-label"},qe={class:"form-label"},Ee={class:"form-label"},Fe={class:"form-label"},Re={class:"form-label"},Me={class:"auth-footer"},Te={__name:"forgot",emits:["toLogin","handleForgotPassword"],setup(P,{emit:$}){const{t:g}=B(),_=$,t=F(!0),e=W({email:"",code:"",password:"",phone:"",smsCode:"",confirmPassword:""}),m=F(0);let S=null;const I=F(0);let k=null;const U=O(()=>{const r=e.password&&e.confirmPassword&&e.password===e.confirmPassword;if(t.value){const i=/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.email),y=!!e.code;return i&&y&&r}else{const i=/^1[3-9]\d{9}$/.test(e.phone),y=!!e.smsCode;return i&&y&&r}}),w=r=>{_("handleForgotPassword",r)};function p(){if(!/^1[3-9]\d{9}$/.test(e.phone)){f.error(g("auth.pleaseInputValidPhone"));return}V.sendSmsCode(e.phone),m.value=60,S=setInterval(()=>{m.value--,m.value<=0&&(clearInterval(S),S=null)},1e3)}function n(){if(!/^[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/.test(e.email)){f.error(g("auth.pleaseEnterValidEmail"));return}V.sendEmailVerification(e.email),I.value=60,k=setInterval(()=>{I.value--,I.value<=0&&(clearInterval(k),k=null)},1e3),f.success(g("auth.codeSent"))}function c(r,i){return i!==e.password?Promise.reject(new Error(g("auth.passwordsDoNotMatch"))):Promise.resolve()}const q=()=>{_("toLogin")};return(r,i)=>{const y=j,C=N,l=G,a=X,E=Q,L=D;return v(),M("div",null,[s(L,{model:e,name:"forgot-form",onFinish:w,autocomplete:"off",layout:"vertical"},{default:u(()=>[t.value?(v(),R(C,{key:0,name:"email",rules:[{required:!0,message:r.$t("auth.pleaseInputEmail")},{type:"email",message:r.$t("auth.pleaseInputValidEmail")}]},{default:u(()=>[o("div",Ve,[h(d(r.$t("auth.email")),1),i[6]||(i[6]=o("span",{class:"required-mark"},"*",-1))]),s(y,{value:e.email,"onUpdate:value":i[0]||(i[0]=b=>e.email=b),placeholder:r.$t("auth.pleaseInputEmail")},null,8,["value","placeholder"])]),_:1},8,["rules"])):(v(),R(C,{key:1,name:"phone",rules:[{required:!0,message:r.$t("auth.pleaseInputPhone")},{pattern:/^1[3-9]\d{9}$/,message:r.$t("auth.pleaseInputValidPhone")}]},{default:u(()=>[o("div",Le,[h(d(r.$t("auth.phone")),1),i[7]||(i[7]=o("span",{class:"required-mark"},"*",-1))]),s(y,{value:e.phone,"onUpdate:value":i[1]||(i[1]=b=>e.phone=b),placeholder:r.$t("auth.pleaseInputPhone")},null,8,["value","placeholder"])]),_:1},8,["rules"])),t.value?T("",!0):(v(),R(C,{key:2,name:"smsCode",rules:[{required:!0,message:r.$t("auth.pleaseInputSMSCode")}]},{default:u(()=>[o("div",qe,[h(d(r.$t("auth.smsCode")),1),i[8]||(i[8]=o("span",{class:"required-mark"},"*",-1))]),s(a,{compact:""},{default:u(()=>[s(y,{value:e.smsCode,"onUpdate:value":i[2]||(i[2]=b=>e.smsCode=b),style:{width:"65%"},placeholder:r.$t("auth.pleaseInputSMSCode")},null,8,["value","placeholder"]),s(l,{style:{width:"30%","margin-left":"5%",color:"#fff"},disabled:m.value>0,onClick:p},{default:u(()=>[h(d(m.value>0?`${m.value}s`:r.$t("auth.sendCode")),1)]),_:1},8,["disabled"])]),_:1})]),_:1},8,["rules"])),t.value?(v(),R(C,{key:3,name:"code",rules:[{required:!0,message:r.$t("auth.pleaseInputVerifyCode")}]},{default:u(()=>[o("div",Ee,[h(d(r.$t("auth.verifyCode")),1),i[9]||(i[9]=o("span",{class:"required-mark"},"*",-1))]),s(a,{compact:""},{default:u(()=>[s(y,{value:e.code,"onUpdate:value":i[3]||(i[3]=b=>e.code=b),style:{width:"65%"},placeholder:r.$t("auth.pleaseInputVerifyCode")},null,8,["value","placeholder"]),s(l,{style:{width:"30%","margin-left":"5%",color:"#fff"},disabled:I.value>0,onClick:n},{default:u(()=>[h(d(I.value>0?`${I.value}s`:r.$t("auth.sendCode")),1)]),_:1},8,["disabled"])]),_:1})]),_:1},8,["rules"])):T("",!0),s(C,{name:"password",rules:[{required:!0,message:r.$t("auth.pleaseInputNewPassword")}]},{default:u(()=>[o("div",Fe,[h(d(r.$t("auth.password")),1),i[10]||(i[10]=o("span",{class:"required-mark"},"*",-1))]),s(E,{value:e.password,"onUpdate:value":i[4]||(i[4]=b=>e.password=b),placeholder:r.$t("auth.pleaseInputNewPassword")},null,8,["value","placeholder"])]),_:1},8,["rules"]),s(C,{name:"confirmPassword",rules:[{required:!0,message:r.$t("auth.pleaseConfirmPassword")},{validator:c}]},{default:u(()=>[o("div",Re,[h(d(r.$t("auth.pleaseConfirmPassword")),1),i[11]||(i[11]=o("span",{class:"required-mark"},"*",-1))]),s(E,{value:e.confirmPassword,"onUpdate:value":i[5]||(i[5]=b=>e.confirmPassword=b),placeholder:r.$t("auth.pleaseConfirmPassword")},null,8,["value","placeholder"])]),_:1},8,["rules"]),s(C,null,{default:u(()=>[s(l,{type:"primary",disabled:!U.value,"html-type":"submit",block:"",loading:r.loading},{default:u(()=>[h(d(r.$t("auth.resetPasswordButton")),1)]),_:1},8,["disabled","loading"])]),_:1}),o("div",Me,[o("a",{onClick:q},d(r.$t("auth.backToLogin")),1)])]),_:1},8,["model"])])}}},Ue=H(Te,[["__scopeId","data-v-8db64875"]]),Ae={class:"form-label"},Oe={class:"form-label"},He={class:"auth-footer"},Be={__name:"sms-login",emits:["toLogin","handleLoginSMSCode"],setup(P,{emit:$}){const{t:g}=B(),_=$;O(()=>!0);const t=W({email:"",code:"",password:"",phone:"",smsCode:"",confirmPassword:""}),e=F(0);let m=null;const S=O(()=>{const w=/^1[3-9]\d{9}$/.test(t.phone),p=!!t.smsCode;return w&&p}),I=w=>{_("handleLoginSMSCode",w)};function k(){if(!/^1[3-9]\d{9}$/.test(t.phone)){f.error(g("auth.pleaseInputValidPhone"));return}V.sendSmsCode(t.phone),e.value=60,m=setInterval(()=>{e.value--,e.value<=0&&(clearInterval(m),m=null)},1e3)}const U=()=>{_("toLogin")};return(w,p)=>{const n=j,c=N,q=G,r=X,i=D;return v(),M("div",null,[s(i,{model:t,name:"login-form",onFinish:I,autocomplete:"off",layout:"vertical"},{default:u(()=>[s(c,{name:"phone",rules:[{required:!0,message:w.$t("auth.pleaseInputPhone")},{pattern:/^1[3-9]\d{9}$/,message:w.$t("auth.pleaseInputValidPhone")}]},{default:u(()=>[o("div",Ae,[h(d(w.$t("auth.phone")),1),p[2]||(p[2]=o("span",{class:"required-mark"},"*",-1))]),s(n,{value:t.phone,"onUpdate:value":p[0]||(p[0]=y=>t.phone=y),placeholder:w.$t("auth.pleaseInputPhone")},null,8,["value","placeholder"])]),_:1},8,["rules"]),s(c,{name:"smsCode",rules:[{required:!0,message:w.$t("auth.pleaseInputSMSCode")}]},{default:u(()=>[o("div",Oe,[h(d(w.$t("auth.smsCode")),1),p[3]||(p[3]=o("span",{class:"required-mark"},"*",-1))]),s(r,{compact:""},{default:u(()=>[s(n,{value:t.smsCode,"onUpdate:value":p[1]||(p[1]=y=>t.smsCode=y),style:{width:"65%"},placeholder:w.$t("auth.pleaseInputSMSCode")},null,8,["value","placeholder"]),s(q,{style:{width:"30%","margin-left":"5%",color:"#fff"},disabled:e.value>0,onClick:k},{default:u(()=>[h(d(e.value>0?`${e.value}s`:w.$t("auth.sendCode")),1)]),_:1},8,["disabled"])]),_:1})]),_:1},8,["rules"]),s(c,null,{default:u(()=>[s(q,{type:"primary",disabled:!S.value,"html-type":"submit",block:"",loading:w.loading},{default:u(()=>[h(d(w.$t("auth.login")),1)]),_:1},8,["disabled","loading"])]),_:1}),o("div",He,[o("a",{onClick:U},d(w.$t("auth.otherLogin")),1)])]),_:1},8,["model"])])}}},Ge=H(Be,[["__scopeId","data-v-204dcddb"]]),Ne={class:"auth-container"},je={class:"auth-content"},De={class:"logo-container"},ze={class:"logo"},We=["src"],Ze={class:"auth-title"},Qe={key:0},Xe={key:1},Je={key:2},Ye={key:3},Ke={key:4},xe={class:"verify-container"},eo={class:"verify-text"},oo={class:"verify-footer"},to={class:"auth-footer"},so={__name:"Login",setup(P){const $=ae(),{user:g}=oe($),_=se(),{t}=B(),e=F("login"),m=F(!1);te(()=>{console.log("isClient === ",!1),window.electronAPI&&window.electronAPI.on("oauth-login-success",({code:a,state:E})=>{g.value.id?window.location.href="/":window.location.hash=`/auth/google?code=${a}&state=${E}`})});const S=F(!0),I=F(""),k=W({code:""}),U=O(()=>{switch(e.value){case"login":return t("auth.loginToLemonAI");case"register":return t("auth.registerLemonAIAccount");case"verify":return t("auth.verifyEmail");case"smsLogin":return t("auth.loginToLemonAI");default:return t("auth.resetPassword")}}),w=async()=>{try{m.value=!0;const l=await V.verifyEmailVerifyCode(I.value,k.code);if(l.code===200){const a=await V.register(r.value.fullname,r.value.email,r.value.password,"");a.code===200?(f.success(t("auth.registrationSuccessful")),e.value="login"):f.error(a.message)}else f.error(l.message)}catch{f.error(t("auth.verificationCodeError"))}finally{m.value=!1}},p=async()=>{const l=new Date,a=localStorage.getItem("lastSendTime");if(a){const L=new Date(a);if(l-L<6e4){f.error(t("auth.doNotSendFrequently"));return}}localStorage.setItem("lastSendTime",l.toString()),m.value=!0;const E=await V.sendEmailVerification(I.value);E.code===200?(k.code="",f.info(t("auth.codeResent")),m.value=!1):(f.error(E.message),m.value=!1)},n=()=>{_.push("/")},c=async l=>{try{m.value=!0;const a=await V.login(l.email,l.password,l.phone);console.log("res",a),a.code===200?(f.success(t("auth.loginSuccessful")),_.push({name:"lemon"})):f.error(a.message)}catch(a){console.log("error",a),f.error(t("auth.loginFailed"))}finally{m.value=!1}},q=async l=>{const a=await V.loginSMSCode(l.phone,l.smsCode);if(a.code===200)f.success(t("auth.loginSuccessful")),_.push({name:"lemon"});else{f.error(a.message);return}},r=F({}),i=async l=>{console.log("handleRegister",l),r.value=l;try{if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(l.email)&&S.value)throw new Error(t("auth.pleaseEnterValidEmail"));if(!/^1[3-9]\d{9}$/.test(l.phone)&&!S.value)throw new Error(t("auth.pleaseInputValidPhone"));if(l.password.length<6)throw new Error(t("auth.passwordTooShort"));if(S.value){I.value=l.email;const L=await V.sendEmailVerification(l.email);L.code===200?(f.success(t("auth.codeSent")),e.value="verify"):f.error(L.message)}else{let L=await V.verifySmsVerifyCode(l.phone,l.smsCode);if(L.code===200){let b=await V.register(l.fullname,"",l.password,l.phone);b.code===200?(f.success(t("auth.registrationSuccessful")),e.value="login"):f.error(b.message)}else f.error(t("auth.verificationCodeError"));console.log("smsRes",L)}localStorage.setItem("lastSendTime",new Date().toString())}catch(a){f.error(a.message||t("auth.registrationFailed"))}finally{}},y=async l=>{try{m.value=!0;let a=null;if(S.value?a=await V.verifyEmailVerifyCode(l.email,l.code):a=await V.verifySmsVerifyCode(l.phone,l.smsCode),a.code===200)(await V.resetPassword(l.email,l.password,l.phone)).code===200?(f.success(t("auth.passwordResetSuccessful")),e.value="login"):f.error(t("auth.passwordResetFailed"));else{f.error(t("auth.codeError"));return}}catch{f.error(t("auth.passwordResetFailed"))}finally{m.value=!1}},C=()=>{try{m.value=!0;const a=!1?"/api/users/auth/google":"http://localhost:5005/api/users/auth/google",E="973572698649-hbp15ju1nhlsja1k2gbqktmrulk0hopp.apps.googleusercontent.com",L=encodeURIComponent("profile email"),Z=`https://accounts.google.com/o/oauth2/auth?client_id=${E}&redirect_uri=${a}&scope=${L}&response_type=code&access_type=offline&prompt=consent`;window.location.href=Z}catch{f.error(t("auth.googleLoginFailed"))}finally{m.value=!1}};return(l,a)=>{const E=j,L=N,b=G,Z=D;return v(),M("div",Ne,[o("div",je,[o("div",De,[o("div",ze,[o("img",{src:z(x),alt:"logo"},null,8,We)])]),o("h2",Ze,d(U.value),1),e.value==="login"?(v(),M("div",Qe,[s(ve,{onToRegister:a[0]||(a[0]=A=>e.value="register"),onHandleLogin:c,onToForgot:a[1]||(a[1]=A=>e.value="forgot"),onHandleGoogleLogin:C,onHandleSMSLogin:a[2]||(a[2]=A=>e.value="smsLogin")})])):T("",!0),e.value==="smsLogin"?(v(),M("div",Xe,[s(Ge,{onToLogin:a[3]||(a[3]=A=>e.value="login"),onHandleLoginSMSCode:q})])):T("",!0),e.value==="register"?(v(),M("div",Je,[s(Pe,{onToLogin:a[4]||(a[4]=A=>e.value="login"),onHandleRegister:i,onHandleGoogleRegister:C})])):T("",!0),e.value==="forgot"?(v(),M("div",Ye,[s(Ue,{onToLogin:a[5]||(a[5]=A=>e.value="login"),onHandleForgotPassword:y})])):T("",!0),e.value==="verify"?(v(),M("div",Ke,[o("div",xe,[o("p",eo,d(l.$t("auth.codeSentTo"))+" "+d(I.value),1),s(Z,{model:k,name:"verify-form",onFinish:w,autocomplete:"off",layout:"vertical"},{default:u(()=>[s(L,{name:"code",rules:[{required:!0,message:l.$t("auth.pleaseInput6DigitCode")}]},{default:u(()=>[s(E,{value:k.code,"onUpdate:value":a[6]||(a[6]=A=>k.code=A),placeholder:l.$t("auth.pleaseInput6DigitCode")},null,8,["value","placeholder"])]),_:1},8,["rules"]),s(L,null,{default:u(()=>[s(b,{type:"primary","html-type":"submit",block:"",loading:m.value,disabled:!k.code},{default:u(()=>[h(d(l.$t("auth.verifyEmailButton")),1)]),_:1},8,["loading","disabled"])]),_:1}),o("div",oo,[o("p",null,[h(d(l.$t("auth.notReceivedCode"))+" ",1),o("a",{onClick:p},d(l.$t("auth.resendCode")),1)])])]),_:1},8,["model"])])])):T("",!0),o("div",to,[o("span",{class:"auth-footer-keep-offline",onClick:n},d(l.$t("auth.keepOffline")),1)])])])}}},ao=H(so,[["__scopeId","data-v-c49cb435"]]),po={__name:"index",setup(P){return($,g)=>(v(),R(ao))}};export{po as default};
