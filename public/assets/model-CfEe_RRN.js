import{e as c,I as K,q as ee,u as te,r as $,i as R,h as d,w as m,l as r,d as b,aJ as Y,Q as de,U as ae,a4 as ue,a5 as me,k as j,P as pe,W as ne,f as I,t as f,x as U,aD as Ge,B as ve,j as E,aK as qe,aL as We,c as X,o as De,F as J,Z as Q,aM as Je,aN as Qe,ag as ie,av as we,a3 as Ze,aO as Xe,v as Ye,aP as ce,aH as Ke,a1 as et,aa as re,ay as tt,V as lt,aQ as ot,aR as at}from"./index-DaULH4WC.js";import{h as H}from"./http-yCFEzgv3.js";import"./marked.esm-BktMfnUh.js";import{e as V}from"./emitter-E5P-NQ8u.js";import{G as nt}from"./GlobalOutlined-BcHeUB8G.js";import{S as Fe}from"./SettingOutlined-DNyqZU2g.js";import{A as st}from"./driver-BxHdV7Lz.js";import{u as rt}from"./user-Bo0KfdR7.js";var it={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M740 161c-61.8 0-112 50.2-112 112 0 50.1 33.1 92.6 78.5 106.9v95.9L320 602.4V318.1c44.2-15 76-56.9 76-106.1 0-61.8-50.2-112-112-112s-112 50.2-112 112c0 49.2 31.8 91 76 106.1V706c-44.2 15-76 56.9-76 106.1 0 61.8 50.2 112 112 112s112-50.2 112-112c0-49.2-31.8-91-76-106.1v-27.8l423.5-138.7a50.52 50.52 0 0034.9-48.2V378.2c42.9-15.8 73.6-57 73.6-105.2 0-61.8-50.2-112-112-112zm-504 51a48.01 48.01 0 0196 0 48.01 48.01 0 01-96 0zm96 600a48.01 48.01 0 01-96 0 48.01 48.01 0 0196 0zm408-491a48.01 48.01 0 010-96 48.01 48.01 0 010 96z"}}]},name:"branches",theme:"outlined"};function Me(o){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?Object(arguments[e]):{},n=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(n=n.concat(Object.getOwnPropertySymbols(t).filter(function(g){return Object.getOwnPropertyDescriptor(t,g).enumerable}))),n.forEach(function(g){ct(o,g,t[g])})}return o}function ct(o,e,t){return e in o?Object.defineProperty(o,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):o[e]=t,o}var fe=function(e,t){var n=Me({},e,t.attrs);return c(K,Me({},n,{icon:it}),null)};fe.displayName="BranchesOutlined";fe.inheritAttrs=!1;var dt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M864 248H728l-32.4-90.8a32.07 32.07 0 00-30.2-21.2H358.6c-13.5 0-25.6 8.5-30.1 21.2L296 248H160c-44.2 0-80 35.8-80 80v456c0 44.2 35.8 80 80 80h704c44.2 0 80-35.8 80-80V328c0-44.2-35.8-80-80-80zm8 536c0 4.4-3.6 8-8 8H160c-4.4 0-8-3.6-8-8V328c0-4.4 3.6-8 8-8h186.7l17.1-47.8 22.9-64.2h250.5l22.9 64.2 17.1 47.8H864c4.4 0 8 3.6 8 8v456zM512 384c-88.4 0-160 71.6-160 160s71.6 160 160 160 160-71.6 160-160-71.6-160-160-160zm0 256c-53 0-96-43-96-96s43-96 96-96 96 43 96 96-43 96-96 96z"}}]},name:"camera",theme:"outlined"};function Ae(o){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?Object(arguments[e]):{},n=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(n=n.concat(Object.getOwnPropertySymbols(t).filter(function(g){return Object.getOwnPropertyDescriptor(t,g).enumerable}))),n.forEach(function(g){ut(o,g,t[g])})}return o}function ut(o,e,t){return e in o?Object.defineProperty(o,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):o[e]=t,o}var _e=function(e,t){var n=Ae({},e,t.attrs);return c(K,Ae({},n,{icon:dt}),null)};_e.displayName="CameraOutlined";_e.inheritAttrs=!1;var mt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M872 474H152c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h720c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8z"}}]},name:"minus",theme:"outlined"};function Te(o){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?Object(arguments[e]):{},n=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(n=n.concat(Object.getOwnPropertySymbols(t).filter(function(g){return Object.getOwnPropertyDescriptor(t,g).enumerable}))),n.forEach(function(g){pt(o,g,t[g])})}return o}function pt(o,e,t){return e in o?Object.defineProperty(o,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):o[e]=t,o}var ge=function(e,t){var n=Te({},e,t.attrs);return c(K,Te({},n,{icon:mt}),null)};ge.displayName="MinusOutlined";ge.inheritAttrs=!1;var vt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 112H724V72c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v40H500V72c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v40H320c-17.7 0-32 14.3-32 32v120h-96c-17.7 0-32 14.3-32 32v632c0 17.7 14.3 32 32 32h512c17.7 0 32-14.3 32-32v-96h96c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32zM664 888H232V336h218v174c0 22.1 17.9 40 40 40h174v338zm0-402H514V336h.2L664 485.8v.2zm128 274h-56V456L544 264H360v-80h68v32c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-32h152v32c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-32h68v576z"}}]},name:"snippets",theme:"outlined"};function Ie(o){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?Object(arguments[e]):{},n=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(n=n.concat(Object.getOwnPropertySymbols(t).filter(function(g){return Object.getOwnPropertyDescriptor(t,g).enumerable}))),n.forEach(function(g){ft(o,g,t[g])})}return o}function ft(o,e,t){return e in o?Object.defineProperty(o,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):o[e]=t,o}var ye=function(e,t){var n=Ie({},e,t.attrs);return c(K,Ie({},n,{icon:vt}),null)};ye.displayName="SnippetsOutlined";ye.inheritAttrs=!1;var _t={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M876.6 239.5c-.5-.9-1.2-1.8-2-2.5-5-5-13.1-5-18.1 0L684.2 409.3l-67.9-67.9L788.7 169c.8-.8 1.4-1.6 2-2.5 3.6-6.1 1.6-13.9-4.5-17.5-98.2-58-226.8-44.7-311.3 39.7-67 67-89.2 162-66.5 247.4l-293 293c-3 3-2.8 7.9.3 11l169.7 169.7c3.1 3.1 8.1 3.3 11 .3l292.9-292.9c85.5 22.8 180.5.7 247.6-66.4 84.4-84.5 97.7-213.1 39.7-311.3zM786 499.8c-58.1 58.1-145.3 69.3-214.6 33.6l-8.8 8.8-.1-.1-274 274.1-79.2-79.2 230.1-230.1s0 .1.1.1l52.8-52.8c-35.7-69.3-24.5-156.5 33.6-214.6a184.2 184.2 0 01144-53.5L537 318.9a32.05 32.05 0 000 45.3l124.5 124.5a32.05 32.05 0 0045.3 0l132.8-132.8c3.7 51.8-14.4 104.8-53.6 143.9z"}}]},name:"tool",theme:"outlined"};function Ne(o){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?Object(arguments[e]):{},n=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(n=n.concat(Object.getOwnPropertySymbols(t).filter(function(g){return Object.getOwnPropertyDescriptor(t,g).enumerable}))),n.forEach(function(g){gt(o,g,t[g])})}return o}function gt(o,e,t){return e in o?Object.defineProperty(o,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):o[e]=t,o}var he=function(e,t){var n=Ne({},e,t.attrs);return c(K,Ne({},n,{icon:_t}),null)};he.displayName="ToolOutlined";he.inheritAttrs=!1;const z={async getPlatforms(){const e=await H.get("/api/platform");return Array.isArray(e)?e:(e==null?void 0:e.data)||[]},async insertPlatform(o){return await H.post("/api/platform",o)||{}},async updatePlatform(o){const e=`/api/platform/${o.id}`;return(await H.put(e,o)).data||{}},async deletePlatform(o){const e=`/api/platform/${o}`;return(await H.del(e)).data||{}},async getModels(o){const e=`/api/model/list/${o}`;return await H.get(e)||[]},async deleteModel(o){const e=`/api/model/${o}`;return(await H.del(e,{id:o})).data||{}},async insertModel(o){return await H.post("/api/model",o)||{}},async updateModel(o){const e=`/api/model/${o.id}`;return(await H.put(e,o)).data||{}},async checkApiAvailability(o){return await H.post("/api/platform/check_api_availability",o)||{}}},yt={class:"add-platform-form"},ht=["src","alt"],bt="#4ECDC4",St={__name:"addPlatform",emits:["add-platform"],setup(o,{expose:e,emit:t}){const{t:n}=te(),g=t,p=$(!1),l=$(null),M=$(null),_=$({name:"",provider_type:"OpenAI",logo_url:"",source_type:"user"}),P={name:[{required:!0,message:n("setting.modelService.enterName"),trigger:"blur"}],provider_type:[{required:!0,message:n("setting.modelService.selectType"),trigger:"change"}]},L=()=>{l.value.click()},x=async S=>{const a=S.target.files[0];if(a){if(!["image/png","image/jpeg","image/gif","image/webp"].includes(a.type)){console.error("Invalid file type. Please select an image (PNG, JPEG, GIF, or WebP).");return}const O=()=>new Promise((A,C)=>{const k=new FileReader;k.onload=h=>{A(h.target.result)},k.onerror=h=>{C(h)},k.readAsDataURL(a)});try{const A=await O();_.value.logo_url=A}catch{}}},N=async()=>{try{z.insertPlatform(_.value).then(S=>{S.id!==void 0?(I.success(n("setting.modelService.addPlatformSuccess")),g("add-platform",S),V.emit("fresh-pages")):I.error(n("setting.modelService.addPlatformFailed"))}),p.value=!1,B()}catch(S){console.error("Form validation failed:",S),I.error(n("setting.modelService.formValidationFailed"))}},D=()=>{p.value=!1,B()},B=()=>{var S;_.value={name:"",provider_type:"OpenAI",logo_url:"",source_type:"user"},(S=M.value)==null||S.resetFields()};return e({showModal:()=>{p.value=!0}}),(S,a)=>{const y=ae,O=de,A=me,C=ue,k=pe,h=ne;return d(),R(h,{open:p.value,"onUpdate:open":a[2]||(a[2]=T=>p.value=T),title:S.$t("setting.modelService.addProvider"),onOk:N,onCancel:D,maskClosable:!1,centered:!0,okText:S.$t("setting.modelService.confirm"),cancelText:S.$t("setting.modelService.cancel")},{default:m(()=>[r("div",yt,[r("div",{class:"platform-logo-upload",onClick:L},[_.value.logo_url?(d(),b("img",{key:1,src:_.value.logo_url,alt:S.$t("setting.modelService.platformLogo"),class:"platform-logo"},null,8,ht)):(d(),b("div",{key:0,class:"platform-letter",style:Y({backgroundColor:bt})}," P ",4)),r("input",{type:"file",ref_key:"fileInput",ref:l,style:{display:"none"},accept:"image/*",onChange:x},null,544)]),c(k,{model:_.value,rules:P,ref_key:"formRef",ref:M},{default:m(()=>[c(O,{label:S.$t("setting.modelService.providerName"),name:"name"},{default:m(()=>[c(y,{value:_.value.name,"onUpdate:value":a[0]||(a[0]=T=>_.value.name=T),placeholder:S.$t("setting.modelService.namePlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),c(O,{label:S.$t("setting.modelService.providerType"),name:"type",style:{"margin-left":"10px"}},{default:m(()=>[c(C,{value:_.value.provider_type,"onUpdate:value":a[1]||(a[1]=T=>_.value.provider_type=T),placeholder:S.$t("setting.modelService.typePlaceholder")},{default:m(()=>[c(A,{value:"openai"},{default:m(()=>a[3]||(a[3]=[j("OpenAI")])),_:1})]),_:1},8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])])]),_:1},8,["open","title","okText","cancelText"])}}},kt=ee(St,[["__scopeId","data-v-64af9eab"]]),$t={style:{display:"flex","align-items":"center","justify-content":"start"}},Ot={class:"add-platform-form"},Pt=["src","alt"],Ct="#4ECDC4",wt={__name:"settingPlatform",emits:["update-platform"],setup(o,{expose:e,emit:t}){const{t:n}=te(),g=t,p=$(!1),l=$(null),M=$(null),_=$("OpenAI"),P=$({id:"",name:"",provider_type:"",logo_url:"",source_type:"user",api_key:"",api_url:"",api_version:"",is_enabled:!0,activate_time:-1,key_obtain_url:""}),L={name:[{required:!0,message:n("setting.modelService.enterName"),trigger:"blur"}],provider_type:[{required:!0,message:n("setting.modelService.selectType"),trigger:"change"}]},x=()=>{l.value.click()},N=async a=>{const y=a.target.files[0];if(y){if(!["image/png","image/jpeg","image/gif","image/webp"].includes(y.type)){console.error("Invalid file type. Please select an image (PNG, JPEG, GIF, or WebP).");return}const A=()=>new Promise((C,k)=>{const h=new FileReader;h.onload=T=>{C(T.target.result)},h.onerror=T=>{k(T)},h.readAsDataURL(y)});try{const C=await A();P.value.logo_url=C,console.log("Selected file:",y),console.log("Form data:",P.value)}catch(C){console.error("Error loading image:",C)}}},D=async()=>{try{await M.value.validate(),z.updatePlatform(P.value).then(a=>{g("update-platform",a),V.emit("fresh-pages"),I.success(n("setting.modelService.updatePlatformSuccess"))}),p.value=!1}catch{}},B=()=>{p.value=!1},u=async()=>{try{const a=await z.deletePlatform(P.value.id);console.log(a),a.code===0&&I.success(n("setting.modelService.deletePlatformSuccess")),p.value=!1,V.emit("fresh-pages")}catch(a){console.error("Failed to delete platform:",a)}};return e({showModal:a=>{P.value={...a},p.value=!0}}),(a,y)=>{const O=ve,A=ae,C=de,k=me,h=ue,T=pe,G=ne;return d(),R(G,{open:p.value,"onUpdate:open":y[2]||(y[2]=q=>p.value=q),maskClosable:!1,centered:!0,okText:a.$t("setting.modelService.confirm"),cancelText:a.$t("setting.modelService.cancel"),onOk:D,onCancel:B},{title:m(()=>[r("div",$t,[r("span",null,f(a.$t("setting.modelService.editProvider")),1),c(O,{type:"text",danger:"",class:"delete-button"},{default:m(()=>[c(U(Ge),{onClick:u})]),_:1})])]),default:m(()=>[r("div",Ot,[r("div",{class:"platform-logo-upload",onClick:x},[P.value.logo_url?(d(),b("img",{key:1,src:P.value.logo_url,alt:a.$t("setting.modelService.platformLogo"),class:"platform-logo"},null,8,Pt)):(d(),b("div",{key:0,class:"platform-letter",style:Y({backgroundColor:Ct})},f(P.value.name?P.value.name.charAt(0):"P"),5)),r("input",{type:"file",ref_key:"fileInput",ref:l,style:{display:"none"},accept:"image/*",onChange:N},null,544)]),c(T,{model:P.value,rules:L,ref_key:"formRef",ref:M},{default:m(()=>[c(C,{label:a.$t("setting.modelService.providerName"),name:"name"},{default:m(()=>[c(A,{value:P.value.name,"onUpdate:value":y[0]||(y[0]=q=>P.value.name=q),placeholder:a.$t("setting.modelService.namePlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),c(C,{label:a.$t("setting.modelService.providerType"),name:"type",style:{"margin-left":"10px"}},{default:m(()=>[c(h,{value:_.value,"onUpdate:value":y[1]||(y[1]=q=>_.value=q)},{default:m(()=>[c(k,{value:"OpenAI"},{default:m(()=>y[3]||(y[3]=[j("OpenAI")])),_:1})]),_:1},8,["value"])]),_:1},8,["label"])]),_:1},8,["model"])])]),_:1},8,["open","okText","cancelText"])}}},Mt=ee(wt,[["__scopeId","data-v-2d3f3ccb"]]),At={class:"model-form"},Tt={class:"more-options"},It={__name:"modelinfo",props:{platform_id:{type:Number,default:-1}},setup(o,{expose:e}){const{t}=te(),n=$(!1),g=$(null),p=$(!1),l=$(!1),M=o,_=$({model_id:"",model_name:"",group_name:"",model_types:[],platform_id:-1,logo_url:""}),P={model_id:[{required:!0,message:t("setting.modelService.enterModelId"),trigger:"blur"}],model_name:[{required:!1,message:t("setting.modelService.enterModelName"),trigger:"blur"}],group_name:[{required:!1,message:t("setting.modelService.enterGroupName"),trigger:"blur"}],model_types:[{required:!1,type:"array",message:t("setting.modelService.selectModelType"),trigger:"change"}]},L=async()=>{try{if(await g.value.validate(),p.value)await z.updateModel(_.value),V.emit("fresh-models",!0),I.success(t("setting.modelService.updateModelSuccess"));else{_.value.platform_id=M.platform_id;const u=await z.insertModel(_.value);if(u.code===1){I.error(t("setting.modelService.modelAlreadyExists"));return}V.emit("fresh-models",u),I.success(t("setting.modelService.addModelSuccess"))}n.value=!1,N()}catch(u){console.error("Form validation failed:",u),I.error(t("setting.modelService.formValidationFailed"))}},x=()=>{n.value=!1,N()},N=()=>{var u;_.value={model_id:"",model_name:"",group_name:"",model_types:[],platform_id:M.platform_id,logo_url:""},l.value=!1,(u=g.value)==null||u.resetFields()},D=(u=null)=>{u?(p.value=!0,_.value={...u,model_name:u.model_name||"",model_types:u.model_types||[],platform_id:u.platform_id||M.platform_id}):(p.value=!1,N()),n.value=!0},B=()=>{l.value=!l.value};return e({showModal:D}),(u,S)=>{const a=ae,y=de,O=We,A=qe,C=pe,k=ne;return d(),R(k,{open:n.value,"onUpdate:open":S[4]||(S[4]=h=>n.value=h),title:p.value?u.$t("setting.modelService.editModel"):u.$t("setting.modelService.addModel"),onOk:L,onCancel:x,maskClosable:!1,centered:!0,okText:u.$t("setting.modelService.confirm"),cancelText:u.$t("setting.modelService.cancel")},{default:m(()=>[r("div",At,[c(C,{model:_.value,rules:P,ref_key:"formRef",ref:g},{default:m(()=>[c(y,{label:u.$t("setting.modelService.modelId"),name:"model_id",style:{display:"flex","justify-content":"end"}},{default:m(()=>[c(a,{value:_.value.model_id,"onUpdate:value":S[0]||(S[0]=h=>_.value.model_id=h),placeholder:u.$t("setting.modelService.modelIdPlaceholder"),disabled:p.value},null,8,["value","placeholder","disabled"])]),_:1},8,["label"]),c(y,{label:u.$t("setting.modelService.modelName"),name:"model_name"},{default:m(()=>[c(a,{value:_.value.model_name,"onUpdate:value":S[1]||(S[1]=h=>_.value.model_name=h),placeholder:u.$t("setting.modelService.modelNamePlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),c(y,{label:u.$t("setting.modelService.groupName"),name:"group_name"},{default:m(()=>[c(a,{value:_.value.group_name,"onUpdate:value":S[2]||(S[2]=h=>_.value.group_name=h),placeholder:u.$t("setting.modelService.groupNamePlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),r("div",Tt,[r("a",{onClick:B,class:"toggle-link"},f(l.value?u.$t("setting.modelService.hideOptions"):u.$t("setting.modelService.showMoreOptions")),1)]),l.value?(d(),R(y,{key:0,label:u.$t("setting.modelService.modelTypes"),name:"model_types",class:"model-types-item"},{default:m(()=>[c(A,{value:_.value.model_types,"onUpdate:value":S[3]||(S[3]=h=>_.value.model_types=h),class:"model-type-group"},{default:m(()=>[c(O,{class:"checkbox-item",value:"vision"},{default:m(()=>[j(f(u.$t("setting.modelService.typeVision")),1)]),_:1}),c(O,{class:"checkbox-item",value:"network"},{default:m(()=>[j(f(u.$t("setting.modelService.typeNetwork")),1)]),_:1}),c(O,{class:"checkbox-item",value:"embed"},{default:m(()=>[j(f(u.$t("setting.modelService.typeEmbed")),1)]),_:1}),c(O,{class:"checkbox-item",value:"tool"},{default:m(()=>[j(f(u.$t("setting.modelService.typeTool")),1)]),_:1}),c(O,{class:"checkbox-item",value:"reasoning"},{default:m(()=>[j(f(u.$t("setting.modelService.typeReasoning")),1)]),_:1})]),_:1},8,["value"])]),_:1},8,["label"])):E("",!0)]),_:1},8,["model"])])]),_:1},8,["open","title","okText","cancelText"])}}},Nt=ee(It,[["__scopeId","data-v-42c5043c"]]),Dt={class:"platform-model-container"},Ft={class:"model-header"},Bt={class:"models-list"},Lt=["onClick"],jt={class:"group-toggle"},xt={class:"group-name"},Ut={class:"model-logo"},Et={key:0,class:"logo-image"},Rt=["src"],Vt={class:"model-info"},zt={style:{display:"flex","flex-direction":"row","justify-items":"center","align-items":"center",gap:"5px"}},Ht={style:{display:"flex","justify-content":"center","align-content":"center"}},Gt={class:"model-name"},qt={style:{display:"flex","flex-direction":"row","justify-items":"center","align-items":"center"}},Wt={key:0,class:"model-actions"},Jt={class:"model-more-detail"},Qt={key:0},Zt={__name:"modelsList",props:{models:{type:Array,default:()=>[]},platform_id:{type:Number,default:-1},is_subscribe:{type:Boolean,default:!1}},emits:["setting","delete","add-model","update-model"],setup(o,{emit:e}){const{t}=te(),n=o,g=e,p=$({}),l=$(null),M=$({}),_=X(()=>{const a={};return n.models.forEach(y=>{const O=y.group_name||t("setting.modelService.ungrouped");a[O]||(a[O]={name:O,models:[]},p.value[O]===void 0&&(p.value[O]=!0)),a[O].models.push(y)}),Object.values(a)}),P=a=>{p.value[a]=!p.value[a]},L=$({}),x=["#FF6B6B","#4ECDC4","#45B7D1","#96CEB4","#FFEEAD","#D4A5A5","#9B59B6","#3498DB"],N=a=>{if(!L.value[a]){const y=Math.abs(a.split("").reduce((O,A)=>O+A.charCodeAt(0),0))%x.length;L.value[a]=x[y]}return L.value[a]},D=(a=null)=>{l.value.showModal(a),g("setting",a)},B=async a=>{try{await z.deleteModel(a.id),V.emit("fresh-models"),I.success(t("setting.modelService.deleteModelSuccess"))}catch(y){console.error("Failed to delete model:",y),I.error(t("setting.modelService.deleteModelFailed"))}},u={tool:{component:he,class:"type-tool"},network:{component:nt,class:"type-network"},embed:{component:()=>Ye("div",{},"em"),class:"type-embed"},reasoning:{component:fe,class:"type-reasoning"},vision:{component:_e,class:"type-vision"}};De(()=>{});const S=(a,y)=>{navigator.clipboard.writeText(y).then(()=>{M.value[a]={isCopied:!0},I.success(t("setting.modelService.copySuccess")),setTimeout(()=>{M.value[a]={isCopied:!1}},2e3)}).catch(O=>{console.error("Failed to copy:",O),I.error(t("setting.modelService.copyFailed"))})};return(a,y)=>{const O=Xe,A=ve;return d(),b("div",Dt,[r("div",Ft,[r("span",null,f(a.$t("setting.modelService.models")),1)]),r("div",Bt,[(d(!0),b(J,null,Q(_.value,C=>(d(),b("div",{key:C.name,class:"model-group"},[r("div",{class:"group-header",onClick:k=>P(C.name)},[r("span",jt,[p.value[C.name]?(d(),R(U(Je),{key:0})):(d(),R(U(Qe),{key:1}))]),r("span",xt,f(C.name),1)],8,Lt),r("div",{class:ie(["model-items",{collapsed:!p.value[C.name]}])},[(d(!0),b(J,null,Q(C.models,k=>(d(),b("div",{key:k.id,class:"model-item"},[r("div",Ut,[k.logo_url?(d(),b("div",Et,[r("img",{src:k.logo_url,alt:"logo"},null,8,Rt)])):(d(),b("div",{key:1,class:"logo-letter",style:Y({backgroundColor:N(k.model_id)})},f(k.model_id.charAt(0)),5))]),r("div",Vt,[c(O,null,{content:m(()=>{var h;return[r("div",zt,[r("span",Ht,f(k.model_name),1),(d(),R(we((h=M.value[k.model_id])!=null&&h.isCopied?U(Ze):U(ye)),{style:{"align-items":"center"},onClick:T=>S(k.model_id,k.model_name)},null,8,["onClick"]))])]}),default:m(()=>[r("span",Gt,f(k.model_name),1)]),_:2},1024),(d(!0),b(J,null,Q(k.model_types,h=>(d(),b("div",{class:"model-type",key:h},[c(O,null,{content:m(()=>[r("div",qt,[r("span",null,f(h),1)])]),default:m(()=>{var T,G;return[u[h]?(d(),R(we((T=u[h])==null?void 0:T.component),{key:0,class:ie([(G=u[h])==null?void 0:G.class,"type-icon"])},null,8,["class"])):E("",!0)]}),_:2},1024)]))),128))]),o.is_subscribe?E("",!0):(d(),b("div",Wt,[c(U(Fe),{class:"action-icon",onClick:ce(h=>D(k),["stop"])},null,8,["onClick"]),c(U(ge),{class:"action-icon",onClick:ce(h=>B(k),["stop"])},null,8,["onClick"])]))]))),128))],2)]))),128))]),r("div",Jt,[r("span",null,f(a.$t("setting.modelService.viewOfficialDocs")),1)]),o.is_subscribe?E("",!0):(d(),b("div",Qt,[c(A,{type:"primary",class:"addmodel",onClick:y[0]||(y[0]=C=>D())},{default:m(()=>[c(U(Ke)),j(" "+f(a.$t("setting.modelService.add")),1)]),_:1})])),c(Nt,{platform_id:n.platform_id,ref_key:"modelInfoRef",ref:l},null,8,["platform_id"])])}}},Xt=ee(Zt,[["__scopeId","data-v-85caf870"]]),Yt={class:"model-service"},Kt={class:"model-service-container"},el={class:"provider-sidebar"},tl={class:"provider-search",style:{"justify-content":"center","align-items":"center"}},ll={class:"platform-list"},ol=["onClick"],al={key:0,class:"platform-logo"},nl=["src"],sl={class:"platform-name"},rl={key:2,class:"status-text"},il={class:"provider-sidebar-mobile"},cl={style:{display:"flex","flex-direction":"row","justify-content":"space-between","align-items":"center","margin-bottom":"8px"}},dl={style:{color:"#213547","font-size":"18px","font-weight":"700"}},ul={class:"platform-item"},ml={key:0,class:"platform-logo"},pl=["src"],vl={class:"platform-name"},fl={key:2,class:"status-text"},_l={class:"provider-info"},gl={class:"info-header"},yl={class:"info-model-header"},hl={key:0,class:"platform-icon"},bl={key:1,class:"platform-status"},Sl={class:"info-content"},kl={key:0,class:"info-platform"},$l={class:"api-msg-container"},Ol={key:0},Pl={key:1},Cl={class:"api-key"},wl=["href"],Ml={class:"api-address-title"},Al={class:"show-api-tips"},Tl={key:0,class:"api-address"},Il={key:1,class:"api-address"},Nl={key:2,class:"api-address"},Dl={class:"api-address"},Fl={class:"info-model"},Bl={__name:"model",setup(o){const{t:e}=te(),{user:t,membership:n,points:g}=rt(),p=$([]),l=$({id:"default",name:"OpenAI"}),M=$(""),_=$([]),P=$({}),L=$(!1),x=$(!0),N=$(!1),D=$(null),B=$(!1),u=async()=>{N.value=!0},S=async()=>{if(!D.value){I.error(e("setting.modelService.selectCheckModel"));return}N.value=!1,B.value=!0;let s=await z.checkApiAvailability({base_url:l.value.api_url,api_key:l.value.api_key,model:D.value});if(B.value=!1,s.status)I.success(e("setting.modelService.apiCallSucceeded"));else if(s.message.startsWith("LLM API call failed")){let i=s.message.replace("LLM API call failed",e("setting.modelService.apiCallFailed"));I.error(i)}else if(s.message.startsWith("LLM API call timed out")){let i=s.message.replace("LLM API call timed out",e("setting.modelService.apiCallTimeout"));I.error(i)}else if(s.message.startsWith("Network or other error occurred during LLM API call")){let i=s.message.replace("Network or other error occurred during LLM API call",e("setting.modelService.unknownError"));I.error(i)}};function a(s){const i=`setting.modelService.platforms.${s.replace(" ","")}`,w=e(i);return w===i?s:w}V.on("fresh-models",s=>{W(l.value.id)});const y=X(()=>l.value.name.toLocaleString()==="Ollama"),O=X(()=>l.value.name==="Cloudsway"?e("setting.modelService.ak"):e("setting.modelService.apiKey")),A=X(()=>l.value.name==="Cloudsway"?e("setting.modelService.akPlaceholder"):e("setting.modelService.apiKeyPlaceholder")),C=s=>{l.value=JSON.parse(JSON.stringify(s)),P.value={api_key:s.api_key,api_url:s.api_url,is_enabled:s.is_enabled},W(l.value.id),x.value=!0};et([()=>l.value.api_key,()=>l.value.api_url,()=>l.value.is_enabled],()=>{P.value&&(L.value=l.value.api_key!==P.value.api_key||l.value.api_url!==P.value.api_url||l.value.is_enabled!==P.value.is_enabled)},{deep:!0});const k=async()=>{try{await z.updatePlatform({id:l.value.id,api_key:l.value.api_key,api_url:l.value.api_url,is_enabled:l.value.is_enabled,name:l.value.name,logo_url:l.value.logo_url,provider_type:l.value.provider_type,api_version:l.value.api_version}),P.value={api_key:l.value.api_key,api_url:l.value.api_url,is_enabled:l.value.is_enabled},L.value=!1}catch{return}se(l.value.id)},h=$(null),T=$(null),G=()=>{var s;(s=h.value)==null||s.showModal()},q=()=>{var s;(s=T.value)==null||s.showModal(l.value)},Be=s=>{_.value=_.value.filter(i=>i.id!==s.id)},Le=s=>{const i={...s,is_enabled:!0,source_type:"user",color:le[p.value.length%le.length]};p.value=[...p.value,i],l.value=i,W(l.value.id)},je=s=>{const i=p.value.findIndex(w=>w.id===s.id);i!==-1&&(p.value[i]={...s,color:p.value[i].color},l.value.id===s.id&&(l.value=p.value[i]))},le=["#FF6B6B","#4ECDC4","#45B7D1","#96CEB4","#FFEEAD","#D4A5A5","#9B59B6","#3498DB"];De(async()=>{setTimeout(()=>{console.log("触发 closeTour"),V.emit("closeTour")},500),await se(),localStorage.getItem("tour")==="true"&&localStorage.getItem("tour_end")!=="true"&&xe()});let Z=null;const xe=async()=>{Z=st({animate:!0,showProgress:!0,prevBtnText:e("setting.prevStep"),nextBtnText:e("setting.nextStep"),doneBtnText:e("setting.doneStep"),steps:[{element:".platform-list",popover:{side:"bottom",title:e("setting.modelService.modelService"),description:e("setting.modelService.modelServiceTipsOne"),onNextClick:async()=>{re(()=>{Z.moveNext()})}}},{element:"#api-key-value",popover:{side:"bottom",title:e("setting.modelService.modelService"),description:e("setting.modelService.modelServiceTipsTwo"),onNextClick:async()=>{re(()=>{Z.moveNext()})}}},{element:".platform-status",popover:{side:"bottom",title:e("setting.modelService.modelService"),description:e("setting.modelService.modelServiceTipsThree"),onNextClick:async()=>{re(()=>{localStorage.setItem("tour_end","true"),Z.moveNext(),V.emit("onSearchService")})}}}]}),Z.drive()};function se(s){return z.getPlatforms().then(i=>{if(!Array.isArray(i)){console.error("getPlatforms did not return an array:",typeof i,i);return}if(console.log("Platforms loaded:",i.length),n&&(n!=null&&n.startDate)&&(n!=null&&n.endDate)){const w=new Date(n.startDate),F=new Date(n.endDate);!isNaN(w.getTime())&&isNaN(F.getTime())}p.value=i.sort((w,F)=>w.name.localeCompare(F.name)).map((w,F)=>({...w,color:le[F%le.length]})),console.log("platforms.value after assignment:",p.value),s?(l.value=p.value.find(w=>w.id===s),W(l.value.id)):(l.value=p.value[0],W(l.value.id))}).catch(i=>{console.error("Error in init getPlatforms:",i)})}const W=s=>{z.getModels(s).then(i=>{var w;_.value=i,D.value=(w=i[0])==null?void 0:w.model_id})},be=X(()=>{const i=[...Array.isArray(p.value)?p.value:[]].sort((F,oe)=>(oe.is_enabled?1:0)-(F.is_enabled?1:0));if(!M.value)return i;const w=M.value.toLowerCase();return i.filter(F=>F.name&&F.name.toLowerCase().includes(w)||a(F.name).includes(w))}),Ue=async s=>{W(l.value.id)},Ee=async s=>{W(l.value.id)};return V.on("fresh-pages",s=>{se()}),(s,i)=>{var ke,$e,Oe,Pe,Ce;const w=ae,F=me,oe=ue,Re=tt,Se=ve,Ve=lt,ze=ne;return d(),b(J,null,[r("div",Yt,[r("h2",null,f(s.$t("setting.modelService.title")),1),r("div",Kt,[r("div",el,[r("div",tl,[c(w,{value:M.value,"onUpdate:value":i[0]||(i[0]=v=>M.value=v),placeholder:s.$t("setting.modelService.searchPlaceholder"),"prefix-icon":"",style:{"font-size":"14px",height:"36px","margin-bottom":"16px"}},{prefix:m(()=>[c(U(at))]),_:1},8,["value","placeholder"])]),r("div",ll,[(d(!0),b(J,null,Q(be.value,v=>(d(),b("div",{key:v.id,class:ie(["platform-item",{"platform-item-active":l.value.id===v.id}]),onClick:He=>C(v)},[v.logo_url?(d(),b("div",al,[r("img",{src:v.logo_url,alt:"logo",class:"logo"},null,8,nl)])):(d(),b("div",{key:1,class:"platform-letter platform-logo",style:Y({backgroundColor:v.color})},f(v.name.charAt(0)),5)),r("span",sl,f(a(v.name)),1),v.is_enabled?(d(),b("span",rl,f(s.$t("setting.modelService.statusOn")),1)):E("",!0)],10,ol))),128))]),r("div",{class:"provider-post platform-item",onClick:i[1]||(i[1]=v=>G())}," + "+f(s.$t("setting.modelService.addPlatform")),1)]),r("div",il,[r("div",cl,[r("div",dl,f(s.$t("setting.modelService.modelPlatform")),1),r("div",{class:"provider-post",onClick:i[2]||(i[2]=v=>G())}," + "+f(s.$t("setting.modelService.addPlatform")),1)]),c(oe,{style:{width:"100%"},value:l.value.id,"onUpdate:value":i[3]||(i[3]=v=>l.value.id=v)},{default:m(()=>[(d(!0),b(J,null,Q(be.value,v=>(d(),R(F,{key:v.id,value:v.id,onClick:He=>C(v)},{default:m(()=>[r("div",ul,[v.logo_url?(d(),b("div",ml,[r("img",{src:v.logo_url,alt:"logo",class:"logo"},null,8,pl)])):(d(),b("div",{key:1,class:"platform-letter platform-logo",style:Y({backgroundColor:v.color})},f(v.name.charAt(0)),5)),r("span",vl,f(v.name),1),v.is_enabled?(d(),b("span",fl,f(s.$t("setting.modelService.statusOn")),1)):E("",!0)])]),_:2},1032,["value","onClick"]))),128))]),_:1},8,["value"])]),r("div",_l,[r("div",gl,[r("span",yl,f(a(l.value.name)),1),l.value.source_type==="user"?(d(),b("span",hl,[c(U(Fe),{class:"platform-setting",onClick:ce(q,["stop"])})])):E("",!0),l.value.is_subscribe?E("",!0):(d(),b("span",bl,[c(Re,{checked:l.value.is_enabled,"onUpdate:checked":i[4]||(i[4]=v=>l.value.is_enabled=v),class:"custom-switch",onChange:k},null,8,["checked"])]))]),r("div",Sl,[l.value.is_subscribe?E("",!0):(d(),b("div",kl,[r("div",$l,[l.value.name.toLocaleString()==="Ollama"?(d(),b("div",Ol)):(d(),b("div",Pl,[r("span",Cl,f(O.value),1),c(Ve,{id:"api-key-value",value:l.value.api_key,"onUpdate:value":i[5]||(i[5]=v=>l.value.api_key=v),placeholder:A.value,onChange:k},{addonAfter:m(()=>[c(Se,{class:"no-button",onClick:u,loading:B.value},{default:m(()=>[j(f(s.$t("setting.modelService.check")),1)]),_:1},8,["loading"])]),_:1},8,["value","placeholder"])]))]),l.value.key_obtain_url?(d(),b("a",{key:0,href:l.value.key_obtain_url,target:"_blank",class:"get-api-link"},f(s.$t("setting.modelService.getApiKey")),9,wl)):E("",!0),r("span",Ml,f(s.$t("setting.modelService.apiAddress")),1),c(w,{value:l.value.api_url,"onUpdate:value":i[6]||(i[6]=v=>l.value.api_url=v),placeholder:s.$t("setting.modelService.apiAddressPlaceholder"),class:"api-input",onChange:k},ot({_:2},[y.value?{name:"addonAfter",fn:m(()=>[c(Se,{class:"no-button",onClick:u,loading:B.value},{default:m(()=>[j(f(s.$t("setting.modelService.check")),1)]),_:1},8,["loading"])]),key:"0"}:void 0]),1032,["value","placeholder"]),r("div",Al,[r("div",null,[($e=(ke=l.value)==null?void 0:ke.api_url)!=null&&$e.endsWith("#")?(d(),b("span",Tl,f(l.value.api_url.substring(0,l.value.api_url.length-1)),1)):(Pe=(Oe=l.value)==null?void 0:Oe.api_url)!=null&&Pe.endsWith("/")?(d(),b("span",Il,f(l.value.api_url)+"chat/completions ",1)):(d(),b("span",Nl,f((Ce=l.value)==null?void 0:Ce.api_url)+"/chat/completions ",1))]),r("div",Dl,f(s.$t("setting.modelService.apiAddressTip")),1)])])),r("div",Fl,[r("div",null,[c(Xt,{models:_.value,platform_id:l.value.id,is_subscribe:l.value.is_subscribe,onSetting:i[7]||(i[7]=()=>{}),onDelete:Be,onAddModel:Ue,onUpdateModel:Ee},null,8,["models","platform_id","is_subscribe"])])])])])]),c(kt,{ref_key:"addPlatformRef",ref:h,onAddPlatform:Le},null,512),c(Mt,{ref_key:"settingPlatformRef",ref:T,onUpdatePlatform:je},null,512)]),c(ze,{cancelText:s.$t("setting.modelService.cancel"),okText:s.$t("setting.modelService.confirm"),open:N.value,"onUpdate:open":i[9]||(i[9]=v=>N.value=v),centered:"",title:s.$t("setting.modelService.selectCheckModel"),width:"400px",onOk:S},{default:m(()=>[c(oe,{value:D.value,"onUpdate:value":i[8]||(i[8]=v=>D.value=v),style:{width:"100%"}},{default:m(()=>[(d(!0),b(J,null,Q(_.value,v=>(d(),R(F,{key:v.id,value:v.model_id},{default:m(()=>[j(f(v.model_name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1},8,["cancelText","okText","open","title"])],64)}}},Hl=ee(Bl,[["__scopeId","data-v-d3d45c77"]]);export{Hl as default};
