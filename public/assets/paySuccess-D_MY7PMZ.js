import{_ as Y,c as V,a as T,w as g,S as $,u as q,b as A,d as H,r as c,e as _,o as P,f as U,g as j,h as v,i as I,j as b,F as Q,R as X,B as ee,k as S,t as i,C as te,l as d,T as re,m as ne}from"./index-C9fJEsZT.js";import{s as x}from"./membership-C5eKkiGZ.js";import"./http-B5vhwVWP.js";const ae={__name:"paySuccess",setup(a,{expose:B}){B();const{t:r}=q(),e=A(),k=H(),f=c(!0),p=c(!1),l=c({}),s=c("checking"),u=c(null),y=["pending","paid","cancelled","failed"],h=["JPY","KRW"],O=c(!1),w=c(!1),E=_(()=>e.query.from==="desktop");function J(t,n){if(!n)return`${t}（${r("unknownCurrency")}）`;const o=n.toUpperCase();return`${(h.includes(o)?t:t/100).toFixed(2)} ${o}`}function L(t){switch(t){case"paid":return"green";case"unpaid":return"red";default:return"default"}}function Z(t){switch(t){case"paid":return"green";case"pending":return"orange";case"cancelled":case"failed":return"red";case"checking":return"blue";default:return"default"}}function z(t){return{checking:r("status.checking"),paid:r("status.paid"),pending:r("status.pending"),cancelled:r("status.cancelled"),failed:r("status.failed")}[t]||t}const G=_(()=>{switch(s.value){case"paid":return"success";case"pending":return"warning";case"cancelled":case"failed":return"error";case"checking":return"info";default:return"info"}}),K=_(()=>{switch(s.value){case"paid":return r("resultTitle.paid");case"pending":return r("resultTitle.pending");case"cancelled":return r("resultTitle.cancelled");case"failed":return r("resultTitle.failed");case"checking":return r("resultTitle.checking");default:return r("resultTitle.unknown")}}),M=_(()=>["paid","pending","cancelled","failed"].includes(s.value)?r("resultSubtitle.submitted"):"");async function R(t){u.value=setInterval(async()=>{try{const n=await x.checkOrderStatusById(t),o=n==null?void 0:n.status;o&&(s.value=o,y.includes(o)&&(w.value=!0,s.value==="paid"&&(clearInterval(u.value),u.value=null),e.query.from==="desktop"&&s.value==="paid"&&F("paid")))}catch(n){console.error("轮询订单状态失败：",n)}},3e3)}const D=async()=>{var n,o;const t=e.query.session_id;if(!t){p.value=!0,f.value=!1;return}try{const m=await x.createStripeCheckoutSession(t);l.value=m.session,O.value=!0;const C=(o=(n=l.value)==null?void 0:n.metadata)==null?void 0:o.order_id;C?R(C):(w.value=!0,f.value=!1)}catch(m){console.error(m),j.error(r("fetchFailed")),p.value=!0}finally{f.value=!1}},W=()=>{k.push("/")};P(()=>{D()}),U(()=>{u.value&&clearInterval(u.value)});const F=t=>{const n=`lemonai://pay-result?orderId=${l.value.id}&amount=${l.value.amount_total}&currency=${l.value.currency}&status=${t}`;window.location.href=n},N={t:r,route:e,router:k,loading:f,error:p,order:l,orderStatus:s,pollingTimer:u,terminalStates:y,zeroDecimalCurrencies:h,orderLoaded:O,showOrderInfo:w,fromClient:E,formatAmount:J,paymentStatusColor:L,orderStatusColor:Z,statusText:z,resultStatus:G,resultTitle:K,resultSubtitle:M,pollOrderStatus:R,fetchOrder:D,goHome:W,notifyClient:F,ref:c,onMounted:P,onBeforeUnmount:U,computed:_,get useRoute(){return A},get useRouter(){return H},get message(){return j},get membershipService(){return x},get useI18n(){return q}};return Object.defineProperty(N,"__isScriptSetup",{enumerable:!1,value:!0}),N}},se={style:{"max-width":"600px",margin:"60px auto","text-align":"center"}};function oe(a,B,r,e,k,f){const p=ee,l=X,s=re,u=te,y=ne,h=$;return v(),V("div",se,[T(h,{spinning:e.loading,tip:a.$t("loadingTip")},{default:g(()=>[e.orderLoaded?(v(),V(Q,{key:0},[T(l,{status:e.resultStatus,title:e.resultTitle,"sub-title":e.resultSubtitle},{extra:g(()=>[e.fromClient?b("v-if",!0):(v(),I(p,{key:0,type:"primary",onClick:e.goHome},{default:g(()=>[S(i(a.$t("backHome")),1)]),_:1}))]),_:1},8,["status","title","sub-title"]),e.showOrderInfo?(v(),I(u,{key:0,title:a.$t("orderInfo"),style:{"margin-top":"24px","text-align":"left"}},{default:g(()=>[d("p",null,[d("strong",null,i(a.$t("orderId"))+"：",1),S(i(e.order.order_sn),1)]),d("p",null,[d("strong",null,i(a.$t("paymentAmount"))+"：",1),S(" "+i(e.order.amount_total&&e.order.currency?e.formatAmount(e.order.amount_total,e.order.currency):a.$t("unknown")),1)]),d("p",null,[d("strong",null,i(a.$t("orderStatus"))+"：",1),T(s,{color:e.orderStatusColor(e.orderStatus)},{default:g(()=>[S(i(e.statusText(e.orderStatus)),1)]),_:1},8,["color"])])]),_:1},8,["title"])):b("v-if",!0)],64)):e.error?(v(),I(y,{key:1,type:"error",message:a.$t("loadFailed"),"show-icon":""},null,8,["message"])):b("v-if",!0)]),_:1},8,["spinning","tip"])])}const ie=Y(ae,[["render",oe],["__file","/Users/samihalawa/git/PROJECTS_CODING/lemonai/frontend/src/view/pay/paySuccess.vue"]]);export{ie as default};
