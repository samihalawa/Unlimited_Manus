import{u as E,r as o,c as v,a as J,o as K,b as L,d as C,e as k,w as p,S as M,f as P,g as W,h as f,i as w,j as $,F as Y,R as G,B as Q,k as g,t as u,C as X,l as c,T as ee,_ as te}from"./index-DaULH4WC.js";import{s as T}from"./membership-BfcodThB.js";import"./http-yCFEzgv3.js";const ae={style:{"max-width":"600px",margin:"60px auto","text-align":"center"}},oe={__name:"paySuccess",setup(ne){const{t:a}=E(),_=J(),I=W(),m=o(!0),y=o(!1),r=o({}),s=o("checking"),i=o(null),b=["pending","paid","cancelled","failed"],B=["JPY","KRW"],S=o(!1),h=o(!1),x=v(()=>_.query.from==="desktop");function F(e,t){if(!t)return`${e}（${a("unknownCurrency")}）`;const n=t.toUpperCase();return`${(B.includes(n)?e:e/100).toFixed(2)} ${n}`}function R(e){switch(e){case"paid":return"green";case"pending":return"orange";case"cancelled":case"failed":return"red";case"checking":return"blue";default:return"default"}}function D(e){return{checking:a("status.checking"),paid:a("status.paid"),pending:a("status.pending"),cancelled:a("status.cancelled"),failed:a("status.failed")}[e]||e}const N=v(()=>{switch(s.value){case"paid":return"success";case"pending":return"warning";case"cancelled":case"failed":return"error";case"checking":return"info";default:return"info"}}),O=v(()=>{switch(s.value){case"paid":return a("resultTitle.paid");case"pending":return a("resultTitle.pending");case"cancelled":return a("resultTitle.cancelled");case"failed":return a("resultTitle.failed");case"checking":return a("resultTitle.checking");default:return a("resultTitle.unknown")}}),V=v(()=>["paid","pending","cancelled","failed"].includes(s.value)?a("resultSubtitle.submitted"):"");async function q(e){i.value=setInterval(async()=>{try{const t=await T.checkOrderStatusById(e),n=t==null?void 0:t.status;n&&(s.value=n,b.includes(n)&&(h.value=!0,s.value==="paid"&&(clearInterval(i.value),i.value=null),_.query.from==="desktop"&&s.value==="paid"&&U("paid")))}catch(t){console.error("轮询订单状态失败：",t)}},3e3)}const A=async()=>{var t,n;const e=_.query.session_id;if(!e){y.value=!0,m.value=!1;return}try{const l=await T.createStripeCheckoutSession(e);r.value=l.session,S.value=!0;const d=(n=(t=r.value)==null?void 0:t.metadata)==null?void 0:n.order_id;d?q(d):(h.value=!0,m.value=!1)}catch(l){console.error(l),P.error(a("fetchFailed")),y.value=!0}finally{m.value=!1}},H=()=>{I.push("/")};K(()=>{A()}),L(()=>{i.value&&clearInterval(i.value)});const U=e=>{const t=`lemonai://pay-result?orderId=${r.value.id}&amount=${r.value.amount_total}&currency=${r.value.currency}&status=${e}`;window.location.href=t};return(e,t)=>{const n=Q,l=G,d=ee,Z=X,j=te,z=M;return f(),C("div",ae,[k(z,{spinning:m.value,tip:e.$t("loadingTip")},{default:p(()=>[S.value?(f(),C(Y,{key:0},[k(l,{status:N.value,title:O.value,"sub-title":V.value},{extra:p(()=>[x.value?$("",!0):(f(),w(n,{key:0,type:"primary",onClick:H},{default:p(()=>[g(u(e.$t("backHome")),1)]),_:1}))]),_:1},8,["status","title","sub-title"]),h.value?(f(),w(Z,{key:0,title:e.$t("orderInfo"),style:{"margin-top":"24px","text-align":"left"}},{default:p(()=>[c("p",null,[c("strong",null,u(e.$t("orderId"))+"：",1),g(u(r.value.order_sn),1)]),c("p",null,[c("strong",null,u(e.$t("paymentAmount"))+"：",1),g(" "+u(r.value.amount_total&&r.value.currency?F(r.value.amount_total,r.value.currency):e.$t("unknown")),1)]),c("p",null,[c("strong",null,u(e.$t("orderStatus"))+"：",1),k(d,{color:R(s.value)},{default:p(()=>[g(u(D(s.value)),1)]),_:1},8,["color"])])]),_:1},8,["title"])):$("",!0)],64)):y.value?(f(),w(j,{key:1,type:"error",message:e.$t("loadFailed"),"show-icon":""},null,8,["message"])):$("",!0)]),_:1},8,["spinning","tip"])])}}};export{oe as default};
