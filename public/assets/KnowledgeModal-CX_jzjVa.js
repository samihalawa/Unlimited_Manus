import{a as l,I as he,_ as de,s as ke,i as N,h as b,w as c,j as K,U as ue,V as Ce,ab as pe,ac as we,ad as xe,l as I,ae as me,c as V,Y as _e,af as Se,t as E,F as Q,P as ve,X as ge,Z as D,Q as se,r as m,e as z,v as W,ag as Oe,ah as Ie,k as O,B as Pe,ai as Me,aj as Ae,a0 as Ue,a4 as Ee,a5 as Te,d as re,o as le,g as T,$ as Ve}from"./index-COUhflQL.js";import{s as ie}from"./mcp-CPgW5lOl.js";import{h}from"./http-B5vhwVWP.js";import{e as $}from"./emitter-E5P-NQ8u.js";import{u as X}from"./user-B_oAAdlF.js";import{u as Z}from"./edit-BCG9471i.js";var ze={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M928 161H699.2c-49.1 0-97.1 14.1-138.4 40.7L512 233l-48.8-31.3A255.2 255.2 0 00324.8 161H96c-17.7 0-32 14.3-32 32v568c0 17.7 14.3 32 32 32h228.8c49.1 0 97.1 14.1 138.4 40.7l44.4 28.6c1.3.8 2.8 1.3 4.3 1.3s3-.4 4.3-1.3l44.4-28.6C602 807.1 650.1 793 699.2 793H928c17.7 0 32-14.3 32-32V193c0-17.7-14.3-32-32-32zM324.8 721H136V233h188.8c35.4 0 69.8 10.1 99.5 29.2l48.8 31.3 6.9 4.5v462c-47.6-25.6-100.8-39-155.2-39zm563.2 0H699.2c-54.4 0-107.6 13.4-155.2 39V298l6.9-4.5 48.8-31.3c29.7-19.1 64.1-29.2 99.5-29.2H888v488zM396.9 361H211.1c-3.9 0-7.1 3.4-7.1 7.5v45c0 4.1 3.2 7.5 7.1 7.5h185.7c3.9 0 7.1-3.4 7.1-7.5v-45c.1-4.1-3.1-7.5-7-7.5zm223.1 7.5v45c0 4.1 3.2 7.5 7.1 7.5h185.7c3.9 0 7.1-3.4 7.1-7.5v-45c0-4.1-3.2-7.5-7.1-7.5H627.1c-3.9 0-7.1 3.4-7.1 7.5zM396.9 501H211.1c-3.9 0-7.1 3.4-7.1 7.5v45c0 4.1 3.2 7.5 7.1 7.5h185.7c3.9 0 7.1-3.4 7.1-7.5v-45c.1-4.1-3.1-7.5-7-7.5zm416 0H627.1c-3.9 0-7.1 3.4-7.1 7.5v45c0 4.1 3.2 7.5 7.1 7.5h185.7c3.9 0 7.1-3.4 7.1-7.5v-45c.1-4.1-3.1-7.5-7-7.5z"}}]},name:"read",theme:"outlined"};function ce(a){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?Object(arguments[t]):{},e=Object.keys(s);typeof Object.getOwnPropertySymbols=="function"&&(e=e.concat(Object.getOwnPropertySymbols(s).filter(function(_){return Object.getOwnPropertyDescriptor(s,_).enumerable}))),e.forEach(function(_){Le(a,_,s[_])})}return a}function Le(a,t,s){return t in a?Object.defineProperty(a,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):a[t]=s,a}var fe=function(t,s){var e=ce({},t,s.attrs);return l(he,ce({},e,{icon:ze}),null)};fe.displayName="ReadOutlined";fe.inheritAttrs=!1;const R="/api/agent",J={getList(){return h.get(R)},getById(a){return h.get(`${R}/${a}`)},update(a,t,s,e,_){return h.put(`${R}/${a}`,{name:t,describe:s,mcp_server_ids:e,is_public:_})},create(a,t,s,e){return h.post(R,{name:a,describe:t,mcp_server_ids:s,is_public:e})},delete(a){return h.del(`${R}/${a}`)},generate(a,t,s){return h.post(`${R}/generate`,{question:a,conversation_id:t,is_public:s})}},Re={__name:"agentsEdit",props:{visible:Boolean,id:String},emits:["update:visible","updateList"],setup(a,{expose:t,emit:s}){t();const e=X(),{user:_,membership:P,points:x}=D(e),S=Z(),{agent:v}=D(S),d=a,f=s,n=se({name:"",describe:"",mcpids:[],is_public:!0}),p=m([]),C=m(""),y=m(!1),u=m("Create Agent"),k=m(!1),L=m("Upgrade"),M=[{value:!0,label:"Public",desc:"Anyone can view and remix"},{value:!1,label:"Personal",desc:"Only visible to yourself"}],g=z(()=>!!d.id),r=z(()=>{var i;return!((i=P.value)!=null&&i.planName)}),w=()=>{k.value=!1},A=()=>{k.value=!0},F=async()=>{try{const i=await ie.activate_servers();p.value=Array.isArray(i)?i:[]}catch(i){console.error("Error fetching MCP servers:",i)}},H=()=>{n.name="",n.describe="",n.mcpids=[],n.is_public=!0,C.value=""},Y=async()=>{if(console.log("initAgent",d.id),H(),u.value=g.value?"Edit Agent":"Create Agent",!!g.value){y.value=!0;try{const i=await J.getById(d.id);console.log("res",i),n.name=i.name||"",n.describe=i.describe||"",n.mcpids=i.mcp_server_ids||[],n.is_public=i.is_public}catch(i){console.error("initAgent error",i)}finally{y.value=!1}}};W(()=>d.visible,async i=>{i&&(await F(),await Y())});const q={userStore:e,user:_,membership:P,points:x,chatStore:S,agent:v,props:d,emit:f,form:n,mcpServers:p,searchKeyword:C,loading:y,modalTitle:u,showUpgradeModal:k,upgradeTitle:L,visibilityOptions:M,isEditMode:g,isPersonalDisabled:r,closeModal:w,upgradeToPro:A,fetchMcpServers:F,resetForm:H,initAgent:Y,handleOk:async()=>{if(g.value)await J.update(d.id,n.name,n.describe,n.mcpids,n.is_public),v.value&&v.value.id===d.id&&(v.value={...v.value,name:n.name,describe:n.describe,mcp_server_ids:n.mcpids,is_public:n.is_public}),$.emit("updateAgentList");else{let i=await J.create(n.name,n.describe,n.mcpids);$.emit("addAgent",i)}f("update:visible",!1)},handleCancel:()=>{H(),f("update:visible",!1)},toggleMcp:i=>{const G=n.mcpids.indexOf(i);G>-1?n.mcpids.splice(G,1):n.mcpids.push(i)},ref:m,reactive:se,watch:W,computed:z,get mcpService(){return ie},get agentService(){return J},get emitter(){return $},get storeToRefs(){return D},get useUserStore(){return X},get useChatStore(){return Z}};return Object.defineProperty(q,"__isScriptSetup",{enumerable:!1,value:!0}),q}},je={class:"mcp-grid"},De=["onClick"],He={class:"checkbox-icon"},Be={class:"mcp-content"},Ne={class:"mcp-name"},Ke={class:"mcp-desc"};function Fe(a,t,s,e,_,P){const x=Ce,S=ue,v=pe,d=me,f=ke("a-icon"),n=xe,p=we,C=ve,y=ge;return b(),N(y,{open:s.visible,title:e.modalTitle,width:"800px",onCancel:e.handleCancel,onOk:e.handleOk},{default:c(()=>[l(C,{model:e.form,layout:"vertical"},{default:c(()=>[l(S,{label:"Name"},{default:c(()=>[l(x,{value:e.form.name,"onUpdate:value":t[0]||(t[0]=u=>e.form.name=u),placeholder:"Please enter name"},null,8,["value"])]),_:1}),l(S,{label:"Description"},{default:c(()=>[l(v,{value:e.form.describe,"onUpdate:value":t[1]||(t[1]=u=>e.form.describe=u),rows:"4",placeholder:"Please enter describe"},null,8,["value"])]),_:1}),K(` <a-form-item label="Visibility">
                <a-radio-group style="width: 100%;display: flex;justify-content: space-between;" v-model:value="form.is_public">
                    <a-radio v-for="option in visibilityOptions" :key="option.value" :value="option.value" 
                             :disabled="!option.value && isPersonalDisabled">
                        <span>{{ option.label }}</span>
                        <a-tag v-if="!option.value" size="small" style="margin-left: 4px; background-color: #000; color: #fff; border: none;">Pro+</a-tag>
                        <span style="color: #666; font-size: 12px; margin-left: 8px;">{{ option.desc }}</span>
                    </a-radio>
                </a-radio-group>
                <div v-if="isPersonalDisabled" style="margin-top: 8px; padding: 8px; background-color: #f0f0f0; border: 1px solid #d9d9d9; border-radius: 4px;">
                    <span style="color: #666; font-size: 12px;">
                        Want to {{ isEditMode ? 'set agent as' : 'create' }} private? 
                        <a @click="upgradeToPro()" style="color: #1890ff; text-decoration: underline; cursor: pointer;">Upgrade to Pro+</a>
                    </span>
                </div>
            </a-form-item> `),l(p,null,{default:c(()=>[l(n,{key:"1",header:"Select MCP Services"},{default:c(()=>[l(d,{value:e.searchKeyword,"onUpdate:value":t[2]||(t[2]=u=>e.searchKeyword=u),placeholder:"Search MCP services",allowClear:"",style:{"margin-bottom":"16px"}},null,8,["value"]),I("div",je,[(b(!0),V(Q,null,_e(e.mcpServers,u=>(b(),V("div",{key:u.id,class:Se(["mcp-card",{selected:e.form.mcpids.includes(u.id)}]),onClick:k=>e.toggleMcp(u.id)},[I("div",He,[e.form.mcpids.includes(u.id)?(b(),N(f,{key:0,type:"check-circle",style:{color:"#52c41a","font-size":"20px"}})):K("v-if",!0)]),I("div",Be,[I("div",Ne,E(u.name),1),I("div",Ke,E(u.describe),1)])],10,De))),128))])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["open","title"])}const ot=de(Re,[["render",Fe],["__scopeId","data-v-6ab2a582"],["__file","/Users/samihalawa/git/PROJECTS_CODING/lemonai/frontend/src/view/agents/components/agentsEdit.vue"]]),B="/api/knowledge",j={create(a,t,s){return h.post(B,{content:a,category:t,agent_id:s})},getList(a){return h.get(B,{agent_id:a})},getById(a){return h.get(`${B}/detail/${a}`)},update(a,t,s){return h.put(`${B}/${a}`,{content:t,category:s})},delete(a){return h.del(`${B}/${a}`)},getCategoryList(){return h.get("/api/knowledge/categories")}},Ye={__name:"KnowledgeModal",props:{agentId:{type:Number,default:0}},setup(a,{expose:t}){const s=Z(),{agent:e}=D(s),_=X(),{user:P,membership:x,points:S}=D(_),v=re(),d=m(!1),f=m(!1),n=m(null),p=m({content:"",category:""}),C=m(""),y=m([]),u=m([]),k=m("personal"),L=a;function M(){return L.agentId||e.value.id}const g=z(()=>{var o;return!!((o=x.value)!=null&&o.planName)}),r=z(()=>k.value==="system"&&!g.value),w=async()=>{try{const o=await j.getCategoryList();u.value=o||[]}catch(o){console.error(o)}},A=async()=>{try{const o=await j.getList(M());y.value=k.value==="system"?o.system||[]:o.personal||[]}catch(o){console.error(o)}},F=async o=>{o==="system"&&g.value,k.value=o,await A()},H=z(()=>y.value.filter(o=>{var U,oe;return((U=o.content)==null?void 0:U.includes(C.value))||((oe=o.category)==null?void 0:oe.includes(C.value))})),Y=()=>{n.value=null,p.value={content:"",category:""},f.value=!0},ee=o=>{n.value=o,p.value={content:o.content,category:o.category},f.value=!0},te=async()=>{var o;if(!p.value.content||!p.value.category){T.error("Please complete content and category.");return}try{(o=n.value)!=null&&o.id?(await j.update(n.value.id,p.value.content,p.value.category),T.success("Updated successfully.")):(await j.create(p.value.content,p.value.category,M()),T.success("Added successfully.")),f.value=!1,A()}catch(U){console.error(U),T.error("Operation failed.")}},ae=async o=>{try{await j.delete(o),T.success("Deleted successfully."),A()}catch(U){console.error(U),T.error("Failed to delete.")}},q=()=>{d.value=!1},i=()=>{d.value=!1},G=()=>{},ye=()=>{const o=localStorage.getItem("access_token"),U=P.value&&P.value.id;!o||!U?v.push({name:"login"}):v.push({name:"pricing"})},be=[{title:"Content",dataIndex:"content",key:"content"},{title:"Category",dataIndex:"category",key:"category"},{title:"Created At",dataIndex:"create_at",key:"create_at",width:200},{title:"Actions",key:"action",width:100}];le(()=>{w()}),W(d,o=>{o&&A()}),t({visible:d});const ne={chatStore:s,agent:e,userStore:_,user:P,membership:x,points:S,router:v,visible:d,editVisible:f,editingItem:n,form:p,searchText:C,data:y,categories:u,activeTab:k,props:L,getAgentId:M,isMember:g,showOverlay:r,getCategoryList:w,getList:A,onTabChange:F,filteredList:H,showAddModal:Y,editItem:ee,saveItem:te,deleteItem:ae,onCancel:q,onOk:i,onSearch:G,goUpgrade:ye,columns:be,ref:m,computed:z,onMounted:le,watch:W,get dayjs(){return Ve},get message(){return T},get service(){return j},get useChatStore(){return Z},get useUserStore(){return X},get storeToRefs(){return D},get useRouter(){return re}};return Object.defineProperty(ne,"__isScriptSetup",{enumerable:!1,value:!0}),ne}},qe={class:"toolbar"},Ge={class:"table-container"},Je={key:2,class:"content-ellipsis"},Qe={key:0,class:"overlay-mask"},We={class:"overlay-content"};function Xe(a,t,s,e,_,P){const x=Oe,S=Ie,v=me,d=Pe,f=Ae,n=Me,p=Ue,C=pe,y=ue,u=Te,k=Ee,L=ve,M=ge;return b(),N(M,{open:e.visible,"onUpdate:open":t[7]||(t[7]=g=>e.visible=g),title:"Experience Management",width:"900px",onCancel:e.onCancel,onOk:e.onOk,footer:null,"ok-text":"Close","cancel-button-props":{style:{display:"none"}}},{default:c(()=>{var g;return[l(S,{activeKey:e.activeTab,"onUpdate:activeKey":t[0]||(t[0]=r=>e.activeTab=r),onChange:e.onTabChange,style:{"margin-bottom":"16px"}},{default:c(()=>[l(x,{key:"personal",tab:"Personal Experience"}),l(x,{key:"system",tab:"System Experience"})]),_:1},8,["activeKey"]),I("div",qe,[l(v,{value:e.searchText,"onUpdate:value":t[1]||(t[1]=r=>e.searchText=r),placeholder:"Please enter content or category","enter-button":"",onSearch:e.onSearch,style:{"max-width":"300px"}},null,8,["value"]),l(d,{type:"primary",onClick:e.showAddModal},{default:c(()=>t[8]||(t[8]=[O("Add Experience")])),_:1})]),I("div",Ge,[l(p,{columns:e.columns,"data-source":e.filteredList,"row-key":"id",pagination:{pageSize:5}},{bodyCell:c(({column:r,record:w})=>[r.key==="create_at"?(b(),V(Q,{key:0},[O(E(e.dayjs(w[r.dataIndex]).format("YYYY-MM-DD HH:mm")),1)],64)):r.key==="action"?(b(),N(n,{key:1},{default:c(()=>[l(d,{type:"link",onClick:A=>e.editItem(w)},{default:c(()=>t[9]||(t[9]=[O("Edit")])),_:2},1032,["onClick"]),l(f,{title:"Are you sure to delete?",onConfirm:()=>e.deleteItem(w.id)},{default:c(()=>[l(d,{danger:"",type:"link"},{default:c(()=>t[10]||(t[10]=[O("Delete")])),_:1})]),_:2},1032,["onConfirm"])]),_:2},1024)):r.key==="content"?(b(),V("div",Je,E(w[r.dataIndex]),1)):(b(),V(Q,{key:3},[O(E(w[r.dataIndex]),1)],64))]),_:1},8,["data-source"]),K(" 蒙版，仅在非会员查看 system 时显示 "),e.showOverlay?(b(),V("div",Qe,[I("div",We,[O(E(a.$t("setting.experience.systemExperienceRequiresUpgrade"))+" ",1),I("button",{onClick:e.goUpgrade,class:"upgrade"},E(a.$t("member.upgrade")),1)])])):K("v-if",!0)]),K(" 编辑 / 添加 弹窗 "),l(M,{open:e.editVisible,"onUpdate:open":t[5]||(t[5]=r=>e.editVisible=r),title:(g=e.editingItem)!=null&&g.id?"Edit Experience":"Add Experience",onOk:e.saveItem,onCancel:t[6]||(t[6]=r=>e.editVisible=!1),width:700},{footer:c(()=>[l(d,{style:{"background-color":"#1a1a19","border-color":"#1a1a19",color:"#fff"},onClick:e.saveItem},{default:c(()=>t[11]||(t[11]=[O(" Save ")])),_:1}),l(d,{onClick:t[4]||(t[4]=r=>e.editVisible=!1)},{default:c(()=>t[12]||(t[12]=[O("Cancel")])),_:1})]),default:c(()=>[l(L,{model:e.form,layout:"vertical"},{default:c(()=>[l(y,{label:"Content"},{default:c(()=>[l(C,{value:e.form.content,"onUpdate:value":t[2]||(t[2]=r=>e.form.content=r),rows:12,placeholder:"Enter content here"},null,8,["value"])]),_:1}),l(y,{label:"Category"},{default:c(()=>[l(k,{value:e.form.category,"onUpdate:value":t[3]||(t[3]=r=>e.form.category=r),placeholder:"Please select category","allow-clear":""},{default:c(()=>[(b(!0),V(Q,null,_e(e.categories,r=>(b(),N(u,{key:r,value:r},{default:c(()=>[O(E(r),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","title"])]}),_:1},8,["open"])}const st=de(Ye,[["render",Xe],["__scopeId","data-v-f7343306"],["__file","/Users/samihalawa/git/PROJECTS_CODING/lemonai/frontend/src/view/agents/components/KnowledgeModal.vue"]]);export{ot as A,st as K,fe as R,J as s};
