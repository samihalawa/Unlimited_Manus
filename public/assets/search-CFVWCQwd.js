import{_ as R,c as f,h as p,l as o,j as v,t as l,a as g,a6 as j,w as T,F as D,Y as L,i as V,a5 as q,a4 as $,W as G,a7 as J,k as M,B as z,a8 as W,U as Y,u as I,r as y,o as U,x as A,g as h,a9 as B,e as H,v as Q}from"./index-C9fJEsZT.js";import{h as k}from"./http-B5vhwVWP.js";import{e as O}from"./emitter-E5P-NQ8u.js";import{A as F}from"./driver-BxHdV7Lz.js";const _={async getSearchEngineConfig(){return await k.get("/api/search_provider_setting")||{}},async getSearchEngineTemplates(){return await k.get("/api/search_provider_setting/templates")||{}},async getSearchEngineConfigs(){return await k.get("/api/search_provider_setting/configs")||{}},async updateSearchEngineConfig(s){return(await k.put("/api/search_provider_setting/",s)).data||{}},async checkSearchProvider(s){return await k.post("/api/search_provider_setting/check_search_provider",s)||{}}},X={__name:"index",setup(s,{expose:i}){i();const{t}=I(),a=y([]),b=y(!0),m=y(""),e=y({provider_id:1,provider_name:"Tavily",base_config:{api_key:"",endpoint:""},include_date:!0,cover_provider_search:!0,enable_enhanced_mode:!0,result_count:5,blacklist:null}),S=y(!1);let d=null;const E=async()=>{console.log("checkApiKeydasdsa");let n={};if(e.value.provider_name=="Tavily"){if(n.type="tavily",n.api_key=e.value.base_config.api_key,n.api_key==""){h.error(t("setting.searchService.apiKeyRequired"));return}}else if(e.value.provider_name=="Cloudsway"){if(n.type="cloudsway",n.api_key=e.value.base_config.api_key,n.endpoint=e.value.base_config.endpoint,n.api_key==""){h.error(t("setting.searchService.accessKeyRequired"));return}else if(n.endpoint==""){h.error(t("setting.searchService.endpointRequired"));return}}else n.type="local",n.engine=e.value.provider_name;console.log(e.value),S.value=!0;let u=await _.checkSearchProvider(n);S.value=!1,u.status!="fail"?h.success(e.value.provider_name+" "+t("setting.searchService.checkSearchEngineSuccess")):h.error(e.value.provider_name+" "+t("setting.searchService.checkSearchEngineFailed"))},w=async()=>{d=F({animate:!0,showProgress:!0,prevBtnText:t("setting.prevStep"),nextBtnText:t("setting.nextStep"),doneBtnText:t("setting.doneStep"),steps:[{element:"#searchTemplates",popover:{side:"bottom",title:t("setting.searchService.searchService"),description:t("setting.searchService.searchEngineTipsOne"),onNextClick:async()=>{B(()=>{d.moveNext()})}}},{element:".search-choose-api-input",popover:{side:"bottom",title:t("setting.searchService.searchService"),description:t("setting.searchService.searchEngineTipsTwo"),onNextClick:async()=>{B(()=>{localStorage.setItem("tour_end","true"),d.moveNext(),O.emit("onDefaultModelSetting")})}}}]}),d.drive()};async function N(n){const u=a.value.find(C=>C.name===n).id;try{await _.updateSearchEngineConfig({provider_id:u,include_date:e.value.include_date,cover_provider_search:e.value.cover_provider_search,enable_enhanced_mode:e.value.enable_enhanced_mode,result_count:e.value.result_count,blacklist:e.value.blacklist})}catch{h.error(t("update platform failed"));return}const r=(await _.getSearchEngineConfigs()).find(C=>C.provider_id===u);e.value.base_config=r.base_config||{api_key:"",endpoint:""},e.value.provider_id=u||-1,e.value.provider_name=n||""}function c(n){return n==="Tavily"?t("setting.searchService.tavilyName"):n==="Baidu"?t("setting.searchService.baiduName"):n==="Bing"?t("setting.searchService.bingName"):n==="Cloudsway"?t("setting.searchService.couldswayName"):n}U(async()=>{var n,u,P;localStorage.getItem("tour")==="true"&&localStorage.getItem("tour_end")!=="true"&&w();try{a.value=await _.getSearchEngineTemplates(),b.value=!1;try{const r=await _.getSearchEngineConfig();r.provider_name?(m.value=r.provider_name,e.value={...r},r.provider_name==="Tavily"?(e.value.base_config={api_key:""},e.value.base_config.api_key=((n=r==null?void 0:r.base_config)==null?void 0:n.api_key)||""):r.provider_name==="Cloudsway"?(e.value.base_config={api_key:"",endpoint:""},e.value.base_config.api_key=((u=r==null?void 0:r.base_config)==null?void 0:u.api_key)||"",e.value.base_config.endpoint=((P=r==null?void 0:r.base_config)==null?void 0:P.endpoint)||""):e.value.base_config={}):m.value="Tavily"}catch(r){console.error("Failed to fetch user config:",r),m.value="Tavily"}}catch(r){console.error("Failed to fetch templates:",r),b.value=!1}}),A(()=>{x()});const x=async()=>{try{console.log("当前保存",e.value),e.value.provider_name==="Tavily"?await _.updateSearchEngineConfig({provider_id:e.value.provider_id,api_key:e.value.base_config.api_key,include_date:e.value.include_date,cover_provider_search:e.value.cover_provider_search,enable_enhanced_mode:e.value.enable_enhanced_mode,result_count:e.value.result_count,blacklist:e.value.blacklist}):e.value.provider_name==="Cloudsway"?await _.updateSearchEngineConfig({provider_id:e.value.provider_id,api_key:e.value.base_config.api_key,endpoint:e.value.base_config.endpoint,include_date:e.value.include_date,cover_provider_search:e.value.cover_provider_search,enable_enhanced_mode:e.value.enable_enhanced_mode,result_count:e.value.result_count,blacklist:e.value.blacklist}):await _.updateSearchEngineConfig({provider_id:e.value.provider_id,include_date:e.value.include_date,cover_provider_search:e.value.cover_provider_search,enable_enhanced_mode:e.value.enable_enhanced_mode,result_count:e.value.result_count,blacklist:e.value.blacklist})}catch(n){console.error("Failed to save config:",n),h.error(t("setting.searchService.saveBlacklistFailed"))}},K={t,searchTemplates:a,loading:b,selectedTemplate:m,selectedConfig:e,checkLoading:S,get tourDriver(){return d},set tourDriver(n){d=n},handleCheckApiKey:E,step1:w,handleTemplateChange:N,displayName:c,handleSave:x,ref:y,onMounted:U,watch:Q,computed:H,onUnmounted:A,nextTick:B,get useI18n(){return I},get searchEngineService(){return _},get message(){return h},get emitter(){return O},get driver(){return F}};return Object.defineProperty(K,"__isScriptSetup",{enumerable:!1,value:!0}),K}},Z={class:"search-container"},ee={class:"search-choose search-item"},ae={class:"search-choose-header header"},ne={class:"search-choose-list"},te={class:"select-option-content"},se=["src"],ie={key:0,class:"search-choose-api-config"},re={style:{"white-space":"nowrap"}},ce={key:1,class:"search-choose-api-config"},oe={style:{"white-space":"nowrap"}},le={style:{"white-space":"nowrap"}},de={key:0,href:"https://app.tavily.com/",target:"_blank",class:"get-api-link"},ve={href:"https://console.cloudsway.net/",target:"_blank",class:"get-api-link"},_e={class:"search-rule search-item"},ue={class:"search-rule-header header"},he={class:"search-number header search-slider-item"},pe={class:"slider"};function ge(s,i,t,a,b,m){const e=q,S=$,d=G,E=z,w=W,N=Y;return p(),f("div",Z,[o("div",ee,[o("div",ae,l(s.$t("setting.searchService.searchProvider")),1),o("div",ne,[g(S,{value:a.selectedTemplate,"onUpdate:value":i[0]||(i[0]=c=>a.selectedTemplate=c),loading:a.loading,style:{width:"100%",height:"100%"},id:"searchTemplates",onChange:a.handleTemplateChange},{default:T(()=>[(p(!0),f(D,null,L(a.searchTemplates,c=>(p(),V(e,{key:c.id,value:c.name},{default:T(()=>[o("div",te,[o("img",{src:c.logo_url,alt:"",class:"logo"},null,8,se),o("span",null,l(a.displayName(c.name)),1)])]),_:2},1032,["value"]))),128))]),_:1},8,["value","loading"]),a.selectedTemplate==="Tavily"?(p(),f("div",ie,[o("span",re,l(s.$t("setting.searchService.apiTips")),1),g(d,{value:a.selectedConfig.base_config.api_key,"onUpdate:value":i[1]||(i[1]=c=>a.selectedConfig.base_config.api_key=c),class:"search-choose-api-input",placeholder:s.$t("setting.searchService.apiKeyPlaceholder"),disabled:a.loading,onChange:a.handleSave},null,8,["value","placeholder","disabled"])])):v("v-if",!0),a.selectedTemplate==="Cloudsway"?(p(),f("div",ce,[o("span",oe,l(s.$t("setting.searchService.accessKey")),1),g(d,{value:a.selectedConfig.base_config.api_key,"onUpdate:value":i[2]||(i[2]=c=>a.selectedConfig.base_config.api_key=c),class:"search-choose-api-input",placeholder:s.$t("setting.searchService.accessKeyPlaceholder"),disabled:a.loading,onChange:a.handleSave},null,8,["value","placeholder","disabled"]),o("span",le,l(s.$t("setting.searchService.endPoint")),1),g(d,{value:a.selectedConfig.base_config.endpoint,"onUpdate:value":i[3]||(i[3]=c=>a.selectedConfig.base_config.endpoint=c),class:"search-choose-api-input",placeholder:s.$t("setting.searchService.endpointPlaceholder"),disabled:a.loading,onChange:a.handleSave},null,8,["value","placeholder","disabled"])])):v("v-if",!0),j(g(E,{class:"save-button",onClick:a.handleCheckApiKey,loading:a.checkLoading},{default:T(()=>[M(l(s.$t("setting.modelService.check")),1)]),_:1},8,["loading"]),[[J,a.selectedTemplate!=="Lemon"]])]),v("  Tavily link"),a.selectedConfig.provider_name==="Tavily"?(p(),f("a",de,l(s.$t("setting.modelService.getApiKey")),1)):a.selectedConfig.provider_name==="Cloudsway"?(p(),f(D,{key:1},[v("  Cloudsway link"),o("a",ve,l(s.$t("setting.modelService.getApiKey")),1)],2112)):v("v-if",!0)]),o("div",_e,[o("div",ue,l(s.$t("setting.searchService.generalSettings")),1),v(` <div class="search-include-date header search-bool-item">
        <div>
          <span>{{ $t('setting.searchService.includeDate') }}</span>
        </div>
        <div>
          <a-switch v-model:checked="selectedConfig.include_date" />
        </div>
      </div>
      <div class="search-include-server header search-bool-item">
        <div>
          <span>{{ $t('setting.searchService.includeServer') }}</span>
        </div>
        <div>
          <a-switch v-model:checked="selectedConfig.cover_provider_search" />
        </div>
      </div> `),v(` <div class="search-enhancement header search-bool-item">
        <div>
          <span>{{ $t('setting.searchService.searchEnhancement') }}</span>
        </div>
        <div>
          <a-switch v-model:checked="selectedConfig.enable_enhanced_mode" />
        </div>
      </div> `),o("div",he,[o("span",null,l(s.$t("setting.searchService.searchResultCount")),1),o("div",pe,[g(N,{style:{height:"10px"}},{default:T(()=>[g(w,{value:a.selectedConfig.result_count,"onUpdate:value":i[4]||(i[4]=c=>a.selectedConfig.result_count=c),min:1,max:20,step:1,marks:{1:"1",5:s.$t("setting.searchService.default"),20:"20"},onAfterChange:a.handleSave},null,8,["value","marks"])]),_:1})])])]),v(` <div class="search-backlist search-item">
      <div class="search-backlist-header header">
        {{ $t('setting.searchService.blacklist') }}
      </div>
      <div>
        <p class="tips">{{ $t('setting.searchService.blacklistTips') }}</p>
      </div>
      <div class="search-blacklist-list">
        <a-textarea v-model:value="selectedConfig.blacklist" :rows="4"
          :placeholder="$t('setting.searchService.blacklistPlaceholder')" style="resize: none;" />
      </div>
    </div> `),v(` <div class="search-blacklist-button" style="display: flex;justify-content: end;">
      <a-button type="primary" class="search-blacklist-save-button" @click="handleSave">
        {{ $t('setting.searchService.save') }}
      </a-button>
    </div> `)])}const fe=R(X,[["render",ge],["__scopeId","data-v-fa858e14"],["__file","/Users/samihalawa/git/PROJECTS_CODING/lemonai/frontend/src/components/searchEngine/index.vue"]]),me={__name:"search",setup(s,{expose:i}){i();const t={searchEngine:fe};return Object.defineProperty(t,"__isScriptSetup",{enumerable:!1,value:!0}),t}},ye={class:"search-service"};function be(s,i,t,a,b,m){return p(),f("div",ye,[o("h2",null,l(s.$t("setting.searchService.title")),1),g(a.searchEngine)])}const Te=R(me,[["render",be],["__scopeId","data-v-d6ada0b7"],["__file","/Users/samihalawa/git/PROJECTS_CODING/lemonai/frontend/src/view/setting/search.vue"]]);export{Te as default};
