import{e as l,I as G,q as N,d as y,h,t as m,F as te,Z as re,ag as L,l as i,x as $,u as X,r as I,c as W,a1 as Y,j as T,aD as se,ay as ne,w as g,k as P,B as Z,U as ae,ac as Q,aE as ce,aF as ie,W as K,v as oe,aG as le,f,m as ve,aC as de,X as me,o as ue,aH as pe,i as fe}from"./index-DaULH4WC.js";import{C as ee}from"./CodeOutlined-BfgZVxAe.js";import{s as he}from"./mcp-aBATD4E5.js";import{h as A}from"./http-yCFEzgv3.js";var Se={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 912H144c-17.7 0-32-14.3-32-32V144c0-17.7 14.3-32 32-32h360c4.4 0 8 3.6 8 8v56c0 4.4-3.6 8-8 8H184v656h656V520c0-4.4 3.6-8 8-8h56c4.4 0 8 3.6 8 8v360c0 17.7-14.3 32-32 32zM653.3 424.6l52.2 52.2a8.01 8.01 0 01-4.7 13.6l-179.4 21c-5.1.6-9.5-3.7-8.9-8.9l21-179.4c.8-6.6 8.9-9.4 13.6-4.7l52.4 52.4 256.2-256.2c3.1-3.1 8.2-3.1 11.3 0l42.4 42.4c3.1 3.1 3.1 8.2 0 11.3L653.3 424.6z"}}]},name:"import",theme:"outlined"};function q(e){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?Object(arguments[r]):{},o=Object.keys(s);typeof Object.getOwnPropertySymbols=="function"&&(o=o.concat(Object.getOwnPropertySymbols(s).filter(function(v){return Object.getOwnPropertyDescriptor(s,v).enumerable}))),o.forEach(function(v){ge(e,v,s[v])})}return e}function ge(e,r,s){return r in e?Object.defineProperty(e,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[r]=s,e}var z=function(r,s){var o=q({},r,s.attrs);return l(G,q({},o,{icon:Se}),null)};z.displayName="ImportOutlined";z.inheritAttrs=!1;var ye={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M893.3 293.3L730.7 130.7c-7.5-7.5-16.7-13-26.7-16V112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V338.5c0-17-6.7-33.2-18.7-45.2zM384 184h256v104H384V184zm456 656H184V184h136v136c0 17.7 14.3 32 32 32h320c17.7 0 32-14.3 32-32V205.8l136 136V840zM512 442c-79.5 0-144 64.5-144 144s64.5 144 144 144 144-64.5 144-144-64.5-144-144-144zm0 224c-44.2 0-80-35.8-80-80s35.8-80 80-80 80 35.8 80 80-35.8 80-80 80z"}}]},name:"save",theme:"outlined"};function R(e){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?Object(arguments[r]):{},o=Object.keys(s);typeof Object.getOwnPropertySymbols=="function"&&(o=o.concat(Object.getOwnPropertySymbols(s).filter(function(v){return Object.getOwnPropertyDescriptor(s,v).enumerable}))),o.forEach(function(v){_e(e,v,s[v])})}return e}function _e(e,r,s){return r in e?Object.defineProperty(e,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[r]=s,e}var B=function(r,s){var o=R({},r,s.attrs);return l(G,R({},o,{icon:ye}),null)};B.displayName="SaveOutlined";B.inheritAttrs=!1;const $e={class:"mcp-server-menu"},be={key:0,class:"no-servers-info"},Oe=["onClick"],Ce={class:"menu-item-label"},ke={__name:"ServerList",props:{servers:{type:Array,required:!0},selectedServerId:{type:[String,Number],default:null}},emits:["select"],setup(e){return(r,s)=>(h(),y("div",$e,[!e.servers||e.servers.length===0?(h(),y("div",be,m(r.$t("setting.mcpService.noServersAvailable")),1)):(h(!0),y(te,{key:1},re(e.servers,o=>(h(),y("div",{key:o.id,class:L(["menu-item",{"menu-item-selected":o.id===e.selectedServerId}]),onClick:v=>r.$emit("select",o)},[l($(ee)),i("span",Ce,m(o.name),1),i("span",{class:L(["menu-item-status",{"menu-item-status-on":o.activate,"menu-item-status-off":!o.activate}])},null,2)],10,Oe))),128))]))}},we=N(ke,[["__scopeId","data-v-15f50cb2"]]),xe={key:0,class:"mcp-server-content"},Pe={class:"mcp-server-content-header"},Ie={style:{display:"flex","align-items":"center"}},Me={class:"mcp-server-content-header-title"},Ve={style:{display:"flex","align-items":"center"}},Ue={class:"mcp-server-content-header-save-button-container"},je={class:"mcp-server-content-main"},Te={class:"mcp-server-content-main-name mcp-server-content-main-item"},Ae={class:"mcp-server-content-main-description mcp-server-content-main-item"},Ne={class:"mcp-server-content-main-type mcp-server-content-main-item"},De={key:0,class:"mcp-server-content-main-command mcp-server-content-main-item"},Ee={key:2,class:"mcp-server-content-main-url mcp-server-content-main-item"},Fe={class:"mcp-server-content-main-args mcp-server-content-main-item"},He={class:"mcp-server-content-main-env mcp-server-content-main-item"},ze={__name:"ServerSettings",props:{server:{type:Object,required:!0}},emits:["update:server","save","delete"],setup(e,{emit:r}){const s=e,{t:o}=X(),v=r,M=I(""),V=I(""),U=I(!1);W(()=>{var t,n;return(n=(t=s.server)==null?void 0:t.command)==null?void 0:n.startsWith("npx")}),W(()=>{var t,n;return(n=(t=s.server)==null?void 0:t.command)==null?void 0:n.startsWith("uv")});const p=async()=>{try{return U.value=!0,(await he.connect(s.server)).ok}catch(t){return f.error(t.message),!1}finally{U.value=!1}},k=async t=>{if(t&&!await p()){f.error(o("mcpService.connectionFailed")),v("update:server",{...s.server,activate:!1});return}v("update:server",{...s.server,activate:t}),v("save")},w=t=>{if(!t){v("update:server",{...s.server,args:[]});return}const n=t.split(`
`).filter(_=>_.trim()!=="");v("update:server",{...s.server,args:n})},J=t=>{if(!t){v("update:server",{...s.server,env:{}});return}const n={};t.split(`
`).forEach(_=>{const x=_.trim();if(x){const[b,...a]=x.split("="),d=b.trim(),u=a.join("=").trim();d&&u&&(n[d]=u)}}),v("update:server",{...s.server,env:n})},D=t=>Array.isArray(t)?t.join(`
`):"",E=t=>Object.entries(t||{}).map(([n,_])=>`${n}=${_}`).join(`
`),F=t=>{K.confirm({title:o("setting.mcpService.deleteConfirmTitle"),icon:()=>oe(le,{style:"color: #ff4d4f"}),content:o("setting.mcpService.deleteConfirmContent"),okText:o("common.yes","Yes"),okType:"danger",cancelText:o("common.cancel","Cancel"),onOk(){v("delete",t)},onCancel(){console.log("Cancel")}})},H=t=>{v("update:server",{...s.server,...t})};return Y(()=>s.server,t=>{t&&(M.value=D(t.args||[]),V.value=E(t.env||{}))},{immediate:!0,deep:!0}),(t,n)=>{const _=ne,x=Z,b=ae,a=Q,d=ce,u=ie;return e.server?(h(),y("div",xe,[i("div",Pe,[i("div",Ie,[i("span",Me,m(e.server.name),1),l($(se),{class:"mcp-server-content-header-delete-button",onClick:n[0]||(n[0]=c=>F(e.server.id))})]),i("div",Ve,[l(_,{checked:e.server.activate,"onUpdate:checked":n[1]||(n[1]=c=>e.server.activate=c),class:"mcp-server-content-header-activate-switch",loading:U.value,onChange:k},null,8,["checked","loading"]),i("div",Ue,[l(x,{type:"primary",onClick:n[2]||(n[2]=c=>t.$emit("save")),class:"mcp-server-content-header-save-button"},{default:g(()=>[l($(B)),P(" "+m(t.$t("setting.mcpService.save")),1)]),_:1})])])]),i("div",je,[i("div",Te,[i("span",null,m(t.$t("setting.mcpService.name")),1),l(b,{value:e.server.name,"onUpdate:value":n[3]||(n[3]=c=>e.server.name=c),placeholder:t.$t("setting.mcpService.namePlaceholder"),class:"text-item input"},null,8,["value","placeholder"])]),i("div",Ae,[i("span",null,m(t.$t("setting.mcpService.description")),1),l(a,{value:e.server.description,"onUpdate:value":n[4]||(n[4]=c=>e.server.description=c),rows:4,placeholder:t.$t("setting.mcpService.descriptionPlaceholder"),class:"text-item"},null,8,["value","placeholder"])]),i("div",Ne,[i("span",null,m(t.$t("setting.mcpService.type")),1),l(u,{value:e.server.type,"onUpdate:value":n[5]||(n[5]=c=>e.server.type=c),name:"radioGroup",class:"input radio"},{default:g(()=>[l(d,{value:"stdio"},{default:g(()=>[P(m(t.$t("setting.mcpService.stdio")),1)]),_:1}),l(d,{value:"sse"},{default:g(()=>[P(m(t.$t("setting.mcpService.sse")),1)]),_:1}),l(d,{value:"streamableHttp"},{default:g(()=>[P(m(t.$t("setting.mcpService.streamableHttp")),1)]),_:1})]),_:1},8,["value"])]),e.server.type==="stdio"?(h(),y("div",De,[i("span",null,m(t.$t("setting.mcpService.command")),1),l(b,{value:e.server.command,"onUpdate:value":n[6]||(n[6]=c=>e.server.command=c),placeholder:t.$t("setting.mcpService.commandPlaceholder"),class:"text-item input"},null,8,["value","placeholder"])])):T("",!0),T("",!0),e.server.type==="sse"||e.server.type==="streamableHttp"?(h(),y("div",Ee,[i("span",null,m(t.$t("setting.mcpService.url")),1),l(b,{value:e.server.url,"onUpdate:value":[n[9]||(n[9]=c=>e.server.url=c),n[10]||(n[10]=c=>H({url:c}))],placeholder:t.$t("setting.mcpService.url"),class:"text-item input"},null,8,["value","placeholder"])])):T("",!0),i("div",Fe,[i("span",null,m(t.$t("setting.mcpService.args")),1),l(a,{value:M.value,"onUpdate:value":[n[11]||(n[11]=c=>M.value=c),w],rows:4,placeholder:t.$t("setting.mcpService.argsPlaceholder"),class:"text-item"},null,8,["value","placeholder"])]),i("div",He,[i("span",null,m(t.$t("setting.mcpService.env")),1),l(a,{value:V.value,"onUpdate:value":[n[12]||(n[12]=c=>V.value=c),J],rows:4,placeholder:t.$t("setting.mcpService.envPlaceholder"),class:"text-item"},null,8,["value","placeholder"])])])])):T("",!0)}}},Be=N(ze,[["__scopeId","data-v-73af2136"]]),C=de.global.t,Je=ve("server",{state:()=>({servers:[]}),actions:{async fetchServers(){try{const e=await A.get("/api/mcp_server");console.log("response",e),this.servers=e,console.log("servers",this.servers)}catch(e){f.error(C("setting.mcpService.fetchFailed")),console.error("Fetch servers error:",e)}},async addServer(e){try{const r=await A.post("/api/mcp_server",e);console.log("add.server.response",r),this.servers.push(r),f.success(C("setting.mcpService.addSuccess"))}catch(r){f.error(C("setting.mcpService.addFailed")),console.error("Add server error:",r)}},async updateServer(e){try{await A.put(`/api/mcp_server/${e.id}`,e);const r=this.servers.findIndex(s=>s.id===e.id);r!==-1&&(this.servers[r]=e),f.success(C("setting.mcpService.updateSuccess"))}catch(r){f.error(C("setting.mcpService.updateFailed")),console.error("Update server error:",r)}},async deleteServer(e){try{await A.del(`/api/mcp_server/${e}`);const r=this.servers.findIndex(s=>s.id===e);r!==-1&&this.servers.splice(r,1),f.success(C("setting.mcpService.deleteSuccess"))}catch(r){f.error(C("setting.mcpService.deleteFailed")),console.error("Delete server error:",r)}}}}),Le={class:"mcp-manager-container"},We={class:"top-action-bar"},qe={class:"title"},Re={class:"actions"},Ge={class:"main-content"},Xe={class:"server-list-panel"},Ye={class:"server-settings-panel"},Ze={key:1,class:"no-server-placeholder"},Qe={class:"placeholder-content"},Ke={class:"placeholder-icon"},et={class:"placeholder-text"},tt={__name:"index",setup(e){const{t:r}=X(),s=Je(),{servers:o}=me(s),{addServer:v,updateServer:M,deleteServer:V,fetchServers:U}=s,p=I(null),k=I(!1),w=I(""),D=JSON.stringify({mcpServers:{"amap-amap-sse":{url:"https://mcp.amap.com/sse?key=amap_key"}}},null,2),E=a=>{p.value=a},F=a=>{p.value={...p.value,...a}},H=()=>{p.value&&M(p.value)},t=a=>{V(a)},n=()=>{v({name:"MCP Server",description:"",activate:!1,type:"stdio",command:"",registryUrl:"",args:[],env:{}})},_=()=>{k.value=!0,w.value=""},x=a=>{const{url:d="",command:u=""}=a;return d.includes("sse")?"sse":u.startsWith("npx")||u.startsWith("uvx")?"stdio":d.includes("mcp")?"streamableHttp":"stdio"},b=()=>{try{const a=JSON.parse(w.value);if(a.mcpServers){const d=a.mcpServers;let u=0;for(const c in d)if(Object.prototype.hasOwnProperty.call(d,c)){const S=d[c],O=x(S),j={name:c,description:S.description||"",activate:!1,url:S.url,type:O,command:O==="stdio"?S.command:"",args:S.args||[],env:S.env||{}};v(j),u++}u>0?f.success(r("mcpService.importSuccess",{count:u})):f.warn(r("mcpService.noValidServer"))}else{if(!a.name){f.error(r("mcpService.nameRequired"));return}v(a),f.success(r("mcpService.importSuccessSingle"))}k.value=!1}catch(a){f.error(r("mcpService.invalidJson")),console.error("JSON parsing error:",a)}};return Y(()=>[...o.value],(a,d)=>{if(a.length>d.length){const c=a.find(S=>!d.some(O=>O.id===S.id));if(c){p.value=c;return}}p.value&&a.some(c=>c.id===p.value.id)||(p.value=a[0]||null)},{deep:!0}),ue(()=>{U()}),(a,d)=>{var O;const u=Z,c=Q,S=K;return h(),y("div",Le,[i("div",We,[i("h2",qe,m(a.$t("setting.mcpService.title")),1),i("div",Re,[l(u,{onClick:_},{icon:g(()=>[l($(z))]),default:g(()=>[P(" "+m(a.$t("setting.mcpService.importFromJson")),1)]),_:1}),l(u,{type:"primary",onClick:n,style:{"margin-left":"8px"}},{icon:g(()=>[l($(pe))]),default:g(()=>[P(" "+m(a.$t("setting.mcpService.addMcpServer")),1)]),_:1})])]),i("div",Ge,[i("div",Xe,[l(we,{servers:$(o),selectedServerId:(O=p.value)==null?void 0:O.id,onSelect:E},null,8,["servers","selectedServerId"])]),i("div",Ye,[p.value?(h(),fe(Be,{key:0,server:p.value,"onUpdate:server":F,onSave:H,onDelete:t},null,8,["server"])):(h(),y("div",Ze,[i("div",Qe,[i("div",Ke,[l($(ee))]),i("p",et,m(a.$t("setting.mcpService.noServerSelected")),1)])]))])]),l(S,{visible:k.value,"onUpdate:visible":d[1]||(d[1]=j=>k.value=j),title:a.$t("setting.mcpService.importModalTitle"),onOk:b,"ok-text":a.$t("setting.mcpService.ok"),"cancel-text":a.$t("setting.mcpService.cancel")},{default:g(()=>[i("pre",null,m($(D)),1),l(c,{value:w.value,"onUpdate:value":d[0]||(d[0]=j=>w.value=j),placeholder:"",rows:10},null,8,["value"])]),_:1},8,["visible","title","ok-text","cancel-text"])])}}},rt=N(tt,[["__scopeId","data-v-ab4e84ec"]]),st={class:"mcp-service"},nt={__name:"mcp",setup(e){return(r,s)=>(h(),y("div",st,[l(rt)]))}},lt=N(nt,[["__scopeId","data-v-d9698649"]]);export{lt as default};
